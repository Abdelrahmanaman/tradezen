import{a as $r,c as le,m as Le,j as S,$ as cs,a0 as Wr,a1 as ge,a2 as zt,a3 as Ut,a4 as Ta,a5 as jn,a6 as Hr,a7 as Ba,a8 as ja,a9 as Ka,aa as Gr,ab as rn,ac as Zr,ad as La,r as d,x as us,ae as we,af as qa,ag as Kn,ah as sn,B as ds,T as Ua,q as _a,p as Va,ai as za,aj as hs,ak as Ja,al as Wa,am as Ha,an as Ga,ao as He,ap as Za,aq as Qa,ar as Ya,as as Xa,at as el,au as tl,av as nl,aw as rl,Y as il}from"./client-BbWzF__1.js";import{L as gt,I as xr,C as sl,c as ol,b as al,S as ll,a as cl,d as ul}from"./label-B8V1LF47.js";/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dl=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],hl=$r("Eye",dl);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fl=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],pl=$r("LoaderCircle",fl);/**
 * @license lucide-react v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ml=[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]],gl=$r("Search",ml);function Rt(t){const e=le.c(8);let n,r;e[0]!==t?({className:n,...r}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);let i;e[3]!==n?(i=Le("bg-accent animate-pulse rounded-md",n),e[3]=n,e[4]=i):i=e[4];let s;return e[5]!==r||e[6]!==i?(s=S.jsx("div",{"data-slot":"skeleton",className:i,...r}),e[5]=r,e[6]=i,e[7]=s):s=e[7],s}var bl=class extends cs{constructor(t,e){super(),this.options=e,this.#n=t,this.#s=null,this.#a=Wr(),this.options.experimental_prefetchInRender||this.#a.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(e)}#n;#e=void 0;#r=void 0;#t=void 0;#i;#o;#a;#s;#m;#h;#f;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#e.addObserver(this),Qr(this.#e,this.options)?this.#d():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Ln(this.#e,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Ln(this.#e,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#$(),this.#x(),this.#e.removeObserver(this)}setOptions(t){const e=this.options,n=this.#e;if(this.options=this.#n.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof ge(this.options.enabled,this.#e)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#e.setOptions(this.options),e._defaulted&&!zt(this.options,e)&&this.#n.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#e,observer:this});const r=this.hasListeners();r&&Yr(this.#e,n,this.options,e)&&this.#d(),this.updateResult(),r&&(this.#e!==n||ge(this.options.enabled,this.#e)!==ge(e.enabled,this.#e)||Ut(this.options.staleTime,this.#e)!==Ut(e.staleTime,this.#e))&&this.#g();const i=this.#b();r&&(this.#e!==n||ge(this.options.enabled,this.#e)!==ge(e.enabled,this.#e)||i!==this.#l)&&this.#v(i)}getOptimisticResult(t){const e=this.#n.getQueryCache().build(this.#n,t),n=this.createResult(e,t);return yl(this,n)&&(this.#t=n,this.#o=this.options,this.#i=this.#e.state),n}getCurrentResult(){return this.#t}trackResult(t,e){const n={};return Object.keys(t).forEach(r=>{Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),e?.(r),t[r])})}),n}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#e}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#n.defaultQueryOptions(t),n=this.#n.getQueryCache().build(this.#n,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#t))}#d(t){this.#w();let e=this.#e.fetch(this.options,t);return t?.throwOnError||(e=e.catch(Ta)),e}#g(){this.#$();const t=Ut(this.options.staleTime,this.#e);if(jn||this.#t.isStale||!Hr(t))return;const n=Ba(this.#t.dataUpdatedAt,t)+1;this.#c=setTimeout(()=>{this.#t.isStale||this.updateResult()},n)}#b(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#e):this.options.refetchInterval)??!1}#v(t){this.#x(),this.#l=t,!(jn||ge(this.options.enabled,this.#e)===!1||!Hr(this.#l)||this.#l===0)&&(this.#u=setInterval(()=>{(this.options.refetchIntervalInBackground||ja.isFocused())&&this.#d()},this.#l))}#y(){this.#g(),this.#v(this.#b())}#$(){this.#c&&(clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#e,r=this.options,i=this.#t,s=this.#i,o=this.#o,c=t!==n?t.state:this.#r,{state:l}=t;let u={...l},h=!1,f;if(e._optimisticResults){const k=this.hasListeners(),M=!k&&Qr(t,e),B=k&&Yr(t,n,e,r);(M||B)&&(u={...u,...Ka(l.data,t.options)}),e._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:p,errorUpdatedAt:g,status:m}=u;if(e.select&&u.data!==void 0)if(i&&u.data===s?.data&&e.select===this.#m)f=this.#h;else try{this.#m=e.select,f=e.select(u.data),f=Gr(i?.data,f,e),this.#h=f,this.#s=null}catch(k){this.#s=k}else f=u.data;if(e.placeholderData!==void 0&&f===void 0&&m==="pending"){let k;if(i?.isPlaceholderData&&e.placeholderData===o?.placeholderData)k=i.data;else if(k=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,e.select&&k!==void 0)try{k=e.select(k),this.#s=null}catch(M){this.#s=M}k!==void 0&&(m="success",f=Gr(i?.data,k,e),h=!0)}this.#s&&(p=this.#s,f=this.#h,g=Date.now(),m="error");const b=u.fetchStatus==="fetching",$=m==="pending",x=m==="error",E=$&&b,N=f!==void 0,O={status:m,fetchStatus:u.fetchStatus,isPending:$,isSuccess:m==="success",isError:x,isInitialLoading:E,isLoading:E,data:f,dataUpdatedAt:u.dataUpdatedAt,error:p,errorUpdatedAt:g,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>c.dataUpdateCount||u.errorUpdateCount>c.errorUpdateCount,isFetching:b,isRefetching:b&&!$,isLoadingError:x&&!N,isPaused:u.fetchStatus==="paused",isPlaceholderData:h,isRefetchError:x&&N,isStale:wr(t,e),refetch:this.refetch,promise:this.#a};if(this.options.experimental_prefetchInRender){const k=T=>{O.status==="error"?T.reject(O.error):O.data!==void 0&&T.resolve(O.data)},M=()=>{const T=this.#a=O.promise=Wr();k(T)},B=this.#a;switch(B.status){case"pending":t.queryHash===n.queryHash&&k(B);break;case"fulfilled":(O.status==="error"||O.data!==B.value)&&M();break;case"rejected":(O.status!=="error"||O.error!==B.reason)&&M();break}}return O}updateResult(){const t=this.#t,e=this.createResult(this.#e,this.options);if(this.#i=this.#e.state,this.#o=this.options,this.#i.data!==void 0&&(this.#f=this.#e),zt(e,t))return;this.#t=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:r}=this.options,i=typeof r=="function"?r():r;if(i==="all"||!i&&!this.#p.size)return!0;const s=new Set(i??this.#p);return this.options.throwOnError&&s.add("error"),Object.keys(this.#t).some(o=>{const a=o;return this.#t[a]!==t[a]&&s.has(a)})};this.#S({listeners:n()})}#w(){const t=this.#n.getQueryCache().build(this.#n,this.options);if(t===this.#e)return;const e=this.#e;this.#e=t,this.#r=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#S(t){rn.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#t)}),this.#n.getQueryCache().notify({query:this.#e,type:"observerResultsUpdated"})})}};function vl(t,e){return ge(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Qr(t,e){return vl(t,e)||t.state.data!==void 0&&Ln(t,e,e.refetchOnMount)}function Ln(t,e,n){if(ge(e.enabled,t)!==!1){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&wr(t,e)}return!1}function Yr(t,e,n,r){return(t!==e||ge(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&wr(t,n)}function wr(t,e){return ge(e.enabled,t)!==!1&&t.isStaleByTime(Ut(e.staleTime,t))}function yl(t,e){return!zt(t.getCurrentResult(),e)}var $l=class extends cs{#n;#e=void 0;#r;#t;constructor(e,n){super(),this.#n=e,this.setOptions(n),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#n.defaultMutationOptions(e),zt(this.options,n)||this.#n.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),n?.mutationKey&&this.options.mutationKey&&Zr(n.mutationKey)!==Zr(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#o(e)}getCurrentResult(){return this.#e}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#o()}mutate(e,n){return this.#t=n,this.#r?.removeObserver(this),this.#r=this.#n.getMutationCache().build(this.#n,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){const e=this.#r?.state??La();this.#e={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#o(e){rn.batch(()=>{if(this.#t&&this.hasListeners()){const n=this.#e.variables,r=this.#e.context;e?.type==="success"?(this.#t.onSuccess?.(e.data,n,r),this.#t.onSettled?.(e.data,null,n,r)):e?.type==="error"&&(this.#t.onError?.(e.error,n,r),this.#t.onSettled?.(void 0,e.error,n,r))}this.listeners.forEach(n=>{n(this.#e)})})}},fs=d.createContext(!1),xl=()=>d.useContext(fs);fs.Provider;function wl(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var Sl=d.createContext(wl()),El=()=>d.useContext(Sl);function ps(t,e){return typeof t=="function"?t(...e):!!t}function qn(){}var kl=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},Ml=t=>{d.useEffect(()=>{t.clearReset()},[t])},Al=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:i})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(i&&t.data===void 0||ps(n,[t.error,r])),Nl=t=>{const e=t.staleTime;t.suspense&&(t.staleTime=typeof e=="function"?(...n)=>Math.max(e(...n),1e3):Math.max(e??1e3,1e3),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3)))},Cl=(t,e)=>t.isLoading&&t.isFetching&&!e,Ol=(t,e)=>t?.suspense&&e.isPending,Xr=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function Il(t,e,n){const r=us(),i=xl(),s=El(),o=r.defaultQueryOptions(t);r.getDefaultOptions().queries?._experimental_beforeQuery?.(o),o._optimisticResults=i?"isRestoring":"optimistic",Nl(o),kl(o,s),Ml(s);const a=!r.getQueryCache().get(o.queryHash),[c]=d.useState(()=>new e(r,o)),l=c.getOptimisticResult(o),u=!i&&t.subscribed!==!1;if(d.useSyncExternalStore(d.useCallback(h=>{const f=u?c.subscribe(rn.batchCalls(h)):qn;return c.updateResult(),f},[c,u]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),d.useEffect(()=>{c.setOptions(o)},[o,c]),Ol(o,l))throw Xr(o,c,s);if(Al({result:l,errorResetBoundary:s,throwOnError:o.throwOnError,query:r.getQueryCache().get(o.queryHash),suspense:o.suspense}))throw l.error;return r.getDefaultOptions().queries?._experimental_afterQuery?.(o,l),o.experimental_prefetchInRender&&!jn&&Cl(l,i)&&(a?Xr(o,c,s):r.getQueryCache().get(o.queryHash)?.promise)?.catch(qn).finally(()=>{c.updateResult()}),o.notifyOnChangeProps?l:c.trackResult(l)}function Rl(t,e){return Il(t,bl)}function Mg(t,e){const n=us(),[r]=d.useState(()=>new $l(n,t));d.useEffect(()=>{r.setOptions(t)},[r,t]);const i=d.useSyncExternalStore(d.useCallback(o=>r.subscribe(rn.batchCalls(o)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),s=d.useCallback((o,a)=>{r.mutate(o,a).catch(qn)},[r]);if(i.error&&ps(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:s,mutateAsync:i.mutate}}function on(t,e){return typeof t=="function"?t(e):t}function ms(t,e){return Sr(e).reduce((r,i)=>{if(r===null)return null;if(typeof r<"u")return r[i]},t)}function $n(t,e,n){const r=Sr(e);function i(s){if(!r.length)return on(n,s);const o=r.shift();if(typeof o=="string"||typeof o=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[o]:i(s[o])}):{[o]:i()};if(Array.isArray(s)&&typeof o=="number"){const a=s.slice(0,o);return[...a.length?a:new Array(o),i(s[o]),...s.slice(o+1)]}return[...new Array(o),i()]}return i(t)}function Fl(t,e){const n=Sr(e);function r(i){if(!i)return;if(n.length===1){const o=n[0];if(Array.isArray(i)&&typeof o=="number")return i.filter((l,u)=>u!==o);const{[o]:a,...c}=i;return c}const s=n.shift();if(typeof s=="string"&&typeof i=="object")return{...i,[s]:r(i[s])};if(typeof s=="number"&&Array.isArray(i)){if(s>=i.length)return i;const o=i.slice(0,s);return[...o.length?o:new Array(s),r(i[s]),...i.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return r(t)}const Dl=/^(\d*)$/gm,Pl=/\.(\d*)\./gm,Tl=/^(\d*)\./gm,Bl=/\.(\d*$)/gm,jl=/\.{2,}/gm,Un="__int__",Ft=`${Un}$1`;function Sr(t){if(Array.isArray(t))return[...t];if(typeof t!="string")throw new Error("Path must be a string.");return t.replace(/\[/g,".").replace(/\]/g,"").replace(Dl,Ft).replace(Pl,`.${Ft}.`).replace(Tl,`${Ft}.`).replace(Bl,`.${Ft}`).replace(jl,".").split(".").map(e=>e.indexOf(Un)===0?parseInt(e.substring(Un.length),10):e)}function Kl(t){return!(Array.isArray(t)&&t.length===0)}function _n(t,e){const{asyncDebounceMs:n}=e,{onChangeAsync:r,onBlurAsync:i,onSubmitAsync:s,onBlurAsyncDebounceMs:o,onChangeAsyncDebounceMs:a}=e.validators||{},c=n??0,l={cause:"change",validate:r,debounceMs:a??c},u={cause:"blur",validate:i,debounceMs:o??c},h={cause:"submit",validate:s,debounceMs:0},f=p=>({...p,debounceMs:0});switch(t){case"submit":return[f(l),f(u),h];case"blur":return[u];case"change":return[l];case"server":default:return[]}}function Vn(t,e){const{onChange:n,onBlur:r,onSubmit:i,onMount:s}=e.validators||{},o={cause:"change",validate:n},a={cause:"blur",validate:r},c={cause:"submit",validate:i},l={cause:"mount",validate:s},u={cause:"server",validate:()=>{}};switch(t){case"mount":return[l];case"submit":return[o,a,c,u];case"server":return[u];case"blur":return[a,u];case"change":default:return[o,u]}}const gs=t=>!!t&&typeof t=="object"&&"fields"in t;function xn(t,e){if(Object.is(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;if(t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(const[r,i]of t)if(!e.has(r)||!Object.is(i,e.get(r)))return!1;return!0}if(t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!1;for(let r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(e,n[r])||!Object.is(t[n[r]],e[n[r]]))return!1;return!0}function Ll(t){const e=new Map;for(const n of t){const r=[...n.path??[]].map(i=>{const s=typeof i=="object"?i.key:i;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");e.set(r,(e.get(r)??[]).concat(n))}return Object.fromEntries(e)}const ql=t=>t,Ul=t=>{const e=Ll(t);return{form:e,fields:e}},ei=(t,e)=>t==="form"?Ul(e):ql(e),bs={validate({value:t,validationSource:e},n){const r=n["~standard"].validate(t);if(r instanceof Promise)throw new Error("async function passed to sync validator");if(r.issues)return ei(e,r.issues)},async validateAsync({value:t,validationSource:e},n){const r=await n["~standard"].validate(t);if(r.issues)return ei(e,r.issues)}},vs=t=>!!t&&"~standard"in t,Jt={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}};function Dt(t){function e(h,f,p,g){const m=r(h,f,p,g);({insert:()=>a(m,h,f),remove:()=>c(m),swap:()=>g!==void 0&&u(m,h,f,g),move:()=>g!==void 0&&l(m,h,f,g)})[p]()}function n(h,f){return`${h}[${f}]`}function r(h,f,p,g){const m=[n(h,f)];if(p==="swap")m.push(n(h,g));else if(p==="move"){const[b,$]=[Math.min(f,g),Math.max(f,g)];for(let x=b;x<=$;x++)m.push(n(h,x))}else{const b=t.getFieldValue(h),$=Array.isArray(b)?b.length:0;for(let x=f+1;x<$;x++)m.push(n(h,x))}return Object.keys(t.fieldInfo).filter(b=>m.some($=>b.startsWith($)))}function i(h,f){return h.replace(/\[(\d+)\]/,(p,g)=>{const m=parseInt(g,10);return`[${f==="up"?m+1:Math.max(0,m-1)}]`})}function s(h,f){(f==="up"?h:[...h].reverse()).forEach(g=>{const m=i(g.toString(),f),b=t.getFieldMeta(m);b?t.setFieldMeta(g,b):t.setFieldMeta(g,o())})}const o=()=>Jt,a=(h,f,p)=>{s(h,"down"),h.forEach(g=>{g.toString().startsWith(n(f,p))&&t.setFieldMeta(g,o())})},c=h=>{s(h,"up")},l=(h,f,p,g)=>{const m=new Map(Object.keys(t.fieldInfo).filter(b=>b.startsWith(n(f,p))).map(b=>[b,t.getFieldMeta(b)]));s(h,p<g?"up":"down"),Object.keys(t.fieldInfo).filter(b=>b.startsWith(n(f,g))).forEach(b=>{const $=b.replace(n(f,g),n(f,p)),x=m.get($);x&&t.setFieldMeta(b,x)})},u=(h,f,p,g)=>{h.forEach(m=>{if(!m.toString().startsWith(n(f,p)))return;const b=m.toString().replace(n(f,p),n(f,g)),[$,x]=[t.getFieldMeta(m),t.getFieldMeta(b)];$&&t.setFieldMeta(b,$),x&&t.setFieldMeta(m,x)})};return{handleArrayFieldMetaShift:e}}function wn(t){return{values:t.values??{},errorMap:t.errorMap??{},fieldMetaBase:t.fieldMetaBase??{},isSubmitted:t.isSubmitted??!1,isSubmitting:t.isSubmitting??!1,isValidating:t.isValidating??!1,submissionAttempts:t.submissionAttempts??0,isSubmitSuccessful:t.isSubmitSuccessful??!1,validationMetaMap:t.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class _l{constructor(e){var n;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.cumulativeFieldsErrorMap={},this.mount=()=>{const r=this.fieldMetaDerived.mount(),i=this.store.mount(),s=()=>{r(),i()},{onMount:o}=this.options.validators||{};return o&&this.validateSync("mount"),s},this.update=r=>{var i,s;if(!r)return;const o=this.options;this.options=r;const a=!!((s=(i=r.transform)==null?void 0:i.deps)!=null&&s.some((u,h)=>u!==this.prevTransformArray[h])),c=r.defaultValues&&!xn(r.defaultValues,o.defaultValues)&&!this.state.isTouched,l=!xn(r.defaultState,o.defaultState)&&!this.state.isTouched;!c&&!l&&!a||we(()=>{this.baseStore.setState(()=>wn(Object.assign({},this.state,l?r.defaultState:{},c?{values:r.defaultValues}:{},a?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(r,i)=>{const{fieldMeta:s}=this.state,o=this.resetFieldMeta(s);r&&!i?.keepDefaultValues&&(this.options={...this.options,defaultValues:r}),this.baseStore.setState(()=>{var a;return wn({...this.options.defaultState,values:r??this.options.defaultValues??((a=this.options.defaultState)==null?void 0:a.values),fieldMetaBase:o})})},this.validateAllFields=async r=>{const i=[];return we(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const a=o.instance;i.push(Promise.resolve().then(()=>a.validate(r,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(c=>({...c,isTouched:!0}))})}),(await Promise.all(i)).flat()},this.validateArrayFieldsStartingFrom=async(r,i,s)=>{const o=this.getFieldValue(r),a=Array.isArray(o)?Math.max(o.length-1,0):null,c=[`${r}[${i}]`];for(let f=i+1;f<=(a??0);f++)c.push(`${r}[${f}]`);const l=Object.keys(this.fieldInfo).filter(f=>c.some(p=>f.startsWith(p))),u=[];return we(()=>{l.forEach(f=>{u.push(Promise.resolve().then(()=>this.validateField(f,s)))})}),(await Promise.all(u)).flat()},this.validateField=(r,i)=>{var s;const o=(s=this.fieldInfo[r])==null?void 0:s.instance;return o?(o.state.meta.isTouched||o.setMeta(a=>({...a,isTouched:!0})),o.validate(i)):[]},this.validateSync=r=>{const i=Vn(r,this.options);let s=!1;const o={};return we(()=>{var a;for(const l of i){if(!l.validate)continue;const u=this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:h,fieldErrors:f}=zn(u),p=Pt(l.cause);if(f)for(const[g,m]of Object.entries(f)){const $={...this.cumulativeFieldsErrorMap[g]||{},[p]:m};o[g]=$,this.cumulativeFieldsErrorMap[g]=$;const x=this.getFieldMeta(g);x&&x.errorMap[p]!==m&&this.setFieldMeta(g,E=>({...E,errorMap:{...E.errorMap,[p]:m}}))}for(const g of Object.keys(this.cumulativeFieldsErrorMap)){const m=this.getFieldMeta(g);m?.errorMap[p]&&!((a=o[g])!=null&&a[p])&&(this.cumulativeFieldsErrorMap[g]={...this.cumulativeFieldsErrorMap[g],[p]:void 0},this.setFieldMeta(g,b=>({...b,errorMap:{...b.errorMap,[p]:void 0}})))}this.state.errorMap[p]!==h&&this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[p]:h}})),(h||f)&&(s=!0)}const c=Pt("submit");this.state.errorMap[c]&&r!=="submit"&&!s&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[c]:void 0}}))}),{hasErrored:s,fieldsErrorMap:o}},this.validateAsync=async r=>{const i=_n(r,this.options);this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const s=[];let o;for(const l of i){if(!l.validate)continue;const u=Pt(l.cause),h=this.state.validationMetaMap[u];h?.lastAbortController.abort();const f=new AbortController;this.state.validationMetaMap[u]={lastAbortController:f},s.push(new Promise(async p=>{let g;try{g=await new Promise((x,E)=>{setTimeout(async()=>{if(f.signal.aborted)return x(void 0);try{x(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:f.signal},type:"validateAsync"}))}catch(N){E(N)}},l.debounceMs)})}catch(x){g=x}const{formError:m,fieldErrors:b}=zn(g);b&&(o=o?{...o,...b}:b);const $=Pt(l.cause);if(o)for(const[x,E]of Object.entries(o)){const N=this.getFieldMeta(x);N&&N.errorMap[$]!==E&&this.setFieldMeta(x,C=>({...C,errorMap:{...C.errorMap,[$]:E}}))}this.baseStore.setState(x=>({...x,errorMap:{...x.errorMap,[$]:m}})),p(o?{fieldErrors:o,errorMapKey:$}:void 0)}))}let a=[];const c={};if(s.length){a=await Promise.all(s);for(const l of a)if(l?.fieldErrors){const{errorMapKey:u}=l;for(const[h,f]of Object.entries(l.fieldErrors)){const g={...c[h]||{},[u]:f};c[h]=g}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),c},this.validate=r=>{const{hasErrored:i,fieldsErrorMap:s}=this.validateSync(r);return i&&!this.options.asyncAlways?s:this.validateAsync(r)},this.getFieldValue=r=>ms(this.state.values,r),this.getFieldMeta=r=>this.state.fieldMeta[r],this.getFieldInfo=r=>{var i;return(i=this.fieldInfo)[r]||(i[r]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(r,i)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[r]:on(i,s.fieldMetaBase[r])}}))},this.resetFieldMeta=r=>Object.keys(r).reduce((i,s)=>{const o=s;return i[o]=Jt,i},{}),this.setFieldValue=(r,i,s)=>{const o=s?.dontUpdateMeta??!1;we(()=>{o||this.setFieldMeta(r,a=>({...a,isTouched:!0,isDirty:!0,errorMap:{...a?.errorMap,onMount:void 0}})),this.baseStore.setState(a=>({...a,values:$n(a.values,r,i)}))})},this.deleteField=r=>{const s=[...Object.keys(this.fieldInfo).filter(o=>{const a=r.toString();return o!==a&&o.startsWith(a)}),r];this.baseStore.setState(o=>{const a={...o};return s.forEach(c=>{a.values=Fl(a.values,c),delete this.fieldInfo[c],delete a.fieldMetaBase[c]}),a})},this.pushFieldValue=(r,i,s)=>{this.setFieldValue(r,o=>[...Array.isArray(o)?o:[],i],s),this.validateField(r,"change")},this.insertFieldValue=async(r,i,s,o)=>{this.setFieldValue(r,a=>[...a.slice(0,i),s,...a.slice(i)],o),await this.validateField(r,"change"),Dt(this).handleArrayFieldMetaShift(r,i,"insert"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.replaceFieldValue=async(r,i,s,o)=>{this.setFieldValue(r,a=>a.map((c,l)=>l===i?s:c),o),await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.removeFieldValue=async(r,i,s)=>{const o=this.getFieldValue(r),a=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(r,c=>c.filter((l,u)=>u!==i),s),Dt(this).handleArrayFieldMetaShift(r,i,"remove"),a!==null){const c=`${r}[${a}]`;this.deleteField(c)}await this.validateField(r,"change"),await this.validateArrayFieldsStartingFrom(r,i,"change")},this.swapFieldValues=(r,i,s,o)=>{this.setFieldValue(r,a=>{const c=a[i],l=a[s];return $n($n(a,`${i}`,l),`${s}`,c)},o),Dt(this).handleArrayFieldMetaShift(r,i,"swap",s),this.validateField(r,"change"),this.validateField(`${r}[${i}]`,"change"),this.validateField(`${r}[${s}]`,"change")},this.moveFieldValues=(r,i,s,o)=>{this.setFieldValue(r,a=>(a.splice(s,0,a.splice(i,1)[0]),a),o),Dt(this).handleArrayFieldMetaShift(r,i,"move",s),this.validateField(r,"change"),this.validateField(`${r}[${i}]`,"change"),this.validateField(`${r}[${s}]`,"change")},this.resetField=r=>{this.baseStore.setState(i=>({...i,fieldMetaBase:{...i.fieldMetaBase,[r]:Jt},values:{...i.values,[r]:this.options.defaultValues&&this.options.defaultValues[r]}}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((r,[i,s])=>(Object.keys(s).length&&s.errors.length&&(r[i]={errors:s.errors,errorMap:s.errorMap}),r),{})}),this.baseStore=new qa(wn({...e?.defaultState,values:e?.defaultValues??((n=e?.defaultState)==null?void 0:n.values)})),this.fieldMetaDerived=new Kn({deps:[this.baseStore],fn:({prevDepVals:r,currDepVals:i,prevVal:s})=>{var o;const a=s,c=r?.[0],l=i[0];let u=0;const h={};for(const f of Object.keys(l.fieldMetaBase)){const p=l.fieldMetaBase[f],g=c?.fieldMetaBase[f],m=a?.[f];let b=m?.errors;if(!g||p.errorMap!==g.errorMap){b=Object.values(p.errorMap??{}).filter(E=>E!==void 0);const x=(o=this.getFieldInfo(f))==null?void 0:o.instance;x&&!x.options.disableErrorFlat&&(b=b?.flat(1))}const $=!p.isDirty;if(m&&m.isPristine===$&&m.errors===b&&p===g){h[f]=m,u++;continue}h[f]={...p,errors:b,isPristine:$}}return Object.keys(l.fieldMetaBase).length&&a&&u===Object.keys(l.fieldMetaBase).length?a:h}}),this.store=new Kn({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:r,currDepVals:i,prevVal:s})=>{var o,a,c,l;const u=s,h=r?.[0],f=i[0],p=Object.values(f.fieldMetaBase),g=p.some(F=>F?.isValidating),m=!p.some(F=>F?.errorMap&&Kl(Object.values(F.errorMap).filter(Boolean))),b=p.some(F=>F?.isTouched),$=p.some(F=>F?.isBlurred),x=b&&((o=f?.errorMap)==null?void 0:o.onMount),E=p.some(F=>F?.isDirty),N=!E,C=!!((a=f.errorMap)!=null&&a.onMount||p.some(F=>{var W;return(W=F?.errorMap)==null?void 0:W.onMount})),O=!!g;let k=u?.errors??[];(!h||f.errorMap!==h.errorMap)&&(k=Object.values(f.errorMap).reduce((F,W)=>W===void 0?F:W&&gs(W)?(F.push(W.form),F):(F.push(W),F),[]));const M=k.length===0,B=m&&M,T=f.submissionAttempts===0&&!b&&!C||!O&&!f.isSubmitting&&B;let j=f.errorMap;if(x&&(k=k.filter(F=>F!==f.errorMap.onMount),j=Object.assign(j,{onMount:void 0})),u&&h&&u.errorMap===j&&u.fieldMeta===this.fieldMetaDerived.state&&u.errors===k&&u.isFieldsValidating===g&&u.isFieldsValid===m&&u.isFormValid===M&&u.isValid===B&&u.canSubmit===T&&u.isTouched===b&&u.isBlurred===$&&u.isPristine===N&&u.isDirty===E&&xn(h,f))return u;let Z={...f,errorMap:j,fieldMeta:this.fieldMetaDerived.state,errors:k,isFieldsValidating:g,isFieldsValid:m,isFormValid:M,isValid:B,canSubmit:T,isTouched:b,isBlurred:$,isPristine:N,isDirty:E};const ie=((c=this.options.transform)==null?void 0:c.deps)??[];if(ie.length!==this.prevTransformArray.length||ie.some((F,W)=>F!==this.prevTransformArray[W])){const F=Object.assign({},this,{state:Z});(l=this.options.transform)==null||l.fn(F),Z=F.state,this.prevTransformArray=ie}return Z}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(e||{})}get state(){return this.store.state}runValidator(e){return vs(e.validate)?bs[e.type](e.value,e.validate):e.validate(e.value)}async handleSubmit(e){var n,r,i,s,o,a;if(this.baseStore.setState(l=>({...l,isSubmitted:!1,submissionAttempts:l.submissionAttempts+1,isSubmitSuccessful:!1})),!this.state.canSubmit)return;this.baseStore.setState(l=>({...l,isSubmitting:!0}));const c=()=>{this.baseStore.setState(l=>({...l,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){c(),(r=(n=this.options).onSubmitInvalid)==null||r.call(n,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){c(),(s=(i=this.options).onSubmitInvalid)==null||s.call(i,{value:this.state.values,formApi:this});return}we(()=>{Object.values(this.fieldInfo).forEach(l=>{var u,h,f;(f=(h=(u=l.instance)==null?void 0:u.options.listeners)==null?void 0:h.onSubmit)==null||f.call(h,{value:l.instance.state.value,fieldApi:l.instance})})});try{await((a=(o=this.options).onSubmit)==null?void 0:a.call(o,{value:this.state.values,formApi:this,meta:e??this.options.onSubmitMeta})),we(()=>{this.baseStore.setState(l=>({...l,isSubmitted:!0,isSubmitSuccessful:!0})),c()})}catch(l){throw this.baseStore.setState(u=>({...u,isSubmitSuccessful:!1})),c(),l}}setErrorMap(e){this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,...e}}))}}function zn(t){if(t){if(gs(t)){const e=zn(t.form).formError,n=t.fields;return{formError:e,fieldErrors:n}}return{formError:t}}return{formError:void 0}}function Pt(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class Vl{constructor(e){this.options={},this.mount=()=>{var n,r;const i=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const s=this.getInfo();s.instance=this,this.update(this.options);const{onMount:o}=this.options.validators||{};if(o){const a=this.runValidator({validate:o,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});a&&this.setMeta(c=>({...c,errorMap:{...c?.errorMap,onMount:a}}))}return(r=(n=this.options.listeners)==null?void 0:n.onMount)==null||r.call(n,{value:this.state.value,fieldApi:this}),i},this.update=n=>{if(this.state.value===void 0){const r=ms(n.form.options.defaultValues,n.name);n.defaultValue!==void 0?this.setValue(n.defaultValue,{dontUpdateMeta:!0}):r!==void 0&&this.setValue(r,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta),this.options=n,this.name=n.name},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(n,r)=>{var i,s;this.form.setFieldValue(this.name,n,r),(s=(i=this.options.listeners)==null?void 0:i.onChange)==null||s.call(i,{value:this.state.value,fieldApi:this}),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=n=>this.form.setFieldMeta(this.name,n),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(n,r)=>{var i,s;this.form.pushFieldValue(this.name,n,r),(s=(i=this.options.listeners)==null?void 0:i.onChange)==null||s.call(i,{value:this.state.value,fieldApi:this})},this.insertValue=(n,r,i)=>{var s,o;this.form.insertFieldValue(this.name,n,r,i),(o=(s=this.options.listeners)==null?void 0:s.onChange)==null||o.call(s,{value:this.state.value,fieldApi:this})},this.replaceValue=(n,r,i)=>{var s,o;this.form.replaceFieldValue(this.name,n,r,i),(o=(s=this.options.listeners)==null?void 0:s.onChange)==null||o.call(s,{value:this.state.value,fieldApi:this})},this.removeValue=(n,r)=>{var i,s;this.form.removeFieldValue(this.name,n,r),(s=(i=this.options.listeners)==null?void 0:i.onChange)==null||s.call(i,{value:this.state.value,fieldApi:this})},this.swapValues=(n,r,i)=>{var s,o;this.form.swapFieldValues(this.name,n,r,i),(o=(s=this.options.listeners)==null?void 0:s.onChange)==null||o.call(s,{value:this.state.value,fieldApi:this})},this.moveValue=(n,r,i)=>{var s,o;this.form.moveFieldValues(this.name,n,r,i),(o=(s=this.options.listeners)==null?void 0:s.onChange)==null||o.call(s,{value:this.state.value,fieldApi:this})},this.getLinkedFields=n=>{const r=Object.values(this.form.fieldInfo),i=[];for(const s of r){if(!s.instance)continue;const{onChangeListenTo:o,onBlurListenTo:a}=s.instance.options.validators||{};n==="change"&&o?.includes(this.name)&&i.push(s.instance),n==="blur"&&a?.includes(this.name)&&i.push(s.instance)}return i},this.validateSync=(n,r)=>{const i=Vn(n,this.options),o=this.getLinkedFields(n).reduce((l,u)=>{const h=Vn(n,u.options);return h.forEach(f=>{f.field=u}),l.concat(h)},[]);let a=!1;we(()=>{const l=(u,h)=>{const f=ct(h.cause),p=h.validate?ti(u.runValidator({validate:h.validate,value:{value:u.store.state.value,validationSource:"field",fieldApi:u},type:"validate"})):r[f];u.state.meta.errorMap[f]!==p&&u.setMeta(g=>({...g,errorMap:{...g.errorMap,[ct(h.cause)]:p||r[f]}})),(p||r[f])&&(a=!0)};for(const u of i)l(this,u);for(const u of o)u.validate&&l(u.field,u)});const c=ct("submit");return this.state.meta.errorMap[c]&&n!=="submit"&&!a&&this.setMeta(l=>({...l,errorMap:{...l.errorMap,[c]:void 0}})),{hasErrored:a}},this.validateAsync=async(n,r)=>{const i=_n(n,this.options),s=await r,o=this.getLinkedFields(n),a=o.reduce((f,p)=>{const g=_n(n,p.options);return g.forEach(m=>{m.field=p}),f.concat(g)},[]);this.state.meta.isValidating||this.setMeta(f=>({...f,isValidating:!0}));for(const f of o)f.setMeta(p=>({...p,isValidating:!0}));const c=[],l=[],u=(f,p,g)=>{const m=ct(p.cause),b=f.getInfo().validationMetaMap[m];b?.lastAbortController.abort();const $=new AbortController;this.getInfo().validationMetaMap[m]={lastAbortController:$},g.push(new Promise(async x=>{var E;let N;try{N=await new Promise((M,B)=>{this.timeoutIds[p.cause]&&clearTimeout(this.timeoutIds[p.cause]),this.timeoutIds[p.cause]=setTimeout(async()=>{if($.signal.aborted)return M(void 0);try{M(await this.runValidator({validate:p.validate,value:{value:f.store.state.value,fieldApi:f,signal:$.signal,validationSource:"field"},type:"validateAsync"}))}catch(T){B(T)}},p.debounceMs)})}catch(M){N=M}if($.signal.aborted)return x(void 0);const C=ti(N),O=(E=s[this.name])==null?void 0:E[m],k=C||O;f.setMeta(M=>({...M,errorMap:{...M?.errorMap,[m]:k}})),x(k)}))};for(const f of i)f.validate&&u(this,f,c);for(const f of a)f.validate&&u(f.field,f,l);let h=[];(c.length||l.length)&&(h=await Promise.all(c),await Promise.all(l)),this.setMeta(f=>({...f,isValidating:!1}));for(const f of o)f.setMeta(p=>({...p,isValidating:!1}));return h.filter(Boolean)},this.validate=(n,r)=>{var i;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:s}=r?.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(n),{hasErrored:o}=this.validateSync(n,s[this.name]??{});if(o&&!this.options.asyncAlways)return(i=this.getInfo().validationMetaMap[ct(n)])==null||i.lastAbortController.abort(),this.state.meta.errors;const a=r?.skipFormValidation?Promise.resolve({}):this.form.validateAsync(n);return this.validateAsync(n,a)},this.handleChange=n=>{this.setValue(n)},this.handleBlur=()=>{var n,r;this.state.meta.isTouched||(this.setMeta(s=>({...s,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(s=>({...s,isBlurred:!0})),this.validate("blur"),(r=(n=this.options.listeners)==null?void 0:n.onBlur)==null||r.call(n,{value:this.state.value,fieldApi:this})},this.form=e.form,this.name=e.name,this.timeoutIds={},this.store=new Kn({deps:[this.form.store],fn:()=>{const n=this.form.getFieldValue(this.name),r=this.form.getFieldMeta(this.name)??{...Jt,...e.defaultMeta};return{value:n,meta:r}}}),this.options=e}get state(){return this.store.state}runValidator(e){return vs(e.validate)?bs[e.type](e.value,e.validate):e.validate(e.value)}setErrorMap(e){this.setMeta(n=>({...n,errorMap:{...n.errorMap,...e}}))}}function ti(t){if(t)return t}function ct(t){switch(t){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}const Wt=typeof window<"u"?d.useLayoutEffect:d.useEffect;function zl(t){const[e]=d.useState(()=>{const r=new Vl({...t,form:t.form,name:t.name});return r.Field=ys,r});return Wt(e.mount,[e]),Wt(()=>{e.update(t)}),sn(e.store,t.mode==="array"?n=>[n.meta,Object.keys(n.value??[]).length]:void 0),e}const ys=({children:t,...e})=>{const n=zl(e),r=d.useMemo(()=>on(t,n),[t,n,n.state.value,n.state.meta]);return S.jsx(S.Fragment,{children:r})};function Jl({form:t,selector:e,children:n}){const r=sn(t.store,e);return on(n,r)}function Wl(t){const[e]=d.useState(()=>{const n=new _l(t),r=n;return r.Field=function(s){return S.jsx(ys,{...s,form:n})},r.Subscribe=i=>S.jsx(Jl,{form:n,selector:i.selector,children:i.children}),r});return Wt(e.mount,[]),sn(e.store,n=>n.isSubmitting),Wt(()=>{e.update(t)}),e}function Hl(){const t=d.createContext(null);function e(){const i=d.useContext(t);if(!i)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return i}const n=d.createContext(null);function r(){const i=d.useContext(n);if(!i)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return i}return{fieldContext:t,useFieldContext:e,useFormContext:r,formContext:n}}function Gl({fieldComponents:t,fieldContext:e,formContext:n,formComponents:r}){function i(o){const a=Wl(o),c=d.useMemo(()=>({children:h})=>S.jsx(n.Provider,{value:a,children:h}),[a]),l=d.useMemo(()=>({children:h,...f})=>S.jsx(a.Field,{...f,children:p=>S.jsx(e.Provider,{value:p,children:h(Object.assign(p,t))})}),[a]);return d.useMemo(()=>Object.assign(a,{AppField:l,AppForm:c,...r}),[a,l,c])}function s({render:o,props:a}){return c=>o({...a,...c})}return{useAppForm:i,withForm:s}}const bt=t=>{const e=le.c(5),{meta:n}=t,r=d.useId();if(!n.isTouched)return null;let i;if(e[0]!==r||e[1]!==n.errors){let s;e[3]!==r?(s=o=>{const{message:a}=o;return S.jsx("p",{className:"text-sm font-medium text-destructive",children:a},r)},e[3]=r,e[4]=s):s=e[4],i=n.errors.map(s),e[0]=r,e[1]=n.errors,e[2]=i}else i=e[2];return i};function Zl(t){const e=le.c(23);let n,r;e[0]!==t?({label:r,...n}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);const i=Ot(),s=n.type==="number"&&typeof i.state.value=="number"?String(i.state.value):i.state.value;let o;e[3]!==i.name||e[4]!==r?(o=S.jsx(gt,{htmlFor:i.name,children:r}),e[3]=i.name,e[4]=r,e[5]=o):o=e[5];let a;e[6]!==i||e[7]!==n.type?(a=f=>{n.type==="number"?i.handleChange(Number(f.target.value)):i.handleChange(f.target.value)},e[6]=i,e[7]=n.type,e[8]=a):a=e[8];let c;e[9]!==s||e[10]!==i.handleBlur||e[11]!==i.name||e[12]!==n||e[13]!==a?(c=S.jsx(xr,{id:i.name,value:s,onChange:a,onBlur:i.handleBlur,...n}),e[9]=s,e[10]=i.handleBlur,e[11]=i.name,e[12]=n,e[13]=a,e[14]=c):c=e[14];let l;e[15]!==o||e[16]!==c?(l=S.jsxs("div",{className:"space-y-1",children:[o,c]}),e[15]=o,e[16]=c,e[17]=l):l=e[17];let u;e[18]!==i.state.meta?(u=S.jsx(bt,{meta:i.state.meta}),e[18]=i.state.meta,e[19]=u):u=e[19];let h;return e[20]!==l||e[21]!==u?(h=S.jsxs("div",{className:"space-y-2",children:[l,u]}),e[20]=l,e[21]=u,e[22]=h):h=e[22],h}function Ql(t){const e=le.c(4),{children:n,className:r}=t,i=wg(),[s,o]=sn(i.store,Yl),a=`${r} ${s||!o?"opacity-50":""}`,c=s||!o;let l;return e[0]!==n||e[1]!==a||e[2]!==c?(l=S.jsx(ds,{className:a,type:"submit",disabled:c,children:n}),e[0]=n,e[1]=a,e[2]=c,e[3]=l):l=e[3],l}function Yl(t){return[t.isSubmitting,t.canSubmit]}function Xl(){const t=le.c(21),[e,n]=d.useState(!1),r=Ot();let i;t[0]!==r.name?(i=S.jsx(gt,{htmlFor:r.name,children:"Password"}),t[0]=r.name,t[1]=i):i=t[1];const s=e?"text":"password";let o;t[2]!==r?(o=p=>{r.handleChange(p.target.value)},t[2]=r,t[3]=o):o=t[3];let a;t[4]!==r.handleBlur||t[5]!==r.name||t[6]!==r.state.value||t[7]!==s||t[8]!==o?(a=S.jsx(xr,{id:"password",className:"",type:s,required:!0,name:r.name,value:r.state.value,onChange:o,onBlur:r.handleBlur}),t[4]=r.handleBlur,t[5]=r.name,t[6]=r.state.value,t[7]=s,t[8]=o,t[9]=a):a=t[9];let c;t[10]===Symbol.for("react.memo_cache_sentinel")?(c=S.jsx("button",{type:"button",className:"absolute   right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 transition-colors",tabIndex:-1,onClick:()=>n(ec),children:S.jsx(hl,{className:"size-5"})}),t[10]=c):c=t[10];let l;t[11]!==a?(l=S.jsxs("div",{className:"relative",children:[a,c]}),t[11]=a,t[12]=l):l=t[12];let u;t[13]!==i||t[14]!==l?(u=S.jsxs("div",{className:"space-y-1",children:[i,l]}),t[13]=i,t[14]=l,t[15]=u):u=t[15];let h;t[16]!==r.state.meta?(h=S.jsx(bt,{meta:r.state.meta}),t[16]=r.state.meta,t[17]=h):h=t[17];let f;return t[18]!==u||t[19]!==h?(f=S.jsxs("div",{className:"space-y-2",children:[u,h]}),t[18]=u,t[19]=h,t[20]=f):f=t[20],f}function ec(t){return!t}function tc(t){const e=le.c(21),{label:n,className:r,toolTip:i}=t,s=Ot(),o=s.name;let a;e[0]!==r?(a=Le("peer has-checked:bg-indigo-600 border text-3xl font-bold size-10 flex items-center justify-center rounded-xl border-transparent cursor-pointer",r),e[0]=r,e[1]=a):a=e[1];let c;e[2]!==s?(c=g=>s.handleChange(g.target.checked),e[2]=s,e[3]=c):c=e[3];let l;e[4]!==s.name||e[5]!==s.state.value||e[6]!==c?(l=S.jsx(xr,{id:s.name,className:"sr-only",type:"checkbox",defaultChecked:s.state.value,onChange:c}),e[4]=s.name,e[5]=s.state.value,e[6]=c,e[7]=l):l=e[7];let u;e[8]!==s.name||e[9]!==n||e[10]!==a||e[11]!==l?(u=S.jsx(Ua,{asChild:!0,children:S.jsx("div",{className:"flex focus-within:outline-2 rounded-xl focus-within:outline-amber-600  ",children:S.jsxs(gt,{htmlFor:o,className:a,children:[l,n]})})}),e[8]=s.name,e[9]=n,e[10]=a,e[11]=l,e[12]=u):u=e[12];let h;e[13]!==i?(h=S.jsx(_a,{children:i}),e[13]=i,e[14]=h):h=e[14];let f;e[15]!==s.state.meta?(f=S.jsx(bt,{meta:s.state.meta}),e[15]=s.state.meta,e[16]=f):f=e[16];let p;return e[17]!==u||e[18]!==h||e[19]!==f?(p=S.jsxs(Va,{children:[u,h,f]}),e[17]=u,e[18]=h,e[19]=f,e[20]=p):p=e[20],p}function nc(t,e,n){var r=this,i=d.useRef(null),s=d.useRef(0),o=d.useRef(null),a=d.useRef([]),c=d.useRef(),l=d.useRef(),u=d.useRef(t),h=d.useRef(!0);u.current=t;var f=typeof window<"u",p=!e&&e!==0&&f;if(typeof t!="function")throw new TypeError("Expected a function");e=+e||0;var g=!!(n=n||{}).leading,m=!("trailing"in n)||!!n.trailing,b="maxWait"in n,$="debounceOnServer"in n&&!!n.debounceOnServer,x=b?Math.max(+n.maxWait||0,e):null;d.useEffect(function(){return h.current=!0,function(){h.current=!1}},[]);var E=d.useMemo(function(){var N=function(T){var j=a.current,Z=c.current;return a.current=c.current=null,s.current=T,l.current=u.current.apply(Z,j)},C=function(T,j){p&&cancelAnimationFrame(o.current),o.current=p?requestAnimationFrame(T):setTimeout(T,j)},O=function(T){if(!h.current)return!1;var j=T-i.current;return!i.current||j>=e||j<0||b&&T-s.current>=x},k=function(T){return o.current=null,m&&a.current?N(T):(a.current=c.current=null,l.current)},M=function T(){var j=Date.now();if(O(j))return k(j);if(h.current){var Z=e-(j-i.current),ie=b?Math.min(Z,x-(j-s.current)):Z;C(T,ie)}},B=function(){if(f||$){var T=Date.now(),j=O(T);if(a.current=[].slice.call(arguments),c.current=r,i.current=T,j){if(!o.current&&h.current)return s.current=i.current,C(M,e),g?N(i.current):l.current;if(b)return C(M,e),N(i.current)}return o.current||C(M,e),l.current}};return B.cancel=function(){o.current&&(p?cancelAnimationFrame(o.current):clearTimeout(o.current)),s.current=0,a.current=i.current=c.current=o.current=null},B.isPending=function(){return!!o.current},B.flush=function(){return o.current?k(Date.now()):l.current},B},[g,b,e,x,m,p,f,$]);return E}function rc(t,e){return t===e}function ic(t,e,n){var r=rc,i=d.useRef(t),s=d.useState({})[1],o=nc(d.useCallback(function(c){i.current=c,s({})},[s]),e,n),a=d.useRef(t);return r(a.current,t)||(o(t),a.current=t),[i.current,o]}var ni=1,sc=.9,oc=.8,ac=.17,Sn=.1,En=.999,lc=.9999,cc=.99,uc=/[\\\/_+.#"@\[\(\{&]/,dc=/[\\\/_+.#"@\[\(\{&]/g,hc=/[\s-]/,$s=/[\s-]/g;function Jn(t,e,n,r,i,s,o){if(s===e.length)return i===t.length?ni:cc;var a=`${i},${s}`;if(o[a]!==void 0)return o[a];for(var c=r.charAt(s),l=n.indexOf(c,i),u=0,h,f,p,g;l>=0;)h=Jn(t,e,n,r,l+1,s+1,o),h>u&&(l===i?h*=ni:uc.test(t.charAt(l-1))?(h*=oc,p=t.slice(i,l-1).match(dc),p&&i>0&&(h*=Math.pow(En,p.length))):hc.test(t.charAt(l-1))?(h*=sc,g=t.slice(i,l-1).match($s),g&&i>0&&(h*=Math.pow(En,g.length))):(h*=ac,i>0&&(h*=Math.pow(En,l-i))),t.charAt(l)!==e.charAt(s)&&(h*=lc)),(h<Sn&&n.charAt(l-1)===r.charAt(s+1)||r.charAt(s+1)===r.charAt(s)&&n.charAt(l-1)!==r.charAt(s))&&(f=Jn(t,e,n,r,l+1,s+2,o),f*Sn>h&&(h=f*Sn)),h>u&&(u=h),l=n.indexOf(c,l+1);return o[a]=u,u}function ri(t){return t.toLowerCase().replace($s," ")}function fc(t,e,n){return t=n&&n.length>0?`${t+" "+n.join(" ")}`:t,Jn(t,e,ri(t),ri(e),0,0,{})}function ne(){return ne=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ne.apply(null,arguments)}function Qe(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}function pc(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function xs(...t){return e=>t.forEach(n=>pc(n,e))}function vt(...t){return d.useCallback(xs(...t),t)}function mc(t,e){const n=d.createContext(e);function r(s){const{children:o,...a}=s,c=d.useMemo(()=>a,Object.values(a));return d.createElement(n.Provider,{value:c},o)}function i(s){const o=d.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${t}\``)}return r.displayName=t+"Provider",[r,i]}function gc(t,e=[]){let n=[];function r(s,o){const a=d.createContext(o),c=n.length;n=[...n,o];function l(h){const{scope:f,children:p,...g}=h,m=f?.[t][c]||a,b=d.useMemo(()=>g,Object.values(g));return d.createElement(m.Provider,{value:b},p)}function u(h,f){const p=f?.[t][c]||a,g=d.useContext(p);if(g)return g;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${s}\``)}return l.displayName=s+"Provider",[l,u]}const i=()=>{const s=n.map(o=>d.createContext(o));return function(a){const c=a?.[t]||s;return d.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return i.scopeName=t,[r,bc(i,...e)]}function bc(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:l})=>{const h=c(s)[`__scope${l}`];return{...a,...h}},{});return d.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}const vc=globalThis?.document?d.useLayoutEffect:()=>{},yc=za.useId||(()=>{});let $c=0;function kn(t){const[e,n]=d.useState(yc());return vc(()=>{n(r=>r??String($c++))},[t]),t||(e?`radix-${e}`:"")}function ws(t){const e=d.useRef(t);return d.useEffect(()=>{e.current=t}),d.useMemo(()=>(...n)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...n)},[])}function xc({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,i]=wc({defaultProp:e,onChange:n}),s=t!==void 0,o=s?t:r,a=ws(n),c=d.useCallback(l=>{if(s){const h=typeof l=="function"?l(t):l;h!==t&&a(h)}else i(l)},[s,t,i,a]);return[o,c]}function wc({defaultProp:t,onChange:e}){const n=d.useState(t),[r]=n,i=d.useRef(r),s=ws(e);return d.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),n}function Sc(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function Ec(...t){return e=>t.forEach(n=>Sc(n,e))}const Ss=d.forwardRef((t,e)=>{const{children:n,...r}=t,i=d.Children.toArray(n),s=i.find(Mc);if(s){const o=s.props.children,a=i.map(c=>c===s?d.Children.count(o)>1?d.Children.only(null):d.isValidElement(o)?o.props.children:null:c);return d.createElement(Wn,ne({},r,{ref:e}),d.isValidElement(o)?d.cloneElement(o,void 0,a):null)}return d.createElement(Wn,ne({},r,{ref:e}),n)});Ss.displayName="Slot";const Wn=d.forwardRef((t,e)=>{const{children:n,...r}=t;return d.isValidElement(n)?d.cloneElement(n,{...Ac(r,n.props),ref:e?Ec(e,n.ref):n.ref}):d.Children.count(n)>1?d.Children.only(null):null});Wn.displayName="SlotClone";const kc=({children:t})=>d.createElement(d.Fragment,null,t);function Mc(t){return d.isValidElement(t)&&t.type===kc}function Ac(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}const Nc=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],de=Nc.reduce((t,e)=>{const n=d.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Ss:e;return d.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),d.createElement(a,ne({},o,{ref:i}))});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function Cc(t,e){t&&hs.flushSync(()=>t.dispatchEvent(e))}function Er(t){const e=d.useRef(t);return d.useEffect(()=>{e.current=t}),d.useMemo(()=>(...n)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...n)},[])}function Oc(t,e=globalThis?.document){const n=Er(t);d.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[n,e])}const Hn="dismissableLayer.update",Ic="dismissableLayer.pointerDownOutside",Rc="dismissableLayer.focusOutside";let ii;const Fc=d.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Dc=d.forwardRef((t,e)=>{var n;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:i,onPointerDownOutside:s,onFocusOutside:o,onInteractOutside:a,onDismiss:c,...l}=t,u=d.useContext(Fc),[h,f]=d.useState(null),p=(n=h?.ownerDocument)!==null&&n!==void 0?n:globalThis?.document,[,g]=d.useState({}),m=vt(e,M=>f(M)),b=Array.from(u.layers),[$]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),x=b.indexOf($),E=h?b.indexOf(h):-1,N=u.layersWithOutsidePointerEventsDisabled.size>0,C=E>=x,O=Pc(M=>{const B=M.target,T=[...u.branches].some(j=>j.contains(B));!C||T||(s?.(M),a?.(M),M.defaultPrevented||c?.())},p),k=Tc(M=>{const B=M.target;[...u.branches].some(j=>j.contains(B))||(o?.(M),a?.(M),M.defaultPrevented||c?.())},p);return Oc(M=>{E===u.layers.size-1&&(i?.(M),!M.defaultPrevented&&c&&(M.preventDefault(),c()))},p),d.useEffect(()=>{if(h)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(ii=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),si(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=ii)}},[h,p,r,u]),d.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),si())},[h,u]),d.useEffect(()=>{const M=()=>g({});return document.addEventListener(Hn,M),()=>document.removeEventListener(Hn,M)},[]),d.createElement(de.div,ne({},l,{ref:m,style:{pointerEvents:N?C?"auto":"none":void 0,...t.style},onFocusCapture:Qe(t.onFocusCapture,k.onFocusCapture),onBlurCapture:Qe(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:Qe(t.onPointerDownCapture,O.onPointerDownCapture)}))});function Pc(t,e=globalThis?.document){const n=Er(t),r=d.useRef(!1),i=d.useRef(()=>{});return d.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let l=function(){Es(Ic,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function Tc(t,e=globalThis?.document){const n=Er(t),r=d.useRef(!1);return d.useEffect(()=>{const i=s=>{s.target&&!r.current&&Es(Rc,n,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function si(){const t=new CustomEvent(Hn);document.dispatchEvent(t)}function Es(t,e,n,{discrete:r}){const i=n.originalEvent.target,s=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?Cc(i,s):i.dispatchEvent(s)}function oi(t){const e=d.useRef(t);return d.useEffect(()=>{e.current=t}),d.useMemo(()=>(...n)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...n)},[])}const Mn="focusScope.autoFocusOnMount",An="focusScope.autoFocusOnUnmount",ai={bubbles:!1,cancelable:!0},Bc=d.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=t,[a,c]=d.useState(null),l=oi(i),u=oi(s),h=d.useRef(null),f=vt(e,m=>c(m)),p=d.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;d.useEffect(()=>{if(r){let m=function(E){if(p.paused||!a)return;const N=E.target;a.contains(N)?h.current=N:Se(h.current,{select:!0})},b=function(E){if(p.paused||!a)return;const N=E.relatedTarget;N!==null&&(a.contains(N)||Se(h.current,{select:!0}))},$=function(E){if(document.activeElement===document.body)for(const C of E)C.removedNodes.length>0&&Se(a)};document.addEventListener("focusin",m),document.addEventListener("focusout",b);const x=new MutationObserver($);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",b),x.disconnect()}}},[r,a,p.paused]),d.useEffect(()=>{if(a){ci.add(p);const m=document.activeElement;if(!a.contains(m)){const $=new CustomEvent(Mn,ai);a.addEventListener(Mn,l),a.dispatchEvent($),$.defaultPrevented||(jc(_c(ks(a)),{select:!0}),document.activeElement===m&&Se(a))}return()=>{a.removeEventListener(Mn,l),setTimeout(()=>{const $=new CustomEvent(An,ai);a.addEventListener(An,u),a.dispatchEvent($),$.defaultPrevented||Se(m??document.body,{select:!0}),a.removeEventListener(An,u),ci.remove(p)},0)}}},[a,l,u,p]);const g=d.useCallback(m=>{if(!n&&!r||p.paused)return;const b=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,$=document.activeElement;if(b&&$){const x=m.currentTarget,[E,N]=Kc(x);E&&N?!m.shiftKey&&$===N?(m.preventDefault(),n&&Se(E,{select:!0})):m.shiftKey&&$===E&&(m.preventDefault(),n&&Se(N,{select:!0})):$===x&&m.preventDefault()}},[n,r,p.paused]);return d.createElement(de.div,ne({tabIndex:-1},o,{ref:f,onKeyDown:g}))});function jc(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(Se(r,{select:e}),document.activeElement!==n)return}function Kc(t){const e=ks(t),n=li(e,t),r=li(e.reverse(),t);return[n,r]}function ks(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function li(t,e){for(const n of t)if(!Lc(n,{upTo:e}))return n}function Lc(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function qc(t){return t instanceof HTMLInputElement&&"select"in t}function Se(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&qc(t)&&e&&t.select()}}const ci=Uc();function Uc(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=ui(t,e),t.unshift(e)},remove(e){var n;t=ui(t,e),(n=t[0])===null||n===void 0||n.resume()}}}function ui(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function _c(t){return t.filter(e=>e.tagName!=="A")}const Vc=d.forwardRef((t,e)=>{var n;const{container:r=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...i}=t;return r?Ja.createPortal(d.createElement(de.div,ne({},i,{ref:e})),r):null}),di=globalThis?.document?d.useLayoutEffect:()=>{};function zc(t,e){return d.useReducer((n,r)=>{const i=e[n][r];return i??n},t)}const an=t=>{const{present:e,children:n}=t,r=Jc(e),i=typeof n=="function"?n({present:r.isPresent}):d.Children.only(n),s=vt(r.ref,i.ref);return typeof n=="function"||r.isPresent?d.cloneElement(i,{ref:s}):null};an.displayName="Presence";function Jc(t){const[e,n]=d.useState(),r=d.useRef({}),i=d.useRef(t),s=d.useRef("none"),o=t?"mounted":"unmounted",[a,c]=zc(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return d.useEffect(()=>{const l=Tt(r.current);s.current=a==="mounted"?l:"none"},[a]),di(()=>{const l=r.current,u=i.current;if(u!==t){const f=s.current,p=Tt(l);t?c("MOUNT"):p==="none"||l?.display==="none"?c("UNMOUNT"):c(u&&f!==p?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),di(()=>{if(e){const l=h=>{const p=Tt(r.current).includes(h.animationName);h.target===e&&p&&hs.flushSync(()=>c("ANIMATION_END"))},u=h=>{h.target===e&&(s.current=Tt(r.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",l),e.addEventListener("animationend",l),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",l),e.removeEventListener("animationend",l)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:d.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function Tt(t){return t?.animationName||"none"}let Nn=0;function Wc(){d.useEffect(()=>{var t,e;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(t=n[0])!==null&&t!==void 0?t:hi()),document.body.insertAdjacentElement("beforeend",(e=n[1])!==null&&e!==void 0?e:hi()),Nn++,()=>{Nn===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),Nn--}},[])}function hi(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",t}var Ms=Wa(),Cn=function(){},ln=d.forwardRef(function(t,e){var n=d.useRef(null),r=d.useState({onScrollCapture:Cn,onWheelCapture:Cn,onTouchMoveCapture:Cn}),i=r[0],s=r[1],o=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,u=t.enabled,h=t.shards,f=t.sideCar,p=t.noIsolation,g=t.inert,m=t.allowPinchZoom,b=t.as,$=b===void 0?"div":b,x=Ha(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),E=f,N=Ga([n,e]),C=He(He({},x),i);return d.createElement(d.Fragment,null,u&&d.createElement(E,{sideCar:Ms,removeScrollBar:l,shards:h,noIsolation:p,inert:g,setCallbacks:s,allowPinchZoom:!!m,lockRef:n}),o?d.cloneElement(d.Children.only(a),He(He({},C),{ref:N})):d.createElement($,He({},C,{className:c,ref:N}),a))});ln.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ln.classNames={fullWidth:Qa,zeroRight:Za};var Gn=!1;if(typeof window<"u")try{var Bt=Object.defineProperty({},"passive",{get:function(){return Gn=!0,!0}});window.addEventListener("test",Bt,Bt),window.removeEventListener("test",Bt,Bt)}catch{Gn=!1}var Ve=Gn?{passive:!1}:!1,Hc=function(t){return t.tagName==="TEXTAREA"},As=function(t,e){var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Hc(t)&&n[e]==="visible")},Gc=function(t){return As(t,"overflowY")},Zc=function(t){return As(t,"overflowX")},fi=function(t,e){var n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var r=Ns(t,n);if(r){var i=Cs(t,n),s=i[1],o=i[2];if(s>o)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},Qc=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},Yc=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},Ns=function(t,e){return t==="v"?Gc(e):Zc(e)},Cs=function(t,e){return t==="v"?Qc(e):Yc(e)},Xc=function(t,e){return t==="h"&&e==="rtl"?-1:1},eu=function(t,e,n,r,i){var s=Xc(t,window.getComputedStyle(e).direction),o=s*r,a=n.target,c=e.contains(a),l=!1,u=o>0,h=0,f=0;do{var p=Cs(t,a),g=p[0],m=p[1],b=p[2],$=m-b-s*g;(g||$)&&Ns(t,a)&&(h+=$,f+=g),a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(u&&h===0||!u&&f===0)&&(l=!0),l},jt=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},pi=function(t){return[t.deltaX,t.deltaY]},mi=function(t){return t&&"current"in t?t.current:t},tu=function(t,e){return t[0]===e[0]&&t[1]===e[1]},nu=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},ru=0,ze=[];function iu(t){var e=d.useRef([]),n=d.useRef([0,0]),r=d.useRef(),i=d.useState(ru++)[0],s=d.useState(function(){return Ya()})[0],o=d.useRef(t);d.useEffect(function(){o.current=t},[t]),d.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var m=Xa([t.lockRef.current],(t.shards||[]).map(mi),!0).filter(Boolean);return m.forEach(function(b){return b.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),m.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=d.useCallback(function(m,b){if("touches"in m&&m.touches.length===2)return!o.current.allowPinchZoom;var $=jt(m),x=n.current,E="deltaX"in m?m.deltaX:x[0]-$[0],N="deltaY"in m?m.deltaY:x[1]-$[1],C,O=m.target,k=Math.abs(E)>Math.abs(N)?"h":"v";if("touches"in m&&k==="h"&&O.type==="range")return!1;var M=fi(k,O);if(!M)return!0;if(M?C=k:(C=k==="v"?"h":"v",M=fi(k,O)),!M)return!1;if(!r.current&&"changedTouches"in m&&(E||N)&&(r.current=C),!C)return!0;var B=r.current||C;return eu(B,b,m,B==="h"?E:N)},[]),c=d.useCallback(function(m){var b=m;if(!(!ze.length||ze[ze.length-1]!==s)){var $="deltaY"in b?pi(b):jt(b),x=e.current.filter(function(C){return C.name===b.type&&C.target===b.target&&tu(C.delta,$)})[0];if(x&&x.should){b.cancelable&&b.preventDefault();return}if(!x){var E=(o.current.shards||[]).map(mi).filter(Boolean).filter(function(C){return C.contains(b.target)}),N=E.length>0?a(b,E[0]):!o.current.noIsolation;N&&b.cancelable&&b.preventDefault()}}},[]),l=d.useCallback(function(m,b,$,x){var E={name:m,delta:b,target:$,should:x};e.current.push(E),setTimeout(function(){e.current=e.current.filter(function(N){return N!==E})},1)},[]),u=d.useCallback(function(m){n.current=jt(m),r.current=void 0},[]),h=d.useCallback(function(m){l(m.type,pi(m),m.target,a(m,t.lockRef.current))},[]),f=d.useCallback(function(m){l(m.type,jt(m),m.target,a(m,t.lockRef.current))},[]);d.useEffect(function(){return ze.push(s),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:f}),document.addEventListener("wheel",c,Ve),document.addEventListener("touchmove",c,Ve),document.addEventListener("touchstart",u,Ve),function(){ze=ze.filter(function(m){return m!==s}),document.removeEventListener("wheel",c,Ve),document.removeEventListener("touchmove",c,Ve),document.removeEventListener("touchstart",u,Ve)}},[]);var p=t.removeScrollBar,g=t.inert;return d.createElement(d.Fragment,null,g?d.createElement(s,{styles:nu(i)}):null,p?d.createElement(el,{gapMode:"margin"}):null)}const su=tl(Ms,iu);var Os=d.forwardRef(function(t,e){return d.createElement(ln,He({},t,{ref:e,sideCar:su}))});Os.classNames=ln.classNames;const Is=d.forwardRef((t,e)=>{const{children:n,...r}=t,i=d.Children.toArray(n),s=i.find(au);if(s){const o=s.props.children,a=i.map(c=>c===s?d.Children.count(o)>1?d.Children.only(null):d.isValidElement(o)?o.props.children:null:c);return d.createElement(Zn,ne({},r,{ref:e}),d.isValidElement(o)?d.cloneElement(o,void 0,a):null)}return d.createElement(Zn,ne({},r,{ref:e}),n)});Is.displayName="Slot";const Zn=d.forwardRef((t,e)=>{const{children:n,...r}=t;return d.isValidElement(n)?d.cloneElement(n,{...lu(r,n.props),ref:e?xs(e,n.ref):n.ref}):d.Children.count(n)>1?d.Children.only(null):null});Zn.displayName="SlotClone";const ou=({children:t})=>d.createElement(d.Fragment,null,t);function au(t){return d.isValidElement(t)&&t.type===ou}function lu(t,e){const n={...e};for(const r in e){const i=t[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...a)=>{s(...a),i(...a)}:i&&(n[r]=i):r==="style"?n[r]={...i,...s}:r==="className"&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...t,...n}}const Rs="Dialog",[Fs,Ag]=gc(Rs),[cu,qe]=Fs(Rs),uu=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=t,a=d.useRef(null),c=d.useRef(null),[l=!1,u]=xc({prop:r,defaultProp:i,onChange:s});return d.createElement(cu,{scope:e,triggerRef:a,contentRef:c,contentId:kn(),titleId:kn(),descriptionId:kn(),open:l,onOpenChange:u,onOpenToggle:d.useCallback(()=>u(h=>!h),[u]),modal:o},n)},Ds="DialogPortal",[du,Ps]=Fs(Ds,{forceMount:void 0}),hu=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,s=qe(Ds,e);return d.createElement(du,{scope:e,forceMount:n},d.Children.map(r,o=>d.createElement(an,{present:n||s.open},d.createElement(Vc,{asChild:!0,container:i},o))))},Qn="DialogOverlay",fu=d.forwardRef((t,e)=>{const n=Ps(Qn,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=qe(Qn,t.__scopeDialog);return s.modal?d.createElement(an,{present:r||s.open},d.createElement(pu,ne({},i,{ref:e}))):null}),pu=d.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=qe(Qn,n);return d.createElement(Os,{as:Is,allowPinchZoom:!0,shards:[i.contentRef]},d.createElement(de.div,ne({"data-state":Bs(i.open)},r,{ref:e,style:{pointerEvents:"auto",...r.style}})))}),et="DialogContent",mu=d.forwardRef((t,e)=>{const n=Ps(et,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,s=qe(et,t.__scopeDialog);return d.createElement(an,{present:r||s.open},s.modal?d.createElement(gu,ne({},i,{ref:e})):d.createElement(bu,ne({},i,{ref:e})))}),gu=d.forwardRef((t,e)=>{const n=qe(et,t.__scopeDialog),r=d.useRef(null),i=vt(e,n.contentRef,r);return d.useEffect(()=>{const s=r.current;if(s)return nl(s)},[]),d.createElement(Ts,ne({},t,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Qe(t.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=n.triggerRef.current)===null||o===void 0||o.focus()}),onPointerDownOutside:Qe(t.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Qe(t.onFocusOutside,s=>s.preventDefault())}))}),bu=d.forwardRef((t,e)=>{const n=qe(et,t.__scopeDialog),r=d.useRef(!1),i=d.useRef(!1);return d.createElement(Ts,ne({},t,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o;if((o=t.onCloseAutoFocus)===null||o===void 0||o.call(t,s),!s.defaultPrevented){var a;r.current||(a=n.triggerRef.current)===null||a===void 0||a.focus(),s.preventDefault()}r.current=!1,i.current=!1},onInteractOutside:s=>{var o,a;(o=t.onInteractOutside)===null||o===void 0||o.call(t,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const c=s.target;((a=n.triggerRef.current)===null||a===void 0?void 0:a.contains(c))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}}))}),Ts=d.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=t,a=qe(et,n),c=d.useRef(null),l=vt(e,c);return Wc(),d.createElement(d.Fragment,null,d.createElement(Bc,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s},d.createElement(Dc,ne({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":Bs(a.open)},o,{ref:l,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),vu="DialogTitle";function Bs(t){return t?"open":"closed"}const yu="DialogTitleWarning";mc(yu,{contentName:et,titleName:vu,docsSlug:"dialog"});const $u=uu,xu=hu,wu=fu,Su=mu;var ut='[cmdk-group=""]',On='[cmdk-group-items=""]',Eu='[cmdk-group-heading=""]',kr='[cmdk-item=""]',gi=`${kr}:not([aria-disabled="true"])`,Yn="cmdk-item-select",Fe="data-value",ku=(t,e,n)=>fc(t,e,n),js=d.createContext(void 0),yt=()=>d.useContext(js),Ks=d.createContext(void 0),Mr=()=>d.useContext(Ks),Ls=d.createContext(void 0),qs=d.forwardRef((t,e)=>{let n=Ge(()=>{var v,P;return{search:"",value:(P=(v=t.value)!=null?v:t.defaultValue)!=null?P:"",filtered:{count:0,items:new Map,groups:new Set}}}),r=Ge(()=>new Set),i=Ge(()=>new Map),s=Ge(()=>new Map),o=Ge(()=>new Set),a=Us(t),{label:c,children:l,value:u,onValueChange:h,filter:f,shouldFilter:p,loop:g,disablePointerSelection:m=!1,vimBindings:b=!0,...$}=t,x=d.useId(),E=d.useId(),N=d.useId(),C=d.useRef(null),O=Tu();Te(()=>{if(u!==void 0){let v=u.trim();n.current.value=v,k.emit()}},[u]),Te(()=>{O(6,ie)},[]);let k=d.useMemo(()=>({subscribe:v=>(o.current.add(v),()=>o.current.delete(v)),snapshot:()=>n.current,setState:(v,P,K)=>{var R,_,Q;if(!Object.is(n.current[v],P)){if(n.current[v]=P,v==="search")Z(),T(),O(1,j);else if(v==="value"&&(K||O(5,ie),((R=a.current)==null?void 0:R.value)!==void 0)){let ce=P??"";(Q=(_=a.current).onValueChange)==null||Q.call(_,ce);return}k.emit()}},emit:()=>{o.current.forEach(v=>v())}}),[]),M=d.useMemo(()=>({value:(v,P,K)=>{var R;P!==((R=s.current.get(v))==null?void 0:R.value)&&(s.current.set(v,{value:P,keywords:K}),n.current.filtered.items.set(v,B(P,K)),O(2,()=>{T(),k.emit()}))},item:(v,P)=>(r.current.add(v),P&&(i.current.has(P)?i.current.get(P).add(v):i.current.set(P,new Set([v]))),O(3,()=>{Z(),T(),n.current.value||j(),k.emit()}),()=>{s.current.delete(v),r.current.delete(v),n.current.filtered.items.delete(v);let K=he();O(4,()=>{Z(),K?.getAttribute("id")===v&&j(),k.emit()})}),group:v=>(i.current.has(v)||i.current.set(v,new Set),()=>{s.current.delete(v),i.current.delete(v)}),filter:()=>a.current.shouldFilter,label:c||t["aria-label"],disablePointerSelection:m,listId:x,inputId:N,labelId:E,listInnerRef:C}),[]);function B(v,P){var K,R;let _=(R=(K=a.current)==null?void 0:K.filter)!=null?R:ku;return v?_(v,n.current.search,P):0}function T(){if(!n.current.search||a.current.shouldFilter===!1)return;let v=n.current.filtered.items,P=[];n.current.filtered.groups.forEach(R=>{let _=i.current.get(R),Q=0;_.forEach(ce=>{let Ie=v.get(ce);Q=Math.max(Ie,Q)}),P.push([R,Q])});let K=C.current;F().sort((R,_)=>{var Q,ce;let Ie=R.getAttribute("id"),It=_.getAttribute("id");return((Q=v.get(It))!=null?Q:0)-((ce=v.get(Ie))!=null?ce:0)}).forEach(R=>{let _=R.closest(On);_?_.appendChild(R.parentElement===_?R:R.closest(`${On} > *`)):K.appendChild(R.parentElement===K?R:R.closest(`${On} > *`))}),P.sort((R,_)=>_[1]-R[1]).forEach(R=>{let _=C.current.querySelector(`${ut}[${Fe}="${encodeURIComponent(R[0])}"]`);_?.parentElement.appendChild(_)})}function j(){let v=F().find(K=>K.getAttribute("aria-disabled")!=="true"),P=v?.getAttribute(Fe);k.setState("value",P||void 0)}function Z(){var v,P,K,R;if(!n.current.search||a.current.shouldFilter===!1){n.current.filtered.count=r.current.size;return}n.current.filtered.groups=new Set;let _=0;for(let Q of r.current){let ce=(P=(v=s.current.get(Q))==null?void 0:v.value)!=null?P:"",Ie=(R=(K=s.current.get(Q))==null?void 0:K.keywords)!=null?R:[],It=B(ce,Ie);n.current.filtered.items.set(Q,It),It>0&&_++}for(let[Q,ce]of i.current)for(let Ie of ce)if(n.current.filtered.items.get(Ie)>0){n.current.filtered.groups.add(Q);break}n.current.filtered.count=_}function ie(){var v,P,K;let R=he();R&&(((v=R.parentElement)==null?void 0:v.firstChild)===R&&((K=(P=R.closest(ut))==null?void 0:P.querySelector(Eu))==null||K.scrollIntoView({block:"nearest"})),R.scrollIntoView({block:"nearest"}))}function he(){var v;return(v=C.current)==null?void 0:v.querySelector(`${kr}[aria-selected="true"]`)}function F(){var v;return Array.from((v=C.current)==null?void 0:v.querySelectorAll(gi))}function W(v){let P=F()[v];P&&k.setState("value",P.getAttribute(Fe))}function xe(v){var P;let K=he(),R=F(),_=R.findIndex(ce=>ce===K),Q=R[_+v];(P=a.current)!=null&&P.loop&&(Q=_+v<0?R[R.length-1]:_+v===R.length?R[0]:R[_+v]),Q&&k.setState("value",Q.getAttribute(Fe))}function _r(v){let P=he(),K=P?.closest(ut),R;for(;K&&!R;)K=v>0?Du(K,ut):Pu(K,ut),R=K?.querySelector(gi);R?k.setState("value",R.getAttribute(Fe)):xe(v)}let Vr=()=>W(F().length-1),zr=v=>{v.preventDefault(),v.metaKey?Vr():v.altKey?_r(1):xe(1)},Jr=v=>{v.preventDefault(),v.metaKey?W(0):v.altKey?_r(-1):xe(-1)};return d.createElement(de.div,{ref:e,tabIndex:-1,...$,"cmdk-root":"",onKeyDown:v=>{var P;if((P=$.onKeyDown)==null||P.call($,v),!v.defaultPrevented)switch(v.key){case"n":case"j":{b&&v.ctrlKey&&zr(v);break}case"ArrowDown":{zr(v);break}case"p":case"k":{b&&v.ctrlKey&&Jr(v);break}case"ArrowUp":{Jr(v);break}case"Home":{v.preventDefault(),W(0);break}case"End":{v.preventDefault(),Vr();break}case"Enter":if(!v.nativeEvent.isComposing&&v.keyCode!==229){v.preventDefault();let K=he();if(K){let R=new Event(Yn);K.dispatchEvent(R)}}}}},d.createElement("label",{"cmdk-label":"",htmlFor:M.inputId,id:M.labelId,style:ju},c),cn(t,v=>d.createElement(Ks.Provider,{value:k},d.createElement(js.Provider,{value:M},v))))}),Mu=d.forwardRef((t,e)=>{var n,r;let i=d.useId(),s=d.useRef(null),o=d.useContext(Ls),a=yt(),c=Us(t),l=(r=(n=c.current)==null?void 0:n.forceMount)!=null?r:o?.forceMount;Te(()=>{if(!l)return a.item(i,o?.id)},[l]);let u=_s(i,s,[t.value,t.children,s],t.keywords),h=Mr(),f=Be(O=>O.value&&O.value===u.current),p=Be(O=>l||a.filter()===!1?!0:O.search?O.filtered.items.get(i)>0:!0);d.useEffect(()=>{let O=s.current;if(!(!O||t.disabled))return O.addEventListener(Yn,g),()=>O.removeEventListener(Yn,g)},[p,t.onSelect,t.disabled]);function g(){var O,k;m(),(k=(O=c.current).onSelect)==null||k.call(O,u.current)}function m(){h.setState("value",u.current,!0)}if(!p)return null;let{disabled:b,value:$,onSelect:x,forceMount:E,keywords:N,...C}=t;return d.createElement(de.div,{ref:pt([s,e]),...C,id:i,"cmdk-item":"",role:"option","aria-disabled":!!b,"aria-selected":!!f,"data-disabled":!!b,"data-selected":!!f,onPointerMove:b||a.disablePointerSelection?void 0:m,onClick:b?void 0:g},t.children)}),Au=d.forwardRef((t,e)=>{let{heading:n,children:r,forceMount:i,...s}=t,o=d.useId(),a=d.useRef(null),c=d.useRef(null),l=d.useId(),u=yt(),h=Be(p=>i||u.filter()===!1?!0:p.search?p.filtered.groups.has(o):!0);Te(()=>u.group(o),[]),_s(o,a,[t.value,t.heading,c]);let f=d.useMemo(()=>({id:o,forceMount:i}),[i]);return d.createElement(de.div,{ref:pt([a,e]),...s,"cmdk-group":"",role:"presentation",hidden:h?void 0:!0},n&&d.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:l},n),cn(t,p=>d.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?l:void 0},d.createElement(Ls.Provider,{value:f},p))))}),Nu=d.forwardRef((t,e)=>{let{alwaysRender:n,...r}=t,i=d.useRef(null),s=Be(o=>!o.search);return!n&&!s?null:d.createElement(de.div,{ref:pt([i,e]),...r,"cmdk-separator":"",role:"separator"})}),Cu=d.forwardRef((t,e)=>{let{onValueChange:n,...r}=t,i=t.value!=null,s=Mr(),o=Be(u=>u.search),a=Be(u=>u.value),c=yt(),l=d.useMemo(()=>{var u;let h=(u=c.listInnerRef.current)==null?void 0:u.querySelector(`${kr}[${Fe}="${encodeURIComponent(a)}"]`);return h?.getAttribute("id")},[]);return d.useEffect(()=>{t.value!=null&&s.setState("search",t.value)},[t.value]),d.createElement(de.input,{ref:e,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":l,id:c.inputId,type:"text",value:i?t.value:o,onChange:u=>{i||s.setState("search",u.target.value),n?.(u.target.value)}})}),Ou=d.forwardRef((t,e)=>{let{children:n,label:r="Suggestions",...i}=t,s=d.useRef(null),o=d.useRef(null),a=yt();return d.useEffect(()=>{if(o.current&&s.current){let c=o.current,l=s.current,u,h=new ResizeObserver(()=>{u=requestAnimationFrame(()=>{let f=c.offsetHeight;l.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return h.observe(c),()=>{cancelAnimationFrame(u),h.unobserve(c)}}},[]),d.createElement(de.div,{ref:pt([s,e]),...i,"cmdk-list":"",role:"listbox","aria-label":r,id:a.listId},cn(t,c=>d.createElement("div",{ref:pt([o,a.listInnerRef]),"cmdk-list-sizer":""},c)))}),Iu=d.forwardRef((t,e)=>{let{open:n,onOpenChange:r,overlayClassName:i,contentClassName:s,container:o,...a}=t;return d.createElement($u,{open:n,onOpenChange:r},d.createElement(xu,{container:o},d.createElement(wu,{"cmdk-overlay":"",className:i}),d.createElement(Su,{"aria-label":t.label,"cmdk-dialog":"",className:s},d.createElement(qs,{ref:e,...a}))))}),Ru=d.forwardRef((t,e)=>Be(n=>n.filtered.count===0)?d.createElement(de.div,{ref:e,...t,"cmdk-empty":"",role:"presentation"}):null),Fu=d.forwardRef((t,e)=>{let{progress:n,children:r,label:i="Loading...",...s}=t;return d.createElement(de.div,{ref:e,...s,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},cn(t,o=>d.createElement("div",{"aria-hidden":!0},o)))}),st=Object.assign(qs,{List:Ou,Item:Mu,Input:Cu,Group:Au,Separator:Nu,Dialog:Iu,Empty:Ru,Loading:Fu});function Du(t,e){let n=t.nextElementSibling;for(;n;){if(n.matches(e))return n;n=n.nextElementSibling}}function Pu(t,e){let n=t.previousElementSibling;for(;n;){if(n.matches(e))return n;n=n.previousElementSibling}}function Us(t){let e=d.useRef(t);return Te(()=>{e.current=t}),e}var Te=typeof window>"u"?d.useEffect:d.useLayoutEffect;function Ge(t){let e=d.useRef();return e.current===void 0&&(e.current=t()),e}function pt(t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}function Be(t){let e=Mr(),n=()=>t(e.snapshot());return d.useSyncExternalStore(e.subscribe,n,n)}function _s(t,e,n,r=[]){let i=d.useRef(),s=yt();return Te(()=>{var o;let a=(()=>{var l;for(let u of n){if(typeof u=="string")return u.trim();if(typeof u=="object"&&"current"in u)return u.current?(l=u.current.textContent)==null?void 0:l.trim():i.current}})(),c=r.map(l=>l.trim());s.value(t,a,c),(o=e.current)==null||o.setAttribute(Fe,a),i.current=a}),i}var Tu=()=>{let[t,e]=d.useState(),n=Ge(()=>new Map);return Te(()=>{n.current.forEach(r=>r()),n.current=new Map},[t]),(r,i)=>{n.current.set(r,i),e({})}};function Bu(t){let e=t.type;return typeof e=="function"?e(t.props):"render"in e?e.render(t.props):t}function cn({asChild:t,children:e},n){return t&&d.isValidElement(e)?d.cloneElement(Bu(e),{ref:e.ref},n(e.props.children)):n(e)}var ju={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function Ku(t){const e=le.c(8);let n,r;e[0]!==t?({className:n,...r}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);let i;e[3]!==n?(i=Le("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",n),e[3]=n,e[4]=i):i=e[4];let s;return e[5]!==r||e[6]!==i?(s=S.jsx(st,{"data-slot":"command",className:i,...r}),e[5]=r,e[6]=i,e[7]=s):s=e[7],s}function Lu(t){const e=le.c(9);let n,r;e[0]!==t?({className:n,...r}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);let i;e[3]===Symbol.for("react.memo_cache_sentinel")?(i=S.jsx(gl,{size:20,className:"text-muted-foreground/80 me-3"}),e[3]=i):i=e[3];let s;e[4]!==n?(s=Le("placeholder:text-muted-foreground/70 flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",n),e[4]=n,e[5]=s):s=e[5];let o;return e[6]!==r||e[7]!==s?(o=S.jsxs("div",{className:"border-input flex items-center border-b px-5","cmdk-input-wrapper":"",children:[i,S.jsx(st.Input,{"data-slot":"command-input-wrapper",className:s,...r})]}),e[6]=r,e[7]=s,e[8]=o):o=e[8],o}function qu(t){const e=le.c(8);let n,r;e[0]!==t?({className:n,...r}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);let i;e[3]!==n?(i=Le("max-h-80 overflow-x-hidden overflow-y-auto",n),e[3]=n,e[4]=i):i=e[4];let s;return e[5]!==r||e[6]!==i?(s=S.jsx(st.List,{"data-slot":"command-list",className:i,...r}),e[5]=r,e[6]=i,e[7]=s):s=e[7],s}function Uu(t){const e=le.c(4);let n;e[0]!==t?({...n}=t,e[0]=t,e[1]=n):n=e[1];let r;return e[2]!==n?(r=S.jsx(st.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...n}),e[2]=n,e[3]=r):r=e[3],r}function _u(t){const e=le.c(8);let n,r;e[0]!==t?({className:n,...r}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);let i;e[3]!==n?(i=Le("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-2 [&_[cmdk-group-heading]]:px-3 [&_[cmdk-group-heading]]:py-2 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",n),e[3]=n,e[4]=i):i=e[4];let s;return e[5]!==r||e[6]!==i?(s=S.jsx(st.Group,{"data-slot":"command-group",className:i,...r}),e[5]=r,e[6]=i,e[7]=s):s=e[7],s}function Vu(t){const e=le.c(8);let n,r;e[0]!==t?({className:n,...r}=t,e[0]=t,e[1]=n,e[2]=r):(n=e[1],r=e[2]);let i;e[3]!==n?(i=Le("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground relative flex cursor-default items-center gap-3 rounded-md px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0",n),e[3]=n,e[4]=i):i=e[4];let s;return e[5]!==r||e[6]!==i?(s=S.jsx(st.Item,{"data-slot":"command-item",className:i,...r}),e[5]=r,e[6]=i,e[7]=s):s=e[7],s}function zu(){const t=le.c(54),[e]=d.useState(!1),[n,r]=d.useState(""),[i]=ic(n,500),s=i===""?"a":i,o=Ot(),a=o.state.value;let c,l;t[0]!==s?(c=["adoptme-items",s],l=async()=>rl({data:s}),t[0]=s,t[1]=c,t[2]=l):(c=t[1],l=t[2]);const u=!!s||e;let h;t[3]!==c||t[4]!==l||t[5]!==u?(h={queryKey:c,queryFn:l,enabled:u},t[3]=c,t[4]=l,t[5]=u,t[6]=h):h=t[6];const{data:f,isLoading:p,isFetching:g}=Rl(h);let m;t[7]!==f?(m=f===void 0?[]:f,t[7]=f,t[8]=m):m=t[8];const b=m;let $;t[9]===Symbol.for("react.memo_cache_sentinel")?($=S.jsx(gt,{children:"Looking for"}),t[9]=$):$=t[9];let x;if(t[10]!==o||t[11]!==a){let F;t[13]!==o?(F=(W,xe)=>S.jsxs("div",{className:"flex border bg-zinc-900 px-1 w-fit   py-1 text-sm font-semibold rounded-md",children:[S.jsx("span",{children:W}),S.jsx(ds,{onClick:()=>o.removeValue(xe),className:"ml-2 focus:outline-none p-0 h-fit bg-transparent mt-0.5 hover:bg-transparent",children:S.jsx(il,{size:12,className:"text-white"})})]},W),t[13]=o,t[14]=F):F=t[14],x=a.map(F),t[10]=o,t[11]=a,t[12]=x}else x=t[12];let E;t[15]!==x?(E=S.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:x}),t[15]=x,t[16]=E):E=t[16];let N;t[17]!==o.name||t[18]!==n?(N=S.jsx(Lu,{placeholder:"Search Adopt Me items...",value:n,className:"text-base",onValueChange:r,id:o.name}),t[17]=o.name,t[18]=n,t[19]=N):N=t[19];let C;t[20]!==g||t[21]!==p?(C=(p||g)&&S.jsx(pl,{className:"absolute right-2.5 top-2.5 w-4 h-4 animate-spin"}),t[20]=g,t[21]=p,t[22]=C):C=t[22];let O;t[23]!==C||t[24]!==N?(O=S.jsxs("div",{className:"relative",children:[N,C]}),t[23]=C,t[24]=N,t[25]=O):O=t[25];let k;t[26]!==b.length||t[27]!==p?(k=b.length===0&&!p&&S.jsx(Uu,{children:"No results found."}),t[26]=b.length,t[27]=p,t[28]=k):k=t[28];let M;t[29]!==g||t[30]!==p?(M=(p||g)&&S.jsxs("div",{className:"space-y-1 p-2",children:[S.jsx(Rt,{className:"h-8"}),S.jsx(Rt,{className:"h-8"}),S.jsx(Rt,{className:"h-8"}),S.jsx(Rt,{className:"h-8"})]}),t[29]=g,t[30]=p,t[31]=M):M=t[31];let B;if(t[32]!==b||t[33]!==o||t[34]!==a){let F;t[36]!==o||t[37]!==a?(F=W=>S.jsxs(Vu,{value:W.name,onSelect:xe=>{a.includes(xe)||o.pushValue(xe)},children:[W.name,a.includes(W.name)&&S.jsx(sl,{size:16,className:"ml-auto"})]},W.id),t[36]=o,t[37]=a,t[38]=F):F=t[38],B=b.map(F),t[32]=b,t[33]=o,t[34]=a,t[35]=B}else B=t[35];let T;t[39]!==B?(T=S.jsx(_u,{children:B}),t[39]=B,t[40]=T):T=t[40];let j;t[41]!==k||t[42]!==M||t[43]!==T?(j=S.jsxs(qu,{className:"h-32",children:[k,M,T]}),t[41]=k,t[42]=M,t[43]=T,t[44]=j):j=t[44];let Z;t[45]!==O||t[46]!==j?(Z=S.jsxs(Ku,{children:[O,j]}),t[45]=O,t[46]=j,t[47]=Z):Z=t[47];let ie;t[48]!==o.state.meta?(ie=S.jsx(bt,{meta:o.state.meta}),t[48]=o.state.meta,t[49]=ie):ie=t[49];let he;return t[50]!==Z||t[51]!==ie||t[52]!==E?(he=S.jsxs("div",{className:"*:not(:first-child):mt-2",children:[$,E,Z,ie]}),t[50]=Z,t[51]=ie,t[52]=E,t[53]=he):he=t[53],he}const $t=t=>Array.isArray(t)?t:[t],Ju=(t,e)=>{const n=[[],[]];for(const r of t)e(r)?n[0].push(r):n[1].push(r);return n},Vs=Array,Re=(t,e)=>t.includes(e),Wu=(t,e=0)=>[...new Array(t)].map((n,r)=>r+e),q=(t,e,n)=>t===void 0?e===void 0?[]:Array.isArray(e)?e:[e]:(Array.isArray(e)?t.push(...e):t.push(e),t),De=(t,e)=>e==null?t??[]:t==null?$t(e):t.concat(e),Hu=(...t)=>t.reduce(De,[]),Pe=(t,e,n)=>{if(t===void 0)return Array.isArray(e)?e:[e];const r=n?.isEqual??((i,s)=>i===s);return $t(e).forEach(i=>{t.some(s=>r(s,i))||t.push(i)}),t},zs=(t,e)=>t.reduce((n,r)=>{const i=r[e];return n[i]=q(n[i],r),n},{}),tt=(t,e,n)=>t.length===e.length&&t.every(n?.isEqual?(r,i)=>n.isEqual(r,e[i]):(r,i)=>r===e[i]),Ue=(t,e)=>fe(t)===e,fe=t=>{const e=typeof t;return e==="object"?t===null?"null":"object":e==="function"?"object":e},Ae={boolean:"boolean",null:"null",undefined:"undefined",bigint:"a bigint",number:"a number",object:"an object",string:"a string",symbol:"a symbol"},Gu={...Ae,function:"a function"};class Zu extends Error{}const X=t=>je(t,Zu),je=(t,e=Error)=>{throw new e(t)};class Qu extends Error{name="ParseError"}const y=t=>je(t,Qu),Js=t=>` ${t}`,V=(t,e)=>{const n={},r=Array.isArray(t);let i=!1;return Object.entries(t).forEach((s,o)=>{const a=r?e(o,s[1]):e(...s,o);i||=typeof a[0]=="number",(Array.isArray(a[0])||a.length===0?a:[a]).forEach(([l,u])=>{typeof l=="object"?n[l.group]=q(n[l.group],u):n[l]=u})}),i?Object.values(n):n},Ws=Object.entries,pe=(t,e)=>t in e,Hs=(t,e)=>e in t;class Yu{constructor(e){Object.assign(this,e)}}const Xu=class{};class Gs extends Xu{}const ed=(t,e)=>{const n={},r={};let i;for(i in t)i in e?n[i]=t[i]:r[i]=t[i];return[n,r]},td=(t,e)=>ed(t,e)[1],xt=t=>Object.keys(t).length===0,Xn=t=>[...Object.entries(t),...Object.getOwnPropertySymbols(t).map(e=>[e,t[e]])],nd=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),rd=t=>{const e=Object.keys(t).sort(),n={};for(let r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n},ve=Js("represents an uninitialized value"),id=t=>Object.values(t).filter(e=>typeof e=="number"?!0:typeof t[e]!="number"),Zs={Array,Boolean,Date,Error,Function,Map,Number,Promise,RegExp,Set,String,WeakMap,WeakSet},Qs=globalThis.File??Blob,Ys={ArrayBuffer,Blob,File:Qs,FormData,Headers,Request,Response,URL},sd={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array},nt={...Zs,...Ys,...sd,String,Number,Boolean},Ar=t=>{let e=Object.getPrototypeOf(t);for(;e?.constructor&&(!pe(e.constructor.name,nt)||!(t instanceof nt[e.constructor.name]));)e=Object.getPrototypeOf(e);const n=e?.constructor?.name;if(!(n===void 0||n==="Object"))return n},er=t=>typeof t=="object"&&t!==null?Ar(t)??"object":fe(t),re=Array.isArray,od={Array:"an array",Function:"a function",Date:"a Date",RegExp:"a RegExp",Error:"an Error",Map:"a Map",Set:"a Set",String:"a String object",Number:"a Number object",Boolean:"a Boolean object",Promise:"a Promise",WeakMap:"a WeakMap",WeakSet:"a WeakSet"},ad={ArrayBuffer:"an ArrayBuffer instance",Blob:"a Blob instance",File:"a File instance",FormData:"a FormData instance",Headers:"a Headers instance",Request:"a Request instance",Response:"a Response instance",URL:"a URL instance"},ld={Int8Array:"an Int8Array",Uint8Array:"a Uint8Array",Uint8ClampedArray:"a Uint8ClampedArray",Int16Array:"an Int16Array",Uint16Array:"a Uint16Array",Int32Array:"an Int32Array",Uint32Array:"a Uint32Array",Float32Array:"a Float32Array",Float64Array:"a Float64Array",BigInt64Array:"a BigInt64Array",BigUint64Array:"a BigUint64Array"},cd={...od,...ad,...ld},Nr=t=>{const e=Object(t).name??null;return e&&pe(e,nt)&&nt[e]===t?e:null},bi=(t,e)=>{let n=t.prototype;for(;n!==null;){if(n===e.prototype)return!0;n=Object.getPrototypeOf(n)}return!1},ud=t=>Xs(t,new Map),Xs=(t,e)=>{if(typeof t!="object"||t===null)return t;if(e?.has(t))return e.get(t);const n=Nr(t.constructor);if(n==="Date")return new Date(t.getTime());if(n&&n!=="Array")return t;const r=Array.isArray(t)?t.slice():Object.create(Object.getPrototypeOf(t)),i=Object.getOwnPropertyDescriptors(t);if(e){e.set(t,r);for(const s in i){const o=i[s];"get"in o||"set"in o||(o.value=Xs(o.value,e))}}return Object.defineProperties(r,i),r},dd=t=>{let e=ve;return()=>e===ve?e=t():e},un=t=>typeof t=="function"&&t.length===0,hd=(t,e)=>{try{return t()}catch(n){return e?.(n)}},fd=class extends Function{constructor(...t){const e=t.slice(0,-1),n=t.at(-1);try{super(...e,n)}catch(r){return X(`Encountered an unexpected error while compiling your definition:
                Message: ${r} 
                Source: (${t.slice(0,-1)}) => {
                    ${t.at(-1)}
                }`)}}};class ot{constructor(e,...[n]){return Object.assign(Object.setPrototypeOf(e.bind(n?.bind??this),this.constructor.prototype),n?.attach)}}const pd=dd(()=>{try{return new Function("return false")()}catch{return!0}});class be{constructor(){}}const md=t=>t[0].toUpperCase()+t.slice(1),eo=t=>new RegExp(gd(t),typeof t=="string"?"":t.flags),gd=t=>`^(?:${typeof t=="string"?t:t.source})$`,ke={negativeLookahead:t=>`(?!${t})`,nonCapturingGroup:t=>`(?:${t})`},tr="\\",dn={" ":1,"\n":1,"	":1},bd=/^-0\.?0*$/.source,to=/[1-9]\d*/.source,vd=/\.\d+/.source,yd=/\.\d*[1-9]/.source,no=t=>eo(ke.negativeLookahead(bd)+ke.nonCapturingGroup("-?"+ke.nonCapturingGroup(ke.nonCapturingGroup("0|"+to)+ke.nonCapturingGroup(t.decimalPattern)+"?")+(t.allowDecimalOnly?"|"+t.decimalPattern:"")+"?")),vi=no({decimalPattern:yd,allowDecimalOnly:!1}),$d=vi.test.bind(vi),nr=no({decimalPattern:vd,allowDecimalOnly:!0});nr.test.bind(nr);const xd=/^-?\d*\.?\d*$/,wd=t=>t.length!==0&&xd.test(t),Ht=eo(ke.negativeLookahead("^-0$")+"-?"+ke.nonCapturingGroup(ke.nonCapturingGroup("0|"+to))),Sd=Ht.test.bind(Ht),rr=/^-?\d+$/,Ed=rr.test.bind(rr),ro={number:"a number",bigint:"a bigint",integer:"an integer"},io=(t,e)=>`'${t}' was parsed as ${ro[e]} but could not be narrowed to a literal value. Avoid unnecessary leading or trailing zeros and other abnormal notation`,kd=(t,e)=>e==="number"?$d(t):Sd(t),Md=(t,e)=>e==="number"?Number(t):Number.parseInt(t),Ad=(t,e)=>e==="number"?wd(t):Ed(t),Nd=(t,e)=>Cr(t,"number",e),Cd=(t,e)=>Cr(t,"number",{...e,strict:!0}),Od=(t,e)=>Cr(t,"integer",e),Cr=(t,e,n)=>{const r=Md(t,e);return!Number.isNaN(r)&&Ad(t,e)?n?.strict?kd(t,e)?r:y(io(t,e)):r:n?.errorOnFail?y(n?.errorOnFail===!0?`Failed to parse ${ro[e]} from '${t}'`:n?.errorOnFail):void 0},Id=t=>{if(t[t.length-1]!=="n")return;const e=t.slice(0,-1);let n;try{n=BigInt(e)}catch{return}if(Ht.test(e))return n;if(rr.test(e))return y(io(t,"bigint"))},Rd="0.45.5",Fd={version:Rd,filename:hd(()=>import.meta.filename??void 0,()=>globalThis.__filename??"unknown"),FileConstructor:Qs},wt=Fd,yi=new WeakMap,In=Object.create(null),ir=t=>{const e=yi.get(t);if(e)return e;let n=Dd(t);return In[n]?n=`${n}${In[n]++}`:In[n]=1,wt[n]=t,yi.set(t,n),n},Gt=t=>/^[a-zA-Z_$][a-zA-Z_$0-9]*$/.test(t),Dd=t=>{switch(typeof t){case"object":{if(t===null)break;const e=Ar(t)??"object";return e[0].toLowerCase()+e.slice(1)}case"function":return Gt(t.name)?t.name:"fn";case"symbol":return t.description&&Gt(t.description)?t.description:"symbol"}return X(`Unexpected attempt to register serializable value of type ${fe(t)}`)},so=t=>typeof t=="string"?JSON.stringify(t):typeof t=="bigint"?`${t}n`:`${t}`,Pd=(t,e={})=>ft(t,{onUndefined:"$ark.undefined",onBigInt:n=>`$ark.bigint-${n}`,...e},[]),U=(t,e)=>{switch(fe(t)){case"object":const n=t,r=n.constructor.name;return r==="Object"||r==="Array"?JSON.stringify(ft(n,Zt,[]),null,e):n instanceof Date?St(n):typeof n.expression=="string"?n.expression:r;case"symbol":return Zt.onSymbol(t);default:return so(t)}},Zt={onCycle:()=>"(cycle)",onSymbol:t=>`Symbol(${ir(t)})`,onFunction:t=>`Function(${ir(t)})`},ft=(t,e,n)=>{switch(fe(t)){case"object":{const r=t;if("toJSON"in r&&typeof r.toJSON=="function")return r.toJSON();if(typeof r=="function")return Zt.onFunction(r);if(n.includes(r))return"(cycle)";const i=[...n,r];if(Array.isArray(r))return r.map(o=>ft(o,e,i));if(r instanceof Date)return r.toDateString();const s={};for(const o in r)s[o]=ft(r[o],e,i);for(const o of Object.getOwnPropertySymbols(r))s[e.onSymbol?.(o)??o.toString()]=ft(r[o],e,i);return s}case"symbol":return Zt.onSymbol(t);case"bigint":return e.onBigInt?.(t)??`${t}n`;case"undefined":return e.onUndefined??"undefined";case"string":return t.replaceAll("\\","\\\\");default:return t}},St=t=>{const e=t.getFullYear(),n=t.getMonth(),r=t.getDate(),i=t.getHours(),s=t.getMinutes(),o=t.getSeconds(),a=t.getMilliseconds();if(n===0&&r===1&&i===0&&s===0&&o===0&&a===0)return`${e}`;const c=`${Td[n]} ${r}, ${e}`;if(i===0&&s===0&&o===0&&a===0)return c;let l=t.toLocaleTimeString();const u=l.endsWith(" AM")||l.endsWith(" PM")?l.slice(-3):"";return u&&(l=l.slice(0,-u.length)),a?l+=`.${jd(a,3)}`:Bd.test(l)&&(l=l.slice(0,-3)),`${l+u}, ${c}`},Td=["January","February","March","April","May","June","July","August","September","October","November","December"],Bd=/:\d\d:00$/,jd=(t,e)=>String(t).padStart(e,"0"),oo=(t,e,...[n])=>{const r=n?.stringifySymbol??U;let i=t;switch(typeof e){case"string":i=Gt(e)?t===""?e:`${t}.${e}`:`${t}[${JSON.stringify(e)}]`;break;case"number":i=`${t}[${e}]`;break;case"symbol":i=`${t}[${r(e)}]`;break;default:n?.stringifyNonKey?i=`${t}[${n.stringifyNonKey(e)}]`:y(`${U(e)} must be a PropertyKey or stringifyNonKey must be passed to options`)}return i},Et=(t,...e)=>t.reduce((n,r)=>oo(n,r,...e),"");class ao extends Vs{cache={};constructor(...e){super(),this.push(...e)}toJSON(){if(this.cache.json)return this.cache.json;this.cache.json=[];for(let e=0;e<this.length;e++)this.cache.json.push(typeof this[e]=="symbol"?U(this[e]):this[e]);return this.cache.json}stringify(){return this.cache.stringify?this.cache.stringify:this.cache.stringify=Et(this)}stringifyAncestors(){if(this.cache.stringifyAncestors)return this.cache.stringifyAncestors;let e="";const n=[e];return this.forEach(r=>{e=oo(e,r),n.push(e)}),this.cache.stringifyAncestors=n}}class Kd{chars;i;def;constructor(e){this.def=e,this.chars=[...e],this.i=0}shift(){return this.chars[this.i++]??""}get lookahead(){return this.chars[this.i]??""}get nextLookahead(){return this.chars[this.i+1]??""}get length(){return this.chars.length}shiftUntil(e){let n="";for(;this.lookahead;){if(e(this,n))if(n[n.length-1]===tr)n=n.slice(0,-1);else break;n+=this.shift()}return n}shiftUntilLookahead(e){return typeof e=="string"?this.shiftUntil(n=>n.lookahead===e):this.shiftUntil(n=>n.lookahead in e)}shiftUntilNonWhitespace(){return this.shiftUntil(()=>!(this.lookahead in dn))}jumpToIndex(e){this.i=e<0?this.length+e:e}jumpForward(e){this.i+=e}get location(){return this.i}get unscanned(){return this.chars.slice(this.i,this.length).join("")}get scanned(){return this.chars.slice(0,this.i).join("")}sliceChars(e,n){return this.chars.slice(e,n).join("")}lookaheadIs(e){return this.lookahead===e}lookaheadIsIn(e){return this.lookahead in e}}let sr="$ark",or=2;for(;sr in globalThis;)sr=`$ark${or++}`;const lo=sr;globalThis[lo]=wt;const w=wt;if(or!==2){const t=globalThis,e=[t.$ark];for(let i=2;i<or;i++)t[`$ark${i}`]&&e.push(t[`$ark${i}`]);console.warn("Multiple @ark registries detected. This can lead to unexpected behavior.");const n=zs(e,"filename"),r=Object.keys(n);for(const i of r)n[i].length>1&&console.warn(`File ${i} was initialized multiple times, likely due to being imported from both CJS and ESM contexts.`);r.length>1&&console.warn("Registries were initialized at the following paths:"+r.map(i=>`	${i} (@ark/util version ${n[i][0].version})`).join(`
`))}const Ld=t=>`${lo}.${t}`,oe=t=>Ld(ir(t));class co extends Gs{argNames;body="";constructor(...e){super(),this.argNames=e;for(const n of e){if(n in this)throw new Error(`Arg name '${n}' would overwrite an existing property on FunctionBody`);this[n]=n}}indentation=0;indent(){return this.indentation+=4,this}dedent(){return this.indentation-=4,this}prop(e,n=!1){return uo(e,n)}index(e,n=!1){return ho(`${e}`,n)}line(e){return this.body+=`${" ".repeat(this.indentation)}${e}
`,this}const(e,n){return this.line(`const ${e} = ${n}`),this}let(e,n){return this.line(`let ${e} = ${n}`)}set(e,n){return this.line(`${e} = ${n}`)}if(e,n){return this.block(`if (${e})`,n)}elseIf(e,n){return this.block(`else if (${e})`,n)}else(e){return this.block("else",e)}for(e,n,r=0){return this.block(`for (let i = ${r}; ${e}; i++)`,n)}forIn(e,n){return this.block(`for (const k in ${e})`,n)}block(e,n,r=""){return this.line(`${e} {`),this.indent(),n(this),this.dedent(),this.line(`}${r}`)}return(e=""){return this.line(`return ${e}`)}write(e="anonymous"){return`${e}(${this.argNames.join(", ")}) {
${this.body}}`}compile(){return new fd(...this.argNames,this.body)}}const kt=t=>Ue(t,"object")||typeof t=="symbol"?oe(t):so(t),uo=(t,e=!1)=>typeof t=="string"&&Gt(t)?`${e?"?":""}.${t}`:ho(qd(t),e),qd=t=>typeof t=="symbol"?oe(t):JSON.stringify(t),ho=(t,e=!1)=>`${e?"?.":""}[${t}]`;class Rn extends co{traversalKind;optimistic;constructor(e){super("data","ctx"),this.traversalKind=e.kind,this.optimistic=e.optimistic===!0}invoke(e,n){const r=n?.arg??this.data,i=typeof e=="string"?!0:this.requiresContextFor(e),s=typeof e=="string"?e:e.id;return i?`${this.referenceToId(s,n)}(${r}, ${this.ctx})`:`${this.referenceToId(s,n)}(${r})`}referenceToId(e,n){const r=n?.kind??this.traversalKind,i=`this.${e}${r}`;return n?.bind?`${i}.bind(${n?.bind})`:i}requiresContextFor(e){return this.traversalKind==="Apply"||e.allowsRequiresContext}initializeErrorCount(){return this.const("errorCount","ctx.currentErrorCount")}returnIfFail(){return this.if("ctx.currentErrorCount > errorCount",()=>this.return())}returnIfFailFast(){return this.if("ctx.failFast && ctx.currentErrorCount > errorCount",()=>this.return())}traverseKey(e,n,r){const i=this.requiresContextFor(r);return i&&this.line(`${this.ctx}.path.push(${e})`),this.check(r,{arg:n}),i&&this.line(`${this.ctx}.path.pop()`),this}check(e,n){return this.traversalKind==="Allows"?this.if(`!${this.invoke(e,n)}`,()=>this.return(!1)):this.line(this.invoke(e,n))}}const fo=t=>V(t,(e,n)=>[e,re(n)?[...n]:n]),Ne=Js("arkKind"),I=(t,e)=>t?.[Ne]===e,se=t=>I(t,"root")||I(t,"constraint"),Ud=["unit","proto","domain"],hn=["required","optional","index","sequence"],po=["pattern","divisor","exactLength","max","min","maxLength","minLength","before","after"],Or=[...po,...hn,"structure","predicate"],fn=["alias","union","morph","unit","intersection","proto","domain"],_d=[...fn,...Or],mo=V(Or,(t,e)=>[e,1]),Vd=V([...hn,"undeclared"],(t,e)=>[e,1]),go=V(_d,(t,e)=>[e,t]),_t=t=>typeof t=="string"&&t in go,Qt=t=>go[t],Ir=t=>fn.slice(Qt(t)+1);[...Ir("union")];[...Ir("morph")];const Ke=t=>typeof t=="string"||typeof t=="boolean"||t===null?t:typeof t=="number"?Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t:kt(t),pn=t=>{let e="{ ";for(const[n,r]of Object.entries(t))e+=`${n}: ${kt(r)}, `;return e+" }"},H=t=>{const e=t;return e.hasAssociatedError&&(e.defaults.expected??=n=>"description"in n?n.description:e.defaults.description(n),e.defaults.actual??=n=>U(n),e.defaults.problem??=n=>`must be ${n.expected}${n.actual?` (was ${n.actual})`:""}`,e.defaults.message??=n=>{if(n.path.length===0)return n.problem;const r=`${n.propString} ${n.problem}`;return r[0]==="["?`value at ${r}`:r}),e};w.config??={};const ar=(t,e)=>{if(!e)return t;const n={...t};let r;for(r in e){const i={...t.keywords};if(r==="keywords"){for(const s in e[r]){const o=e.keywords[s];o!==void 0&&(i[s]=typeof o=="string"?{description:o}:o)}n.keywords=i}else n[r]=_t(r)?{...t[r],...e[r]}:e[r]}return n};class rt extends Gs{[Ne]="error";path;data;nodeConfig;input;ctx;constructor({prefixPath:e,relativePath:n,...r},i){super(),this.input=r,this.ctx=i,nd(this,r);const s=i.data;r.code==="union"&&(r.errors=r.errors.flatMap(a=>{const c=a.hasCode("union")?a.errors:[a];return!e&&!n?c:c.map(l=>l.transform(u=>({...u,path:Hu(e,u.path,n)})))})),this.nodeConfig=i.config[this.code];const o=[...r.path??i.path];n&&o.push(...n),e&&o.unshift(...e),this.path=new ao(...o),this.data="data"in r?r.data:s}transform(e){return new rt(e({data:this.data,path:this.path,...this.input}),this.ctx)}hasCode(e){return this.code===e}get propString(){return Et(this.path)}get expected(){if(this.input.expected)return this.input.expected;const e=this.meta?.expected??this.nodeConfig.expected;return typeof e=="function"?e(this.input):e}get actual(){if(this.input.actual)return this.input.actual;const e=this.meta?.actual??this.nodeConfig.actual;return typeof e=="function"?e(this.data):e}get problem(){if(this.input.problem)return this.input.problem;const e=this.meta?.problem??this.nodeConfig.problem;return typeof e=="function"?e(this):e}get message(){if(this.input.message)return this.input.message;const e=this.meta?.message??this.nodeConfig.message;return typeof e=="function"?e(this):e}get flat(){return this.hasCode("intersection")?[...this.errors]:[this]}toJSON(){return{data:this.data,path:this.path,...this.input,expected:this.expected,actual:this.actual,problem:this.problem,message:this.message}}toString(){return this.message}throw(){throw this}}class Ce extends Vs{ctx;constructor(e){super(),this.ctx=e}byPath=Object.create(null);get flatByPath(){return V(this.byPath,(e,n)=>[e,n.flat])}get flatProblemsByPath(){return V(this.byPath,(e,n)=>[e,n.flat.map(r=>r.problem)])}byAncestorPath=Object.create(null);count=0;mutable=this;throw(){throw this.toTraversalError()}toTraversalError(){return new zd(this)}add(e){this.includes(e)||this._add(e)}transform(e){const n=new Ce(this.ctx);return this.forEach(r=>n.add(e(r))),n}merge(e){e.forEach(n=>{this.includes(n)||this._add(new rt({...n,path:[...this.ctx.path,...n.path]},this.ctx))})}affectsPath(e){return this.length===0?!1:e.stringifyAncestors().some(n=>n in this.byPath)||e.stringify()in this.byAncestorPath}get summary(){return this.toString()}get issues(){return this}toJSON(){return[...this.map(e=>e.toJSON())]}toString(){return this.join(`
`)}_add(e){const n=this.byPath[e.propString];if(n){const r=new rt({code:"intersection",errors:n.hasCode("intersection")?[...n.errors,e]:[n,e]},this.ctx),i=this.indexOf(n);this.mutable[i===-1?this.length:i]=r,this.byPath[e.propString]=r,this.addAncestorPaths(e)}else this.byPath[e.propString]=e,this.addAncestorPaths(e),this.mutable.push(e);this.count++}addAncestorPaths(e){e.path.stringifyAncestors().forEach(n=>{this.byAncestorPath[n]=q(this.byAncestorPath[n],e)})}}class zd extends Error{name="TraversalError";constructor(e){e.length===1?super(e.summary):super(`
`+e.map(n=>`   ${Jd(n)}`).join(`
`)),Object.defineProperty(this,"arkErrors",{value:e,enumerable:!1})}}const Jd=t=>t.toString().split(`
`).join(`
  `);class Ze{path=[];errors=new Ce(this);root;config;queuedMorphs=[];branches=[];seen={};constructor(e,n){this.root=e,this.config=n}get data(){let e=this.root;for(const n of this.path)e=e?.[n];return e}get propString(){return Et(this.path)}reject(e){return this.error(e),!1}mustBe(e){return this.error(e),!1}error(e){const n=typeof e=="object"?e.code?e:{...e,code:"predicate"}:{code:"predicate",expected:e};return this.errorFromContext(n)}hasError(){return this.currentErrorCount!==0}get currentBranch(){return this.branches.at(-1)}queueMorphs(e){const n={path:new ao(...this.path),morphs:e};this.currentBranch?this.currentBranch.queuedMorphs.push(n):this.queuedMorphs.push(n)}finalize(e){return this.queuedMorphs.length&&(typeof this.root=="object"&&this.root!==null&&this.config.clone&&(this.root=this.config.clone(this.root)),this.applyQueuedMorphs()),this.hasError()?e?e(this.errors):this.errors:this.root}get currentErrorCount(){return this.currentBranch?this.currentBranch.error?1:0:this.errors.count}get failFast(){return this.branches.length!==0}pushBranch(){this.branches.push({error:void 0,queuedMorphs:[]})}popBranch(){return this.branches.pop()}get external(){return this}errorFromNodeContext(e){return this.errorFromContext(e)}errorFromContext(e){const n=new rt(e,this);return this.currentBranch?this.currentBranch.error=n:this.errors.add(n),n}applyQueuedMorphs(){for(;this.queuedMorphs.length;){const e=this.queuedMorphs;this.queuedMorphs=[];for(const{path:n,morphs:r}of e)this.errors.affectsPath(n)||this.applyMorphsAtPath(n,r)}}applyMorphsAtPath(e,n){const r=e.at(-1);let i;if(r!==void 0){i=this.root;for(let s=0;s<e.length-1;s++)i=i[e[s]]}this.path=[...e];for(const s of n){const o=se(s),a=s(i===void 0?this.root:i[r],this);if(a instanceof rt){this.errors.add(a);break}if(a instanceof Ce){o||this.errors.merge(a);break}i===void 0?this.root=a:i[r]=a,this.applyQueuedMorphs()}}}const ye=(t,e,n)=>{if(!n)return e();n.path.push(t);const r=e();return n.path.pop(),r};class bo extends ot{attachments;$;onFail;includesTransform;includesContextualPredicate;isCyclic;allowsRequiresContext;rootApplyStrategy;contextFreeMorph;rootApply;referencesById;shallowReferences;flatRefs;flatMorphs;allows;get shallowMorphs(){return[]}constructor(e,n){super((i,s,o=this.onFail)=>s?(this.traverseApply(i,s),s.hasError()?s.errors:s.data):this.rootApply(i,o),{attach:e}),this.attachments=e,this.$=n,this.onFail=this.meta.onFail??this.$.resolvedConfig.onFail,this.includesTransform=this.hasKind("morph")||this.hasKind("structure")&&this.structuralMorph!==void 0,this.includesContextualPredicate=this.hasKind("predicate")&&this.inner.predicate.length!==1,this.isCyclic=this.kind==="alias",this.referencesById={[this.id]:this},this.shallowReferences=this.hasKind("structure")?[this,...this.children]:this.children.reduce((i,s)=>Hd(i,s.shallowReferences),[this]);const r=this.isStructural();this.flatRefs=[],this.flatMorphs=[];for(let i=0;i<this.children.length;i++){if(this.includesTransform||=this.children[i].includesTransform,this.includesContextualPredicate||=this.children[i].includesContextualPredicate,this.isCyclic||=this.children[i].isCyclic,!r){const s=this.children[i].flatRefs;for(let o=0;o<s.length;o++){const a=s[o];if(!this.flatRefs.some(c=>vo(c,a))){this.flatRefs.push(a);for(const c of a.node.branches)(c.hasKind("morph")||c.hasKind("intersection")&&c.structure?.structuralMorph!==void 0)&&this.flatMorphs.push({path:a.path,propString:a.propString,node:c})}}}Object.assign(this.referencesById,this.children[i].referencesById)}this.flatRefs.sort((i,s)=>i.path.length>s.path.length?1:i.path.length<s.path.length?-1:i.propString>s.propString?1:i.propString<s.propString||i.node.expression<s.node.expression?-1:1),this.allowsRequiresContext=this.includesContextualPredicate||this.isCyclic,this.rootApplyStrategy=!this.allowsRequiresContext&&this.flatMorphs.length===0?this.shallowMorphs.length===0?"allows":this.shallowMorphs.every(i=>i.length===1||i.name==="$arkStructuralMorph")?this.hasKind("union")?this.branches.some(i=>i.shallowMorphs.length>1)?"contextual":"branchedOptimistic":this.shallowMorphs.length>1?"contextual":"optimistic":"contextual":"contextual",this.rootApply=this.createRootApply(),this.allows=this.allowsRequiresContext?i=>this.traverseAllows(i,new Ze(i,this.$.resolvedConfig)):i=>this.traverseAllows(i)}createRootApply(){switch(this.rootApplyStrategy){case"allows":return(n,r)=>{if(this.allows(n))return n;const i=new Ze(n,this.$.resolvedConfig);return this.traverseApply(n,i),i.finalize(r)};case"contextual":return(n,r)=>{const i=new Ze(n,this.$.resolvedConfig);return this.traverseApply(n,i),i.finalize(r)};case"optimistic":this.contextFreeMorph=this.shallowMorphs[0];const e=this.$.resolvedConfig.clone;return(n,r)=>{if(this.allows(n))return this.contextFreeMorph(e&&(typeof n=="object"&&n!==null||typeof n=="function")?e(n):n);const i=new Ze(n,this.$.resolvedConfig);return this.traverseApply(n,i),i.finalize(r)};case"branchedOptimistic":return this.createBranchedOptimisticRootApply();default:return this.rootApplyStrategy,X(`Unexpected rootApplyStrategy ${this.rootApplyStrategy}`)}}compiledMeta=JSON.stringify(this.metaJson);cacheGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}get description(){return this.cacheGetter("description",this.meta?.description??this.$.resolvedConfig[this.kind].description(this))}get references(){return Object.values(this.referencesById)}precedence=Qt(this.kind);precompilation;assert=(e,n)=>this(e,n,r=>r.throw());traverse(e,n){return this(e,n,null)}get in(){return this.cacheGetter("in",this.getIo("in"))}get out(){return this.cacheGetter("out",this.getIo("out"))}getIo(e){if(!this.includesTransform)return this;const n={};for(const[r,i]of this.innerEntries){const s=this.impl.keys[r];if(s.reduceIo)s.reduceIo(e,n,i);else if(s.child){const o=i;n[r]=re(o)?o.map(a=>a[e]):o[e]}else n[r]=i}return this.$.node(this.kind,n)}toJSON(){return this.json}toString(){return`Type<${this.expression}>`}equals(e){const n=se(e)?e:this.$.parseDefinition(e);return this.innerHash===n.innerHash}ifEquals(e){return this.equals(e)?this:void 0}hasKind(e){return this.kind===e}assertHasKind(e){return this.kind!==e&&je(`${this.kind} node was not of asserted kind ${e}`),this}hasKindIn(...e){return e.includes(this.kind)}assertHasKindIn(...e){return Re(e,this.kind)||je(`${this.kind} node was not one of asserted kinds ${e}`),this}isBasis(){return Re(Ud,this.kind)}isConstraint(){return Re(Or,this.kind)}isStructural(){return Re(hn,this.kind)}isRefinement(){return Re(po,this.kind)}isRoot(){return Re(fn,this.kind)}isUnknown(){return this.hasKind("intersection")&&this.children.length===0}isNever(){return this.hasKind("union")&&this.children.length===0}hasUnit(e){return this.hasKind("unit")&&this.allows(e)}hasOpenIntersection(){return this.impl.intersectionIsOpen}get nestableExpression(){return this.expression}select(e){const n=dt.normalize(e);return this._select(n)}_select(e){let n=dt.applyBoundary[e.boundary??"references"](this);return e.kind&&(n=n.filter(r=>r.kind===e.kind)),e.where&&(n=n.filter(e.where)),dt.applyMethod[e.method??"filter"](n,this,e)}transform(e,n){return this._transform(e,this._createTransformContext(n))}_createTransformContext(e){return{root:this,selected:void 0,seen:{},path:[],parseOptions:{prereduced:e?.prereduced??!1},undeclaredKeyHandling:void 0,...e}}_transform(e,n){const r=n.bindScope??this.$;if(n.seen[this.id])return this.$.lazilyResolve(n.seen[this.id]);if(n.shouldTransform?.(this,n)===!1)return this;let i;n.seen[this.id]=()=>i,this.hasKind("structure")&&this.undeclared!==n.undeclaredKeyHandling&&(n={...n,undeclaredKeyHandling:this.undeclared});const s=V(this.inner,(u,h)=>{if(!this.impl.keys[u].child)return[u,h];const f=h;if(!re(f)){const g=f._transform(e,n);return g?[u,g]:[]}if(f.length===0)return[u,h];const p=f.flatMap(g=>g._transform(e,n)??[]);return p.length?[u,p]:[]});delete n.seen[this.id];const o=Object.assign(s,{meta:this.meta}),a=n.selected&&!n.selected.includes(this)?o:e(this.kind,o,n);if(a===null)return null;if(se(a))return i=a;const c=Object.keys(a);return(c.length===0||c.length===1&&c[0]==="meta")&&!xt(this.inner)?null:(this.kind==="required"||this.kind==="optional"||this.kind==="index")&&!("value"in a)?n.undeclaredKeyHandling?{...a,value:w.intrinsic.unknown}:null:(this.kind==="morph"&&(a.in??=w.intrinsic.unknown),i=r.node(this.kind,a,n.parseOptions))}configureReferences(e,n="references"){const r=dt.normalize(n),i=typeof e=="string"?(c,l)=>({...l,meta:{...l.meta,description:e}}):typeof e=="function"?(c,l)=>({...l,meta:e(l.meta)}):(c,l)=>({...l,meta:{...l.meta,...e}});if(r.boundary==="self")return this.$.node(this.kind,i(this.kind,{...this.inner,meta:this.meta}));const s=this._select(r),o=s&&$t(s),a=r.boundary==="child"?(c,l)=>l.root.children.includes(c):r.boundary==="shallow"?c=>c.kind!=="structure":()=>!0;return this.$.finalize(this.transform(i,{shouldTransform:a,selected:o}))}}const dt={applyBoundary:{self:t=>[t],child:t=>[...t.children],shallow:t=>[...t.shallowReferences],references:t=>[...t.references]},applyMethod:{filter:t=>t,assertFilter:(t,e,n)=>(t.length===0&&je($i(e,n)),t),find:t=>t[0],assertFind:(t,e,n)=>(t.length===0&&je($i(e,n)),t[0])},normalize:t=>typeof t=="function"?{boundary:"references",method:"filter",where:t}:typeof t=="string"?pe(t,dt.applyBoundary)?{method:"filter",boundary:t}:{boundary:"references",method:"filter",kind:t}:{boundary:"references",method:"filter",...t}},$i=(t,e)=>`${t} had no references matching ${U(e)}.`,Wd=t=>Et(t,{stringifyNonKey:e=>e.expression}),Me=(t,e)=>({path:t,node:e,propString:Wd(t)}),vo=(t,e)=>t.propString===e.propString&&t.node.equals(e.node),xi=(t,e)=>Pe(t,e,{isEqual:vo}),Hd=(t,e)=>Pe(t,e,{isEqual:(n,r)=>n.equals(r)});class A extends Array{static init(e,n,r,i){return new A({kind:e,l:n,r,path:i?.path??[],optional:i?.optional??!1})}add(e,n,r,i){return this.push({kind:e,l:n,r,path:i?.path??[],optional:i?.optional??!1}),this}get summary(){return this.describeReasons()}describeReasons(){if(this.length===1){const{path:e,l:n,r}=this[0],i=Et(e);return yo(`Intersection${i&&` at ${i}`} of ${wi(n,r)}`)}return`The following intersections result in unsatisfiable types:
 ${this.map(({path:e,l:n,r})=>`${e}: ${wi(n,r)}`).join(`
 `)}`}throw(){return y(this.describeReasons())}invert(){const e=this.map(n=>({...n,l:n.r,r:n.l}));return e instanceof A?e:new A(...e)}withPrefixKey(e,n){return this.map(r=>({...r,path:[e,...r.path],optional:r.optional||n==="optional"}))}toNeverIfDisjoint(){return w.intrinsic.never}}const wi=(t,e)=>`${lr(t)} and ${lr(e)}`,lr=t=>se(t)?t.expression:re(t)?t.map(lr).join(" | ")||"never":String(t),yo=t=>`${t} results in an unsatisfiable type`,Je={},Oe=(t,e,n)=>te(t,e,{$:n,invert:!1,pipe:!1}),cr=(t,e,n)=>te(t,e,{$:n,invert:!1,pipe:!0}),te=(t,e,n)=>{const r=n.pipe?"|>":"&",i=`${t.hash}${r}${e.hash}`;if(Je[i]!==void 0)return Je[i];if(!n.pipe){const a=`${e.hash}${r}${t.hash}`;if(Je[a]!==void 0){const c=Je[a],l=c instanceof A?c.invert():c;return Je[i]=l,l}}const s=!n.pipe||!t.includesTransform&&!e.includesTransform;if(s&&t.equals(e))return t;let o=s?ur(t,e,n):t.hasKindIn(...fn)?Gd(t,e,n):ur(t,e,n);return se(o)&&(t.equals(o)?o=t:e.equals(o)&&(o=e)),Je[i]=o,o},ur=(t,e,n)=>{const r=t.precedence<e.precedence?t.kind:e.kind,i=t.impl.intersections[e.kind]??e.impl.intersections[t.kind];if(i===void 0)return null;if(r===t.kind)return i(t,e,n);{let s=i(e,t,{...n,invert:!n.invert});return s instanceof A&&(s=s.invert()),s}},Gd=(t,e,n)=>t.includesTransform||e.includesTransform?n.invert?Si(e,t,n):Si(t,e,n):ur(t,e,n),Si=(t,e,n)=>t.distribute(r=>Zd(r,e,n),r=>{const i=r.filter(se);if(i.length===0)return A.init("union",t.branches,e.branches);if(i.length<t.branches.length||!t.branches.every((o,a)=>o.in.equals(i[a].in)))return n.$.parseSchema(i);if(i.length===1)return i[0];const s={branches:i};return n.$.parseSchema(s)}),Zd=(t,e,n)=>{if(t.hasKind("morph")){const i=[...t.morphs];if(t.lastMorphIfNode){const s=te(t.lastMorphIfNode,e,n);if(s instanceof A)return s;i[i.length-1]=s}else i.push(e);return n.$.node("morph",{morphs:i,in:t.inner.in})}if(e.hasKind("morph")){const i=te(t,e.in,n);return i instanceof A?i:n.$.node("morph",{morphs:[e],in:i})}return n.$.node("morph",{morphs:[e],in:t})};class at extends bo{constructor(e,n){super(e,n),Object.defineProperty(this,Ne,{value:"constraint",enumerable:!1})}impliedSiblings;intersect(e){return Oe(this,e,this.$)}}class mn extends at{traverseApply=(e,n)=>{this.traverseAllows(e,n)||n.errorFromNodeContext(this.errorContext)};compile(e){e.traversalKind==="Allows"?e.return(this.compiledCondition):e.if(this.compiledNegation,()=>e.line(`${e.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return pn(this.errorContext)}}const ae=t=>(e,n)=>{if(re(e)){if(e.length===0)return;const i=e.map(s=>n.$.node(t,s));return t==="predicate"?i:i.sort((s,o)=>s.hash<o.hash?-1:1)}const r=n.$.node(t,e);return r.hasOpenIntersection()?[r]:r},Yt=t=>{const e=t.r.shift();if(!e){let r=t.l.length===0&&t.kind==="structure"?w.intrinsic.unknown.internal:t.ctx.$.node(t.kind,Object.assign(t.baseInner,Qd(t.l)),{prereduced:!0});for(const i of t.roots){if(r instanceof A)return r;r=te(i,r,t.ctx)}return r}let n=!1;for(let r=0;r<t.l.length;r++){const i=te(t.l[r],e,t.ctx);if(i!==null){if(i instanceof A)return i;if(n){if(!t.l.includes(i))return X(`Unexpectedly encountered multiple distinct intersection results for refinement ${i}`)}else{if(i.isRoot())return t.roots.push(i),t.l.splice(r),Yt(t);t.l[r]=i,n=!0}}}return n||t.l.push(e),t.kind==="intersection"&&e.impliedSiblings?.forEach(r=>Pe(t.r,r)),Yt(t)},Xt=t=>Object.entries(t).flatMap(([n,r])=>n in mo?r:[]).sort((n,r)=>n.precedence<r.precedence?-1:n.precedence>r.precedence?1:n.kind==="predicate"&&r.kind==="predicate"?0:n.hash<r.hash?-1:1),Qd=t=>{const e={};for(const n of t)if(n.hasOpenIntersection())e[n.kind]=q(e[n.kind],n);else{if(e[n.kind])return X(`Unexpected intersection of closed refinements of kind ${n.kind}`);e[n.kind]=n}return e},Yd=(...t)=>y(Xd(...t)),Xd=(t,e,n)=>{const r=n.hasKind("morph")?"a morph":n.isUnknown()?"unknown":n.exclude(e).defaultShortDescription;return`${md(t)} operand must be ${e.description} (was ${r})`},eh=(t,e,n)=>new en(t,e,n,n,null);class $o extends ot{}class en extends ot{[Ne]="generic";paramDefs;bodyDef;$;arg$;baseInstantiation;hkt;description;constructor(e,n,r,i,s){super((...o)=>{const a=V(this.names,(c,l)=>{const u=this.arg$.parse(o[c]);return u.extends(this.constraints[c])||y(th(l,this.constraints[c].expression,u.expression)),[l,u]});if(this.defIsLazy()){const c=this.bodyDef(a);return this.$.parse(c)}return this.$.parse(n,{args:a})}),this.paramDefs=e,this.bodyDef=n,this.$=r,this.arg$=i,this.hkt=s,this.description=s?new s().description??`a generic type for ${s.constructor.name}`:"a generic type",this.baseInstantiation=this(...this.constraints)}defIsLazy(){return this.bodyDef instanceof $o}cacheGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}get json(){return this.cacheGetter("json",{params:this.params.map(e=>e[1].isUnknown()?e[0]:[e[0],e[1].json]),body:Pd(this.bodyDef)})}get params(){return this.cacheGetter("params",this.paramDefs.map(e=>typeof e=="string"?[e,w.intrinsic.unknown]:[e[0],this.$.parse(e[1])]))}get names(){return this.cacheGetter("names",this.params.map(e=>e[0]))}get constraints(){return this.cacheGetter("constraints",this.params.map(e=>e[1]))}get internal(){return this}get referencesById(){return this.baseInstantiation.internal.referencesById}get references(){return this.baseInstantiation.internal.references}}const th=(t,e,n)=>`${t} must be assignable to ${e} (was ${n})`,Ei={morph:"it represents a transformation, while JSON Schema only allows validation. Consider creating a Schema from one of its endpoints using `.in` or `.out`.",cyclic:"cyclic types are not yet convertible to JSON Schema. If this feature is important to you, please add your feedback at https://github.com/arktypeio/arktype/issues/1087"},ki=(t,e)=>{let n=`${t} is not convertible to JSON Schema`;if(e){const r=pe(e,Ei)?Ei[e]:e;n+=` because ${r}`}return n},Y={writeUnjsonifiableMessage:ki,UnjsonifiableError:class extends Error{},throwUnjsonifiableError:(...t)=>je(ki(...t)),throwInternalOperandError:(t,e)=>X(`Unexpected JSON Schema input for ${t}: ${U(e)}`)},nh=H({kind:"predicate",hasAssociatedError:!0,collapsibleKey:"predicate",keys:{predicate:{}},normalize:t=>typeof t=="function"?{predicate:t}:t,defaults:{description:t=>`valid according to ${t.predicate.name||"an anonymous predicate"}`},intersectionIsOpen:!0,intersections:{predicate:()=>null}});class rh extends at{serializedPredicate=oe(this.predicate);compiledCondition=`${this.serializedPredicate}(data, ctx)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=null;expression=this.serializedPredicate;traverseAllows=this.predicate;errorContext={code:"predicate",description:this.description,meta:this.meta};compiledErrorContext=pn(this.errorContext);traverseApply=(e,n)=>{!this.predicate(e,n.external)&&!n.hasError()&&n.errorFromNodeContext(this.errorContext)};compile(e){if(e.traversalKind==="Allows"){e.return(this.compiledCondition);return}e.if(`${this.compiledNegation} && !ctx.hasError()`,()=>e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`))}reduceJsonSchema(){return Y.throwUnjsonifiableError(`Predicate ${this.expression}`)}}const xo={implementation:nh,Node:rh},ih=H({kind:"divisor",collapsibleKey:"rule",keys:{rule:{}},normalize:t=>typeof t=="number"?{rule:t}:t,hasAssociatedError:!0,defaults:{description:t=>t.rule===1?"an integer":t.rule===2?"even":`a multiple of ${t.rule}`},intersections:{divisor:(t,e,n)=>n.$.node("divisor",{rule:Math.abs(t.rule*e.rule/oh(t.rule,e.rule))})},obviatesBasisDescription:!0});class sh extends mn{traverseAllows=e=>e%this.rule===0;compiledCondition=`data % ${this.rule} === 0`;compiledNegation=`data % ${this.rule} !== 0`;impliedBasis=w.intrinsic.number.internal;expression=`% ${this.rule}`;reduceJsonSchema(e){return e.type="integer",this.rule===1||(e.multipleOf=this.rule),e}}const wo={implementation:ih,Node:sh},oh=(t,e)=>{let n,r=t,i=e;for(;i!==0;)n=i,i=r%i,r=n;return r};class lt extends mn{boundOperandKind=uh[this.kind];compiledActual=this.boundOperandKind==="value"?"data":this.boundOperandKind==="length"?"data.length":"data.valueOf()";comparator=dh(this.kind,this.exclusive);numericLimit=this.rule.valueOf();expression=`${this.comparator} ${this.rule}`;compiledCondition=`${this.compiledActual} ${this.comparator} ${this.numericLimit}`;compiledNegation=`${this.compiledActual} ${ah[this.comparator]} ${this.numericLimit}`;stringLimit=this.boundOperandKind==="date"?hh(this.numericLimit):`${this.numericLimit}`;limitKind=this.comparator[0]==="<"?"upper":"lower";isStricterThan(e){return(this.limitKind==="upper"?this.numericLimit<e.numericLimit:this.numericLimit>e.numericLimit)||this.numericLimit===e.numericLimit&&this.exclusive===!0&&!e.exclusive}overlapsRange(e){return!(this.isStricterThan(e)||this.numericLimit===e.numericLimit&&(this.exclusive||e.exclusive))}overlapIsUnit(e){return this.numericLimit===e.numericLimit&&!this.exclusive&&!e.exclusive}}const ah={"<":">=","<=":">",">":"<=",">=":"<"},lh={min:"max",minLength:"maxLength",after:"before"},So={parse:t=>t||void 0},Eo=t=>e=>{if(typeof e=="number")return{rule:e};const{exclusive:n,...r}=e;return n?{...r,rule:t==="minLength"?r.rule+1:r.rule-1}:r},ko=t=>e=>{if(typeof e=="number"||typeof e=="string"||e instanceof Date)return{rule:e};const{exclusive:n,...r}=e;if(!n)return r;const i=typeof r.rule=="number"?r.rule:typeof r.rule=="string"?new Date(r.rule).valueOf():r.rule.valueOf();return n?{...r,rule:t==="after"?i+1:i-1}:r},Mo=t=>typeof t=="string"||typeof t=="number"?new Date(t):t,ch=(t,e)=>`${t} bound must be a positive integer (was ${e})`,Rr=t=>e=>((!Number.isInteger(e)||e<0)&&y(ch(t,e)),e),uh={min:"value",max:"value",minLength:"length",maxLength:"length",after:"date",before:"date"},dh=(t,e)=>`${pe(t,lh)?">":"<"}${e?"":"="}`,hh=t=>typeof t=="string"?t:new Date(t).toLocaleString(),fh=t=>`Bounded expression ${t} must be exactly one of number, string, Array, or Date`,ph=H({kind:"after",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Mo,serialize:t=>t.toISOString()}},normalize:ko("after"),defaults:{description:t=>`${t.collapsibleLimitString} or later`,actual:St},intersections:{after:(t,e)=>t.isStricterThan(e)?t:e}});class mh extends lt{impliedBasis=w.intrinsic.Date.internal;collapsibleLimitString=St(this.rule);traverseAllows=e=>e>=this.rule;reduceJsonSchema(){return Y.throwUnjsonifiableError("Date instance")}}const Ao={implementation:ph,Node:mh},gh=H({kind:"before",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Mo,serialize:t=>t.toISOString()}},normalize:ko("before"),defaults:{description:t=>`${t.collapsibleLimitString} or earlier`,actual:St},intersections:{before:(t,e)=>t.isStricterThan(e)?t:e,after:(t,e,n)=>t.overlapsRange(e)?t.overlapIsUnit(e)?n.$.node("unit",{unit:t.rule}):null:A.init("range",t,e)}});class bh extends lt{collapsibleLimitString=St(this.rule);traverseAllows=e=>e<=this.rule;impliedBasis=w.intrinsic.Date.internal;reduceJsonSchema(){return Y.throwUnjsonifiableError("Date instance")}}const No={implementation:gh,Node:bh},vh=H({kind:"exactLength",collapsibleKey:"rule",keys:{rule:{parse:Rr("exactLength")}},normalize:t=>typeof t=="number"?{rule:t}:t,hasAssociatedError:!0,defaults:{description:t=>`exactly length ${t.rule}`,actual:t=>`${t.length}`},intersections:{exactLength:(t,e,n)=>A.init("unit",n.$.node("unit",{unit:t.rule}),n.$.node("unit",{unit:e.rule}),{path:["length"]}),minLength:(t,e)=>t.rule>=e.rule?t:A.init("range",t,e),maxLength:(t,e)=>t.rule<=e.rule?t:A.init("range",t,e)}});class yh extends mn{traverseAllows=e=>e.length===this.rule;compiledCondition=`data.length === ${this.rule}`;compiledNegation=`data.length !== ${this.rule}`;impliedBasis=w.intrinsic.lengthBoundable.internal;expression=`== ${this.rule}`;reduceJsonSchema(e){switch(e.type){case"string":return e.minLength=this.rule,e.maxLength=this.rule,e;case"array":return e.minItems=this.rule,e.maxItems=this.rule,e;default:return Y.throwInternalOperandError("exactLength",e)}}}const Co={implementation:vh,Node:yh},$h=H({kind:"max",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:So},normalize:t=>typeof t=="number"?{rule:t}:t,defaults:{description:t=>t.rule===0?t.exclusive?"negative":"non-positive":`${t.exclusive?"less than":"at most"} ${t.rule}`},intersections:{max:(t,e)=>t.isStricterThan(e)?t:e,min:(t,e,n)=>t.overlapsRange(e)?t.overlapIsUnit(e)?n.$.node("unit",{unit:t.rule}):null:A.init("range",t,e)},obviatesBasisDescription:!0});class xh extends lt{impliedBasis=w.intrinsic.number.internal;traverseAllows=this.exclusive?e=>e<this.rule:e=>e<=this.rule;reduceJsonSchema(e){return this.exclusive?e.exclusiveMaximum=this.rule:e.maximum=this.rule,e}}const Oo={implementation:$h,Node:xh},wh=H({kind:"maxLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Rr("maxLength")}},reduce:(t,e)=>t.rule===0?e.node("exactLength",t):void 0,normalize:Eo("maxLength"),defaults:{description:t=>`at most length ${t.rule}`,actual:t=>`${t.length}`},intersections:{maxLength:(t,e)=>t.isStricterThan(e)?t:e,minLength:(t,e,n)=>t.overlapsRange(e)?t.overlapIsUnit(e)?n.$.node("exactLength",{rule:t.rule}):null:A.init("range",t,e)}});class Sh extends lt{impliedBasis=w.intrinsic.lengthBoundable.internal;traverseAllows=e=>e.length<=this.rule;reduceJsonSchema(e){switch(e.type){case"string":return e.maxLength=this.rule,e;case"array":return e.maxItems=this.rule,e;default:return Y.throwInternalOperandError("maxLength",e)}}}const Io={implementation:wh,Node:Sh},Eh=H({kind:"min",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{},exclusive:So},normalize:t=>typeof t=="number"?{rule:t}:t,defaults:{description:t=>t.rule===0?t.exclusive?"positive":"non-negative":`${t.exclusive?"more than":"at least"} ${t.rule}`},intersections:{min:(t,e)=>t.isStricterThan(e)?t:e},obviatesBasisDescription:!0});class kh extends lt{impliedBasis=w.intrinsic.number.internal;traverseAllows=this.exclusive?e=>e>this.rule:e=>e>=this.rule;reduceJsonSchema(e){return this.exclusive?e.exclusiveMinimum=this.rule:e.minimum=this.rule,e}}const Ro={implementation:Eh,Node:kh},Mh=H({kind:"minLength",collapsibleKey:"rule",hasAssociatedError:!0,keys:{rule:{parse:Rr("minLength")}},reduce:t=>t.rule===0?w.intrinsic.unknown:void 0,normalize:Eo("minLength"),defaults:{description:t=>t.rule===1?"non-empty":`at least length ${t.rule}`,actual:t=>t.length===0?"":`${t.length}`},intersections:{minLength:(t,e)=>t.isStricterThan(e)?t:e}});class Ah extends lt{impliedBasis=w.intrinsic.lengthBoundable.internal;traverseAllows=e=>e.length>=this.rule;reduceJsonSchema(e){switch(e.type){case"string":return e.minLength=this.rule,e;case"array":return e.minItems=this.rule,e;default:return Y.throwInternalOperandError("minLength",e)}}}const Fo={implementation:Mh,Node:Ah},Nh={min:Ro.implementation,max:Oo.implementation,minLength:Fo.implementation,maxLength:Io.implementation,exactLength:Co.implementation,after:Ao.implementation,before:No.implementation},Ch={min:Ro.Node,max:Oo.Node,minLength:Fo.Node,maxLength:Io.Node,exactLength:Co.Node,after:Ao.Node,before:No.Node},Oh=H({kind:"pattern",collapsibleKey:"rule",keys:{rule:{},flags:{}},normalize:t=>typeof t=="string"?{rule:t}:t instanceof RegExp?t.flags?{rule:t.source,flags:t.flags}:{rule:t.source}:t,obviatesBasisDescription:!0,obviatesBasisExpression:!0,hasAssociatedError:!0,intersectionIsOpen:!0,defaults:{description:t=>`matched by ${t.rule}`},intersections:{pattern:()=>null}});class Ih extends mn{instance=new RegExp(this.rule,this.flags);expression=`${this.instance}`;traverseAllows=this.instance.test.bind(this.instance);compiledCondition=`${this.expression}.test(data)`;compiledNegation=`!${this.compiledCondition}`;impliedBasis=w.intrinsic.string.internal;reduceJsonSchema(e){return e.pattern?Y.throwUnjsonifiableError(`Intersection of patterns ${e.pattern} & ${this.rule}`):(e.pattern=this.rule,e)}}const Do={implementation:Oh,Node:Ih},Vt=(t,e)=>{const n=Rh(t);return e&&!e.includes(n)?y(`Root of kind ${n} should be one of ${e}`):n},Rh=t=>{if(I(t,"root"))return t.kind;if(typeof t=="string")return t[0]==="$"?"alias":"domain";if(typeof t=="function")return"proto";if(typeof t!="object"||t===null)return y(Mi(t));if("morphs"in t)return"morph";if("branches"in t||re(t))return"union";if("unit"in t)return"unit";if("reference"in t)return"alias";const e=Object.keys(t);return e.length===0||e.some(n=>n in mo)?"intersection":"proto"in t?"proto":"domain"in t?"domain":y(Mi(t))},Mi=t=>`${U(t)} is not a valid type schema`,Ai={},Fh=t=>re(t)?t.map(e=>e.collapsibleJson):t.collapsibleJson,ue={};w.nodesByRegisteredId=ue;const Po=t=>(Ai[t]??=0,`${t}${++Ai[t]}`),To=t=>{const e=gn[t.kind],n=e.applyConfig?.(t.def,t.$.resolvedConfig)??t.def,r={},{meta:i,...s}=n,o=i===void 0?{}:typeof i=="string"?{description:i}:i,a=Ws(s).sort(([l],[u])=>_t(l)?_t(u)?Qt(l)-Qt(u):1:_t(u)||l<u?-1:1).filter(([l,u])=>{if(l.startsWith("meta.")){const h=l.slice(5);return o[h]=u,!1}return!0});for(const l of a){const u=l[0],h=e.keys[u];if(!h)return y(`Key ${u} is not valid on ${t.kind} schema`);const f=h.parse?h.parse(l[1],t):l[1];f!==ve&&(f!==void 0||h.preserveUndefined)&&(r[u]=f)}if(e.reduce&&!t.prereduced){const l=e.reduce(r,t.$);if(l)return l instanceof A?l.throw():Ph(l,o)}return Fr({id:t.id,kind:t.kind,inner:r,meta:o,$:t.$})},Fr=({id:t,kind:e,inner:n,meta:r,$:i,ignoreCache:s})=>{const o=gn[e],a=Ws(n),c=[];let l={};a.forEach(([$,x])=>{const E=o.keys[$],N=E.serialize??(E.child?Fh:Ke);if(l[$]=N(x),E.child===!0){const C=x;re(C)?c.push(...C):c.push(C)}else typeof E.child=="function"&&c.push(...E.child(x))}),o.finalizeInnerJson&&(l=o.finalizeInnerJson(l));let u={...l},h={};xt(r)||(h=V(r,($,x)=>[$,$==="examples"?x:Ke(x)]),u.meta=Kt(h,"description",!0)),l=Kt(l,o.collapsibleKey,!1);const f=JSON.stringify({kind:e,...l});u=Kt(u,o.collapsibleKey,!1);const p=Kt(u,o.collapsibleKey,!0),g=JSON.stringify({kind:e,...u});if(i.nodesByHash[g]&&!s)return i.nodesByHash[g];const m={id:t,kind:e,impl:o,inner:n,innerEntries:a,innerJson:l,innerHash:f,meta:r,metaJson:h,json:u,hash:g,collapsibleJson:p,children:c};if(e!=="intersection")for(const $ in n)$!=="in"&&$!=="out"&&(m[$]=n[$]);const b=new Uf[e](m,i);return i.nodesByHash[g]=b},Dh=(t,e)=>t.id===e?t:(se(ue[e])&&X(`Unexpected attempt to overwrite node id ${e}`),Fr({id:e,kind:t.kind,inner:t.inner,meta:t.meta,$:t.$,ignoreCache:!0})),Ph=(t,e,n)=>Fr({id:Po(e.alias??t.kind),kind:t.kind,inner:t.inner,meta:e,$:t.$}),Kt=(t,e,n)=>{const r=Object.keys(t);if(r.length===1&&r[0]===e){const i=t[e];if(n||Ue(i,"object")&&(Object.keys(i).length===1||Array.isArray(i)))return i}return t},dr=(t,e,n)=>{if(t.key!==e.key)return null;const r=t.key;let i=te(t.value,e.value,n);const s=t.required||e.required?"required":"optional";if(i instanceof A)if(s==="optional")i=w.intrinsic.never.internal;else return i.withPrefixKey(t.key,t.required&&e.required?"required":"optional");if(s==="required")return n.$.node("required",{key:r,value:i});const o=t.hasDefault()?e.hasDefault()?t.default===e.default?t.default:y(jo(t.default,e.default)):t.default:e.hasDefault()?e.default:ve;return n.$.node("optional",{key:r,value:i,default:o})};class Bo extends at{required=this.kind==="required";optional=this.kind==="optional";impliedBasis=w.intrinsic.object.internal;serializedKey=kt(this.key);compiledKey=typeof this.key=="string"?this.key:this.serializedKey;flatRefs=q(this.value.flatRefs.map(e=>Me([this.key,...e.path],e.node)),Me([this.key],this.value));_transform(e,n){n.path.push(this.key);const r=super._transform(e,n);return n.path.pop(),r}hasDefault(){return"default"in this.inner}traverseAllows=(e,n)=>this.key in e?ye(this.key,()=>this.value.traverseAllows(e[this.key],n),n):this.optional;traverseApply=(e,n)=>{this.key in e?ye(this.key,()=>this.value.traverseApply(e[this.key],n),n):this.hasKind("required")&&n.errorFromNodeContext(this.errorContext)};compile(e){e.if(`${this.serializedKey} in data`,()=>e.traverseKey(this.serializedKey,`data${e.prop(this.key)}`,this.value)),this.hasKind("required")&&e.else(()=>e.traversalKind==="Apply"?e.line(`ctx.errorFromNodeContext(${this.compiledErrorContext})`):e.return(!1)),e.traversalKind==="Allows"&&e.return(!0)}}const jo=(t,e)=>`Invalid intersection of default values ${U(t)} & ${U(e)}`,Th=H({kind:"optional",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)},default:{preserveUndefined:!0}},normalize:t=>t,reduce:(t,e)=>{if(e.resolvedConfig.exactOptionalPropertyTypes===!1&&!t.value.allows(void 0))return e.node("optional",{...t,value:t.value.or(D.undefined)},{prereduced:!0})},defaults:{description:t=>`${t.compiledKey}?: ${t.value.description}`},intersections:{optional:dr}});class Bh extends Bo{constructor(...e){super(...e),"default"in this.inner&&Pr(this.value,this.inner.default,this.key)}get outProp(){if(!this.hasDefault())return this;const{default:e,...n}=this.inner;return this.cacheGetter("outProp",this.$.node("required",n,{prereduced:!0}))}expression=this.hasDefault()?`${this.compiledKey}: ${this.value.expression} = ${U(this.inner.default)}`:`${this.compiledKey}?: ${this.value.expression}`;defaultValueMorph=Kh(this);defaultValueMorphRef=this.defaultValueMorph&&oe(this.defaultValueMorph)}const Dr={implementation:Th,Node:Bh},jh={},Kh=t=>{if(!t.hasDefault())return;const e=`{${t.compiledKey}: ${t.value.id} = ${Ke(t.default)}}`;return jh[e]??=Ko(t.key,t.value,t.default)},Ko=(t,e,n)=>{if(typeof n=="function")return e.includesTransform?(i,s)=>(ye(t,()=>e(i[t]=n(),s),s),i):i=>(i[t]=n(),i);const r=e.includesTransform?e.assert(n):n;return Ue(r,"object")?(i,s)=>(ye(t,()=>e(i[t]=n,s),s),i):i=>(i[t]=r,i)},Pr=(t,e,n)=>{const r=un(e);Ue(e,"object")&&!r&&y(Lh(n));const i=t.in(r?e():e);if(i instanceof Ce){n===null&&y(`Default ${i.summary}`);const s=i.transform(o=>o.transform(a=>({...a,prefixPath:[n]})));y(`Default for ${s.summary}`)}return e},Lh=t=>`Non-primitive default ${t===null?"":typeof t=="number"?`for value at [${t}] `:`for ${kt(t)} `}must be specified as a function like () => ({my: 'object'})`;class Mt extends bo{constructor(e,n){super(e,n),Object.defineProperty(this,Ne,{value:"root",enumerable:!1})}get internal(){return this}get"~standard"(){return{vendor:"arktype",version:1,validate:e=>{const n=this(e);return n instanceof Ce?n:{value:n}}}}as(){return this}brand(e){return e===""?y(qh):this}readonly(){return this}branches=this.hasKind("union")?this.inner.branches:[this];distribute(e,n){const r=this.branches.map(e);return n?.(r)??r}get shortDescription(){return this.meta.description??this.defaultShortDescription}toJsonSchema(){const e=this.innerToJsonSchema();return Object.assign(e,this.metaJson)}intersect(e){const n=this.$.parseDefinition(e),r=this.rawIntersect(n);return r instanceof A?r:this.$.finalize(r)}rawIntersect(e){return Oe(this,e,this.$)}toNeverIfDisjoint(){return this}and(e){const n=this.intersect(e);return n instanceof A?n.throw():n}rawAnd(e){const n=this.rawIntersect(e);return n instanceof A?n.throw():n}or(e){const n=this.$.parseDefinition(e);return this.$.finalize(this.rawOr(n))}rawOr(e){const n=[...this.branches,...e.branches];return this.$.node("union",n)}map(e){return this.$.schema(this.applyStructuralOperation("map",[e]))}pick(...e){return this.$.schema(this.applyStructuralOperation("pick",e))}omit(...e){return this.$.schema(this.applyStructuralOperation("omit",e))}required(){return this.$.schema(this.applyStructuralOperation("required",[]))}partial(){return this.$.schema(this.applyStructuralOperation("partial",[]))}_keyof;keyof(){if(this._keyof)return this._keyof;const e=this.applyStructuralOperation("keyof",[]).reduce((n,r)=>n.intersect(r).toNeverIfDisjoint(),w.intrinsic.unknown.internal);return e.branches.length===0&&y(yo(`keyof ${this.expression}`)),this._keyof=this.$.finalize(e)}get props(){return this.branches.length!==1?y(Uh(this.expression)):[...this.applyStructuralOperation("props",[])[0]]}merge(e){const n=this.$.parseDefinition(e);return this.$.schema(n.distribute(r=>this.applyStructuralOperation("merge",[Ni(r)??y(Ci("merge",r.expression))])))}applyStructuralOperation(e,n){return this.distribute(r=>{if(r.equals(w.intrinsic.object)&&e!=="merge")return r;const i=Ni(r);if(i||y(Ci(e,r.expression)),e==="keyof")return i.keyof();if(e==="get")return i.get(...n);if(e==="props")return i.props;const s=e==="required"?"require":e==="partial"?"optionalize":e;return this.$.node("intersection",{...r.inner,structure:i[s](...n)})})}get(...e){return e[0]===void 0?this:this.$.schema(this.applyStructuralOperation("get",e))}extract(e){const n=this.$.parseDefinition(e);return this.$.schema(this.branches.filter(r=>r.extends(n)))}exclude(e){const n=this.$.parseDefinition(e);return this.$.schema(this.branches.filter(r=>!r.extends(n)))}array(){return this.$.schema(this.isUnknown()?{proto:Array}:{proto:Array,sequence:this},{prereduced:!0})}overlaps(e){return!(this.intersect(e)instanceof A)}extends(e){const n=this.intersect(e);return!(n instanceof A)&&this.equals(n)}ifExtends(e){return this.extends(e)?this:void 0}subsumes(e){return this.$.parseDefinition(e).extends(this)}configure(e,n="shallow"){return this.configureReferences(e,n)}describe(e,n="shallow"){return this.configure({description:e},n)}optional(){return[this,"?"]}default(e){return Pr(this,e,null),[this,"=",e]}from(e){return this.assert(e)}_pipe(...e){const n=e.reduce((r,i)=>r.rawPipeOnce(i),this);return this.$.finalize(n)}tryPipe(...e){const n=e.reduce((r,i)=>r.rawPipeOnce(I(i,"root")?i:(s,o)=>{try{return i(s,o)}catch(a){return o.error({code:"predicate",predicate:i,actual:`aborted due to error:
    ${a}
`})}}),this);return this.$.finalize(n)}pipe=Object.assign(this._pipe.bind(this),{try:this.tryPipe.bind(this)});to(e){return this.$.finalize(this.toNode(this.$.parseDefinition(e)))}toNode(e){const n=cr(this,e,this.$);return n instanceof A?n.throw():n}rawPipeOnce(e){return I(e,"root")?this.toNode(e):this.distribute(n=>n.hasKind("morph")?this.$.node("morph",{in:n.inner.in,morphs:[...n.morphs,e]}):this.$.node("morph",{in:n,morphs:[e]}),this.$.parseSchema)}narrow(e){return this.constrainOut("predicate",e)}constrain(e,n){return this._constrain("root",e,n)}constrainIn(e,n){return this._constrain("in",e,n)}constrainOut(e,n){return this._constrain("out",e,n)}_constrain(e,n,r){const i=this.$.node(n,r);if(i.isRoot())return i.isUnknown()?this:X(`Unexpected constraint node ${i}`);const s=e==="root"?this:this[e];if(s.hasKind("morph")||i.impliedBasis&&!s.extends(i.impliedBasis))return Yd(n,i.impliedBasis,this);const o=this.$.node("intersection",{[i.kind]:i}),a=e==="out"?cr(this,o,this.$):Oe(this,o,this.$);return a instanceof A&&a.throw(),this.$.finalize(a)}onUndeclaredKey(e){const n=typeof e=="string"?e:e.rule,r=typeof e=="string"?!1:e.deep;return this.$.finalize(this.transform((i,s)=>i==="structure"?n==="ignore"?td(s,{undeclared:1}):{...s,undeclared:n}:s,r?void 0:{shouldTransform:i=>!Re(hn,i.kind)}))}hasEqualMorphs(e){return!this.includesTransform&&!e.includesTransform?!0:!(!tt(this.shallowMorphs,e.shallowMorphs)||!tt(this.flatMorphs,e.flatMorphs,{isEqual:(n,r)=>n.propString===r.propString&&(n.node.hasKind("morph")&&r.node.hasKind("morph")?n.node.hasEqualMorphs(r.node):n.node.hasKind("intersection")&&r.node.hasKind("intersection")?n.node.structure?.structuralMorphRef===r.node.structure?.structuralMorphRef:!1)}))}onDeepUndeclaredKey(e){return this.onUndeclaredKey({rule:e,deep:!0})}filter(e){return this.constrainIn("predicate",e)}divisibleBy(e){return this.constrain("divisor",e)}matching(e){return this.constrain("pattern",e)}atLeast(e){return this.constrain("min",e)}atMost(e){return this.constrain("max",e)}moreThan(e){return this.constrain("min",We(e))}lessThan(e){return this.constrain("max",We(e))}atLeastLength(e){return this.constrain("minLength",e)}atMostLength(e){return this.constrain("maxLength",e)}moreThanLength(e){return this.constrain("minLength",We(e))}lessThanLength(e){return this.constrain("maxLength",We(e))}exactlyLength(e){return this.constrain("exactLength",e)}atOrAfter(e){return this.constrain("after",e)}atOrBefore(e){return this.constrain("before",e)}laterThan(e){return this.constrain("after",We(e))}earlierThan(e){return this.constrain("before",We(e))}}const qh="Expected a non-empty brand name after #",We=t=>typeof t=="object"&&!(t instanceof Date)?{...t,exclusive:!0}:{rule:t,exclusive:!0},Lt=(t,e)=>I(e,"root")?I(t,"root")?t.extends(e):e.allows(t):I(t,"root")?t.hasUnit(e):e===t,Ni=t=>t.hasKind("morph")?null:t.hasKind("intersection")?t.inner.structure??(t.basis?.domain==="object"?t.$.bindReference(w.intrinsic.emptyStructure):null):t.isBasis()&&t.domain==="object"?t.$.bindReference(w.intrinsic.emptyStructure):null,Uh=t=>`Props cannot be extracted from a union. Use .distribute to extract props from each branch instead. Received:
${t}`,Ci=(t,e)=>`${t} operand must be an object (was ${e})`,At=(t,e)=>V(Ir(t),(n,r)=>[r,e]),_h=t=>typeof t=="string"?{reference:t}:t,Oi=t=>t instanceof A?w.intrinsic.never.internal:t,Vh=H({kind:"alias",hasAssociatedError:!1,collapsibleKey:"reference",keys:{reference:{serialize:t=>t.startsWith("$")?t:`$ark.${t}`},resolve:{}},normalize:_h,defaults:{description:t=>t.reference},intersections:{alias:(t,e,n)=>n.$.lazilyResolve(()=>Oi(te(t.resolution,e.resolution,n)),`${t.reference}${n.pipe?"=>":"&"}${e.reference}`),...At("alias",(t,e,n)=>e.isUnknown()?t:e.isNever()?e:e.isBasis()&&!e.overlaps(w.intrinsic.object)?A.init("assignability",w.intrinsic.object,e):n.$.lazilyResolve(()=>Oi(te(t.resolution,e,n)),`${t.reference}${n.pipe?"=>":"&"}${e.id}`))}});class zh extends Mt{expression=this.reference;structure=void 0;get resolution(){const e=this._resolve();return ue[this.id]=e}_resolve(){if(this.resolve)return this.resolve();if(this.reference[0]==="$")return this.$.resolveRoot(this.reference.slice(1));const e=this.reference;let n=ue[e];const r=[];for(;I(n,"context");){if(r.includes(n.id))return y(Jh(n.id,r));r.push(n.id),n=ue[n.id]}return I(n,"root")?n:X(`Unexpected resolution for reference ${this.reference}
Seen: [${r.join("->")}] 
Resolution: ${U(n)}`)}get resolutionId(){if(this.reference.includes("&")||this.reference.includes("=>"))return this.resolution.id;if(this.reference[0]!=="$")return this.reference;const e=this.reference.slice(1),n=this.$.resolutions[e];return typeof n=="string"?n:I(n,"root")?n.id:X(`Unexpected resolution for reference ${this.reference}: ${U(n)}`)}get defaultShortDescription(){return Ae.object}innerToJsonSchema(){return Y.throwUnjsonifiableError(this.expression,"cyclic")}traverseAllows=(e,n)=>{const r=n.seen[this.reference];return r?.includes(e)?!0:(n.seen[this.reference]=q(r,e),this.resolution.traverseAllows(e,n))};traverseApply=(e,n)=>{const r=n.seen[this.reference];r?.includes(e)||(n.seen[this.reference]=q(r,e),this.resolution.traverseApply(e,n))};compile(e){const n=this.resolutionId;e.if(`ctx.seen.${n} && ctx.seen.${n}.includes(data)`,()=>e.return(!0)),e.if(`!ctx.seen.${n}`,()=>e.line(`ctx.seen.${n} = []`)),e.line(`ctx.seen.${n}.push(data)`),e.return(e.invoke(n))}}const Jh=(t,e)=>`Alias '${t}' has a shallow resolution cycle: ${[...e,t].join("->")}`,Tr={implementation:Vh,Node:zh};class Br extends Mt{traverseApply=(e,n)=>{this.traverseAllows(e,n)||n.errorFromNodeContext(this.errorContext)};get errorContext(){return{code:this.kind,description:this.description,meta:this.meta,...this.inner}}get compiledErrorContext(){return pn(this.errorContext)}compile(e){e.traversalKind==="Allows"?e.return(this.compiledCondition):e.if(this.compiledNegation,()=>e.line(`${e.ctx}.errorFromNodeContext(${this.compiledErrorContext})`))}}const Wh=H({kind:"domain",hasAssociatedError:!0,collapsibleKey:"domain",keys:{domain:{},numberAllowsNaN:{}},normalize:t=>typeof t=="string"?{domain:t}:Hs(t,"numberAllowsNaN")&&t.domain!=="number"?y(jr.writeBadAllowNanMessage(t.domain)):t,applyConfig:(t,e)=>t.numberAllowsNaN===void 0&&t.domain==="number"&&e.numberAllowsNaN?{...t,numberAllowsNaN:!0}:t,defaults:{description:t=>Ae[t.domain],actual:t=>Number.isNaN(t)?"NaN":Ae[fe(t)]},intersections:{domain:(t,e)=>t.domain==="number"&&e.domain==="number"?t.numberAllowsNaN?e:t:A.init("domain",t,e)}});class Hh extends Br{requiresNaNCheck=this.domain==="number"&&!this.numberAllowsNaN;traverseAllows=this.requiresNaNCheck?e=>typeof e=="number"&&!Number.isNaN(e):e=>fe(e)===this.domain;compiledCondition=this.domain==="object"?'((typeof data === "object" && data !== null) || typeof data === "function")':`typeof data === "${this.domain}"${this.requiresNaNCheck?" && !Number.isNaN(data)":""}`;compiledNegation=this.domain==="object"?'((typeof data !== "object" || data === null) && typeof data !== "function")':`typeof data !== "${this.domain}"${this.requiresNaNCheck?" || Number.isNaN(data)":""}`;expression=this.numberAllowsNaN?"number | NaN":this.domain;get nestableExpression(){return this.numberAllowsNaN?`(${this.expression})`:this.expression}get defaultShortDescription(){return Ae[this.domain]}innerToJsonSchema(){return this.domain==="bigint"||this.domain==="symbol"?Y.throwUnjsonifiableError(this.domain):{type:this.domain}}}const jr={implementation:Wh,Node:Hh,writeBadAllowNanMessage:t=>`numberAllowsNaN may only be specified with domain "number" (was ${t})`},Gh=H({kind:"intersection",hasAssociatedError:!0,normalize:t=>{if(se(t))return t;const{structure:e,...n}=t,r=!!e,i=e??{},s=V(n,(o,a)=>pe(o,Vd)?(r&&y(`Flattened structure key ${o} cannot be specified alongside a root 'structure' key.`),i[o]=a,[]):[o,a]);return(I(i,"constraint")||!xt(i))&&(s.structure=i),s},finalizeInnerJson:({structure:t,...e})=>Ue(t,"object")?{...t,...e}:e,keys:{domain:{child:!0,parse:(t,e)=>e.$.node("domain",t)},proto:{child:!0,parse:(t,e)=>e.$.node("proto",t)},structure:{child:!0,parse:(t,e)=>e.$.node("structure",t),serialize:t=>{if(!t.sequence?.minLength)return t.collapsibleJson;const{sequence:e,...n}=t.collapsibleJson,{minVariadicLength:r,...i}=e,s=i.variadic&&Object.keys(i).length===1?i.variadic:i;return{...n,sequence:s}}},divisor:{child:!0,parse:ae("divisor")},max:{child:!0,parse:ae("max")},min:{child:!0,parse:ae("min")},maxLength:{child:!0,parse:ae("maxLength")},minLength:{child:!0,parse:ae("minLength")},exactLength:{child:!0,parse:ae("exactLength")},before:{child:!0,parse:ae("before")},after:{child:!0,parse:ae("after")},pattern:{child:!0,parse:ae("pattern")},predicate:{child:!0,parse:ae("predicate")}},reduce:(t,e)=>Ii({},t,{$:e,invert:!1,pipe:!1}),defaults:{description:t=>{if(t.children.length===0)return"unknown";if(t.structure)return t.structure.description;const e=[];if(t.basis&&!t.refinements.some(n=>n.impl.obviatesBasisDescription)&&e.push(t.basis.description),t.refinements.length){const n=t.refinements.toSorted((r,i)=>r.kind==="min"&&i.kind==="max"?-1:0).map(r=>r.description);e.push(...n)}return t.inner.predicate&&e.push(...t.inner.predicate.map(n=>n.description)),e.join(" and ")},expected:t=>`   ${t.errors.map(e=>e.expected).join(`
   `)}`,problem:t=>`(${t.actual}) must be...
${t.expected}`},intersections:{intersection:(t,e,n)=>Ii(t.inner,e.inner,n),...At("intersection",(t,e,n)=>{if(t.children.length===0)return e;const{domain:r,proto:i,...s}=t.inner,o=i??r,a=o?te(o,e,n):e;return a instanceof A?a:t?.basis?.equals(a)?t:t.$.node("intersection",{...s,[a.kind]:a},{prereduced:!0})})}});class Zh extends Mt{basis=this.inner.domain??this.inner.proto??null;refinements=this.children.filter(e=>e.isRefinement());structure=this.inner.structure;expression=Qh(this);get shallowMorphs(){return this.inner.structure?.structuralMorph?[this.inner.structure.structuralMorph]:[]}get defaultShortDescription(){return this.basis?.defaultShortDescription??"present"}innerToJsonSchema(){return this.children.reduce((e,n)=>n.isBasis()?n.toJsonSchema():n.reduceJsonSchema(e),{})}traverseAllows=(e,n)=>this.children.every(r=>r.traverseAllows(e,n));traverseApply=(e,n)=>{const r=n.currentErrorCount;if(!(this.basis&&(this.basis.traverseApply(e,n),n.currentErrorCount>r))){if(this.refinements.length){for(let i=0;i<this.refinements.length-1;i++)if(this.refinements[i].traverseApply(e,n),n.failFast&&n.currentErrorCount>r)return;if(this.refinements.at(-1).traverseApply(e,n),n.currentErrorCount>r)return}if(!(this.structure&&(this.structure.traverseApply(e,n),n.currentErrorCount>r))&&this.inner.predicate){for(let i=0;i<this.inner.predicate.length-1;i++)if(this.inner.predicate[i].traverseApply(e,n),n.failFast&&n.currentErrorCount>r)return;this.inner.predicate.at(-1).traverseApply(e,n)}}};compile(e){if(e.traversalKind==="Allows"){this.children.forEach(n=>e.check(n)),e.return(!0);return}if(e.initializeErrorCount(),this.basis&&(e.check(this.basis),this.children.length>1&&e.returnIfFail()),this.refinements.length){for(let n=0;n<this.refinements.length-1;n++)e.check(this.refinements[n]),e.returnIfFailFast();e.check(this.refinements.at(-1)),(this.structure||this.inner.predicate)&&e.returnIfFail()}if(this.structure&&(e.check(this.structure),this.inner.predicate&&e.returnIfFail()),this.inner.predicate){for(let n=0;n<this.inner.predicate.length-1;n++)e.check(this.inner.predicate[n]),e.returnIfFail();e.check(this.inner.predicate.at(-1))}}}const Lo={implementation:Gh,Node:Zh},Qh=t=>{let e=t.structure?.expression||`${t.basis&&!t.refinements.some(n=>n.impl.obviatesBasisExpression)?t.basis.nestableExpression+" ":""}${t.refinements.map(n=>n.expression).join(" & ")}`||"unknown";return e==="Array == 0"&&(e="[]"),e},Ii=(t,e,n)=>{const r={},i=t.proto??t.domain,s=e.proto??e.domain,o=i?s?te(i,s,n):i:s;return o instanceof A?o:(o&&(r[o.kind]=o),Yt({kind:"intersection",baseInner:r,l:Xt(t),r:Xt(e),roots:[],ctx:n}))},Yh=H({kind:"morph",hasAssociatedError:!1,keys:{in:{child:!0,parse:(t,e)=>e.$.parseSchema(t)},morphs:{parse:$t,serialize:t=>t.map(e=>I(e,"root")?e.json:oe(e))},declaredIn:{child:!1,serialize:t=>t.json},declaredOut:{child:!1,serialize:t=>t.json}},normalize:t=>t,defaults:{description:t=>`a morph from ${t.in.description} to ${t.out?.description??"unknown"}`},intersections:{morph:(t,e,n)=>{if(!t.hasEqualMorphs(e))return y(ef(t.expression,e.expression));const r=te(t.in,e.in,n);if(r instanceof A)return r;const i={morphs:t.morphs};if(t.declaredIn||e.declaredIn){const s=te(t.in,e.in,n);if(s instanceof A)return s.throw();i.declaredIn=s}if(t.declaredOut||e.declaredOut){const s=te(t.out,e.out,n);if(s instanceof A)return s.throw();i.declaredOut=s}return r.distribute(s=>n.$.node("morph",{...i,in:s}),n.$.parseSchema)},...At("morph",(t,e,n)=>{const r=t.inner.in?te(t.inner.in,e,n):e;return r instanceof A?r:r.equals(t.inner.in)?t:n.$.node("morph",{...t.inner,in:r})})}});class Xh extends Mt{serializedMorphs=this.morphs.map(oe);compiledMorphs=`[${this.serializedMorphs}]`;lastMorph=this.inner.morphs.at(-1);lastMorphIfNode=I(this.lastMorph,"root")?this.lastMorph:void 0;introspectableIn=this.inner.in;introspectableOut=this.lastMorphIfNode?Object.assign(this.referencesById,this.lastMorphIfNode.referencesById)&&this.lastMorphIfNode.out:void 0;get shallowMorphs(){return Array.isArray(this.inner.in?.shallowMorphs)?[...this.inner.in.shallowMorphs,...this.morphs]:this.morphs}get in(){return this.declaredIn??this.inner.in?.in??w.intrinsic.unknown.internal}get out(){return this.declaredOut??this.introspectableOut??w.intrinsic.unknown.internal}declareIn(e){return this.$.node("morph",{...this.inner,declaredIn:e})}declareOut(e){return this.$.node("morph",{...this.inner,declaredOut:e})}expression=`(In: ${this.in.expression}) => ${this.lastMorphIfNode?"To":"Out"}<${this.out.expression}>`;get defaultShortDescription(){return this.in.meta.description??this.in.defaultShortDescription}innerToJsonSchema(){return Y.throwUnjsonifiableError(this.expression,"morph")}compile(e){if(e.traversalKind==="Allows"){if(!this.introspectableIn)return;e.return(e.invoke(this.introspectableIn));return}this.introspectableIn&&e.line(e.invoke(this.introspectableIn)),e.line(`ctx.queueMorphs(${this.compiledMorphs})`)}traverseAllows=(e,n)=>!this.introspectableIn||this.introspectableIn.traverseAllows(e,n);traverseApply=(e,n)=>{this.introspectableIn&&this.introspectableIn.traverseApply(e,n),n.queueMorphs(this.morphs)};hasEqualMorphs(e){return tt(this.morphs,e.morphs,{isEqual:(n,r)=>n===r||I(n,"root")&&I(r,"root")&&n.equals(r)})}}const qo={implementation:Yh,Node:Xh},ef=(t,e)=>`The intersection of distinct morphs at a single path is indeterminate:
Left: ${t}
Right: ${e}`,tf=H({kind:"proto",hasAssociatedError:!0,collapsibleKey:"proto",keys:{proto:{serialize:t=>Nr(t)??Ke(t)},dateAllowsInvalid:{}},normalize:t=>{const e=typeof t=="string"?{proto:nt[t]}:typeof t=="function"?se(t)?t:{proto:t}:typeof t.proto=="string"?{...t,proto:nt[t.proto]}:t;return typeof e.proto!="function"&&y(tn.writeInvalidSchemaMessage(e.proto)),Hs(e,"dateAllowsInvalid")&&e.proto!==Date&&y(tn.writeBadInvalidDateMessage(e.proto)),e},applyConfig:(t,e)=>t.dateAllowsInvalid===void 0&&t.proto===Date&&e.dateAllowsInvalid?{...t,dateAllowsInvalid:!0}:t,defaults:{description:t=>t.builtinName?cd[t.builtinName]:`an instance of ${t.proto.name}`,actual:t=>t instanceof Date&&t.toString()==="Invalid Date"?"an invalid Date":er(t)},intersections:{proto:(t,e)=>t.proto===Date&&e.proto===Date?t.dateAllowsInvalid?e:t:bi(t.proto,e.proto)?t:bi(e.proto,t.proto)?e:A.init("proto",t,e),domain:(t,e)=>e.domain==="object"?t:A.init("domain",w.intrinsic.object.internal,e)}});class nf extends Br{builtinName=Nr(this.proto);serializedConstructor=this.json.proto;requiresInvalidDateCheck=this.proto===Date&&!this.dateAllowsInvalid;traverseAllows=this.requiresInvalidDateCheck?e=>e instanceof Date&&e.toString()!=="Invalid Date":e=>e instanceof this.proto;compiledCondition=`data instanceof ${this.serializedConstructor}${this.requiresInvalidDateCheck?' && data.toString() !== "Invalid Date"':""}`;compiledNegation=`!(${this.compiledCondition})`;innerToJsonSchema(){switch(this.builtinName){case"Array":return{type:"array"};default:return Y.throwUnjsonifiableError(this.description)}}expression=this.dateAllowsInvalid?"Date | InvalidDate":this.proto.name;get nestableExpression(){return this.dateAllowsInvalid?`(${this.expression})`:this.expression}domain="object";get defaultShortDescription(){return this.description}}const tn={implementation:tf,Node:nf,writeBadInvalidDateMessage:t=>`dateAllowsInvalid may only be specified with constructor Date (was ${t.name})`,writeInvalidSchemaMessage:t=>`instanceOf operand must be a function (was ${fe(t)})`},rf=H({kind:"union",hasAssociatedError:!0,collapsibleKey:"branches",keys:{ordered:{},branches:{child:!0,parse:(t,e)=>{const n=[];return t.forEach(r=>{(I(r,"root")?r.branches:e.$.parseSchema(r).branches).forEach(s=>{if(s.hasKind("morph")){const o=n.findIndex(a=>a.hasKind("morph")&&a.hasEqualMorphs(s));if(o===-1)n.push(s);else{const a=n[o];n[o]=e.$.node("morph",{...a.inner,in:a.in.rawOr(s.in)})}}else n.push(s)})}),e.def.ordered||n.sort((r,i)=>r.hash<i.hash?-1:1),n}}},normalize:t=>re(t)?{branches:t}:t,reduce:(t,e)=>{const n=mf(t);if(n.length===1)return n[0];if(n.length!==t.branches.length)return e.node("union",{...t,branches:n},{prereduced:!0})},defaults:{description:t=>t.distribute(e=>e.description,Ye),expected:t=>{const e=zs(t.errors,"propString"),n=Object.entries(e).map(([r,i])=>{const s=[];i.forEach(c=>Pe(s,c.expected));const o=Ye(s),a=i.every(c=>c.actual===i[0].actual)?i[0].actual:U(i[0].data);return`${r&&`${r} `}must be ${o}${a&&` (was ${a})`}`});return Ye(n)},problem:t=>t.expected,message:t=>t.problem},intersections:{union:(t,e,n)=>{if(t.isNever!==e.isNever)return A.init("presence",t,e);let r;return t.ordered?(e.ordered&&y(bf(t.expression,e.expression)),r=Fn(e.branches,t.branches,n),r instanceof A&&r.invert()):r=Fn(t.branches,e.branches,n),r instanceof A?r:n.$.parseSchema(t.ordered||e.ordered?{branches:r,ordered:!0}:{branches:r})},...At("union",(t,e,n)=>{const r=Fn(t.branches,[e],n);return r instanceof A?r:r.length===1?r[0]:n.$.parseSchema(t.ordered?{branches:r,ordered:!0}:{branches:r})})}});class sf extends Mt{isBoolean=this.branches.length===2&&this.branches[0].hasUnit(!1)&&this.branches[1].hasUnit(!0);get branchGroups(){const e=[];let n=-1;return this.branches.forEach(r=>{if(r.hasKind("unit")&&r.domain==="boolean"){n===-1?(n=e.length,e.push(r)):e[n]=w.intrinsic.boolean;return}e.push(r)}),e}unitBranches=this.branches.filter(e=>e.in.hasKind("unit"));discriminant=this.discriminate();discriminantJson=this.discriminant?hf(this.discriminant):null;expression=this.distribute(e=>e.nestableExpression,pf);createBranchedOptimisticRootApply(){return(e,n)=>{const r=this.traverseOptimistic(e);if(r!==ve)return r;const i=new Ze(e,this.$.resolvedConfig);return this.traverseApply(e,i),i.finalize(n)}}get shallowMorphs(){return this.branches.reduce((e,n)=>Pe(e,n.shallowMorphs),[])}get defaultShortDescription(){return this.distribute(e=>e.defaultShortDescription,Ye)}innerToJsonSchema(){return this.branchGroups.length===1&&this.branchGroups[0].equals(w.intrinsic.boolean)?{type:"boolean"}:{anyOf:this.branchGroups.map(e=>e.toJsonSchema())}}traverseAllows=(e,n)=>this.branches.some(r=>r.traverseAllows(e,n));traverseApply=(e,n)=>{const r=[];for(let i=0;i<this.branches.length;i++){if(n.pushBranch(),this.branches[i].traverseApply(e,n),!n.hasError())return this.branches[i].includesTransform?n.queuedMorphs.push(...n.popBranch().queuedMorphs):n.popBranch();r.push(n.popBranch().error)}n.errorFromNodeContext({code:"union",errors:r,meta:this.meta})};traverseOptimistic=e=>{for(let n=0;n<this.branches.length;n++){const r=this.branches[n];if(r.traverseAllows(e))return r.contextFreeMorph?r.contextFreeMorph(e):e}return ve};compile(e){if(!this.discriminant||this.unitBranches.length===this.branches.length&&this.branches.length===2)return this.compileIndiscriminable(e);let n=this.discriminant.optionallyChainedPropString;this.discriminant.kind==="domain"&&(n=`typeof ${n} === "object" ? ${n} === null ? "null" : "object" : typeof ${n} === "function" ? "object" : typeof ${n}`);const r=this.discriminant.cases,i=Object.keys(r),{optimistic:s}=e;if(e.optimistic=!1,e.block(`switch(${n})`,()=>{for(const u in r){const h=r[u],f=u==="default"?u:`case ${u}`;e.line(`${f}: return ${h===!0?s?e.data:h:s?`${e.invoke(h)} ? ${h.contextFreeMorph?`${oe(h.contextFreeMorph)}(${e.data})`:e.data} : "${ve}"`:e.invoke(h)}`)}return e}),e.traversalKind==="Allows"){e.return(s?`"${ve}"`:!1);return}const o=Ye(this.discriminant.kind==="domain"?i.map(u=>{const h=u.slice(1,-1);return h==="function"?Ae.object:Ae[h]}):i),a=this.discriminant.path.map(u=>typeof u=="symbol"?oe(u):JSON.stringify(u)),c=JSON.stringify(o),l=this.discriminant.kind==="domain"?`${uf}[${n}]`:`${df}(${n})`;e.line(`ctx.errorFromNodeContext({
	code: "predicate",
	expected: ${c},
	actual: ${l},
	relativePath: [${a}],
	meta: ${this.compiledMeta}
})`)}compileIndiscriminable(e){if(e.traversalKind==="Apply")e.const("errors","[]"),this.branches.forEach(n=>e.line("ctx.pushBranch()").line(e.invoke(n)).if("!ctx.hasError()",()=>e.return(n.includesTransform?"ctx.queuedMorphs.push(...ctx.popBranch().queuedMorphs)":"ctx.popBranch()")).line("errors.push(ctx.popBranch().error)")),e.line(`ctx.errorFromNodeContext({ code: "union", errors, meta: ${this.compiledMeta} })`);else{const{optimistic:n}=e;e.optimistic=!1,this.branches.forEach(r=>e.if(`${e.invoke(r)}`,()=>e.return(n?r.contextFreeMorph?`${oe(r.contextFreeMorph)}(${e.data})`:e.data:!0))),e.return(n?`"${ve}"`:!1)}}get nestableExpression(){return this.isBoolean?"boolean":`(${this.expression})`}discriminate(){if(this.branches.length<2)return null;if(this.unitBranches.length===this.branches.length){const s=V(this.unitBranches,(o,a)=>[`${a.in.serializedValue}`,a.hasKind("morph")?a:!0]);return{kind:"unit",path:[],optionallyChainedPropString:"data",cases:s}}const e=[];for(let s=0;s<this.branches.length-1;s++){const o=this.branches[s];for(let a=s+1;a<this.branches.length;a++){const c=this.branches[a],l=Oe(o.in,c.in,o.$);if(l instanceof A)for(const u of l){if(!u.kind||u.optional)continue;let h,f;if(u.kind==="domain"){const g=u.l,m=u.r;h=`"${typeof g=="string"?g:g.domain}"`,f=`"${typeof m=="string"?m:m.domain}"`}else if(u.kind==="unit")h=u.l.serializedValue,f=u.r.serializedValue;else continue;const p=e.find(g=>tt(g.path,u.path)&&g.kind===u.kind);p?(p.cases[h]?p.cases[h].branchIndices=Pe(p.cases[h].branchIndices,s):p.cases[h]??={branchIndices:[s],condition:u.l},p.cases[f]?p.cases[f].branchIndices=Pe(p.cases[f].branchIndices,a):p.cases[f]??={branchIndices:[a],condition:u.r}):e.push({kind:u.kind,cases:{[h]:{branchIndices:[s],condition:u.l},[f]:{branchIndices:[a],condition:u.r}},path:u.path})}}}const n=this.ordered?lf(e,this.branches):e;if(!n.length)return null;const r=of(n,this),i={};for(const s in r.best.cases){const o=af(r,s);if(o===null){i[s]=!0;continue}if(o.length===this.branches.length)return null;this.ordered&&o.sort((l,u)=>l.originalIndex-u.originalIndex);const a=o.map(l=>l.branch),c=a.length===1?a[0]:this.$.node("union",this.ordered?{branches:a,ordered:!0}:a);Object.assign(this.referencesById,c.referencesById),i[s]=c}if(r.defaultEntries.length){const s=r.defaultEntries.map(o=>o.branch);i.default=this.$.node("union",this.ordered?{branches:s,ordered:!0}:s,{prereduced:!0}),Object.assign(this.referencesById,i.default.referencesById)}return Object.assign(r.location,{cases:i})}}const of=(t,e)=>{const n=t.sort((s,o)=>Object.keys(o.cases).length-Object.keys(s.cases).length)[0],r={kind:n.kind,path:n.path,optionallyChainedPropString:Uo(n.path)},i=e.branches.map((s,o)=>({originalIndex:o,branch:s}));return{best:n,location:r,defaultEntries:i,node:e}},af=(t,e)=>{const n=t.best.cases[e],r=cf(n.condition,t.location.path,t.node.$);let i=[];const s=[];for(let o=0;o<t.defaultEntries.length;o++){const a=t.defaultEntries[o];if(n.branchIndices.includes(a.originalIndex)){const c=Ri(t.node.branches[a.originalIndex],t.location);c===null?i=null:i?.push({originalIndex:a.originalIndex,branch:c})}else if(a.branch.hasKind("alias")&&r.hasKind("domain")&&r.domain==="object")i?.push(a);else{if(a.branch.in.overlaps(r)){const c=Ri(a.branch,t.location);i?.push({originalIndex:a.originalIndex,branch:c})}s.push(a)}}return t.defaultEntries=s,i},lf=(t,e)=>t.filter(r=>{const i=Object.values(r.cases).map(s=>s.branchIndices);for(let s=0;s<i.length-1;s++){const o=i[s];for(let a=s+1;a<i.length;a++){const c=i[a];for(const l of o)for(const u of c)if(l>u&&e[l].overlaps(e[u]))return!1}}return!0}),cf=(t,e,n)=>{let r=t==="undefined"?n.node("unit",{unit:void 0}):t==="null"?n.node("unit",{unit:null}):t==="boolean"?n.units([!0,!1]):t;for(let i=e.length-1;i>=0;i--){const s=e[i];r=n.node("intersection",typeof s=="number"?{proto:"Array",sequence:[...Wu(s).map(o=>({})),r]}:{domain:"object",required:[{key:s,value:r}]})}return r},Uo=t=>t.reduce((e,n)=>e+uo(n,!0),"data"),uf=oe(Gu),df=oe(U),_o={implementation:rf,Node:sf},hf=t=>({kind:t.kind,path:t.path.map(e=>typeof e=="string"?e:kt(e)),cases:V(t.cases,(e,n)=>[e,n===!0?n:n.hasKind("union")&&n.discriminantJson?n.discriminantJson:n.json])}),ff={delimiter:" | ",finalDelimiter:" | "},pf=t=>Ye(t,ff),Ye=(t,e)=>{const n=e?.delimiter??", ",r=e?.finalDelimiter??" or ";if(t.length===0)return"never";if(t.length===1)return t[0];if(t.length===2&&t[0]==="false"&&t[1]==="true"||t[0]==="true"&&t[1]==="false")return"boolean";const i={},s=t.filter(a=>i[a]?!1:i[a]=!0),o=s.pop();return`${s.join(n)}${s.length?r:""}${o}`},Fn=(t,e,n)=>{const r=e.map(()=>[]);for(let s=0;s<t.length;s++){let o={};for(let a=0;a<e.length;a++){if(r[a]===null)continue;if(t[s].equals(e[a])){r[a]=null,o={};break}const c=te(t[s],e[a],n);if(!(c instanceof A)){if(c.equals(t[s])){r[a].push(t[s]),o={};break}c.equals(e[a])?r[a]=null:o[a]=c}}for(const a in o)r[a][s]=o[a]}const i=r.flatMap((s,o)=>s?.flatMap(a=>a.branches)??e[o]);return i.length===0?A.init("union",t,e):i},mf=({branches:t,ordered:e})=>{if(t.length<2)return t;const n=t.map(()=>!0);for(let r=0;r<t.length;r++)for(let i=r+1;i<t.length&&n[r]&&n[i];i++){if(t[r].equals(t[i])){n[i]=!1;continue}const s=Oe(t[r].in,t[i].in,t[0].$);s instanceof A||(e||gf(t[r],t[i]),s.equals(t[r].in)?n[r]=!!e:s.equals(t[i].in)&&(n[i]=!1))}return t.filter((r,i)=>n[i])},gf=(t,e)=>{!t.includesTransform&&!e.includesTransform||(tt(t.shallowMorphs,e.shallowMorphs)||y(Fi(t.expression,e.expression)),tt(t.flatMorphs,e.flatMorphs,{isEqual:(n,r)=>n.propString===r.propString&&(n.node.hasKind("morph")&&r.node.hasKind("morph")?n.node.hasEqualMorphs(r.node):n.node.hasKind("intersection")&&r.node.hasKind("intersection")?n.node.structure?.structuralMorphRef===r.node.structure?.structuralMorphRef:!1)})||y(Fi(t.expression,e.expression)))},Ri=(t,e)=>t.transform((n,r)=>n==="domain"||n==="unit"?null:r,{shouldTransform:(n,r)=>{const i=Uo(r.path);return e.optionallyChainedPropString.startsWith(i)?n.hasKind("domain")&&n.domain==="object"||(n.hasKind("domain")||e.kind==="unit")&&i===e.optionallyChainedPropString?!0:n.children.length!==0&&n.kind!=="index":!1}}),Fi=(t,e)=>`An unordered union of a type including a morph and a type with overlapping input is indeterminate:
Left: ${t}
Right: ${e}`,bf=(t,e)=>`The intersection of two ordered unions is indeterminate:
Left: ${t}
Right: ${e}`,vf=H({kind:"unit",hasAssociatedError:!0,keys:{unit:{preserveUndefined:!0,serialize:t=>t instanceof Date?t.toISOString():Ke(t)}},normalize:t=>t,defaults:{description:t=>U(t.unit),problem:({expected:t,actual:e})=>`${t===e?`must be reference equal to ${t} (serialized to the same value)`:`must be ${t} (was ${e})`}`},intersections:{unit:(t,e)=>A.init("unit",t,e),...At("unit",(t,e)=>{if(e.allows(t.unit))return t;const n=e.hasKind("intersection")?e.basis:e;if(n){const r=n.hasKind("domain")?n:w.intrinsic.object;if(t.domain!==r.domain){const i=t.domain==="undefined"||t.domain==="null"||t.domain==="boolean"?t.domain:w.intrinsic[t.domain];return A.init("domain",i,r)}}return A.init("assignability",t,e.hasKind("intersection")?e.children.find(r=>!r.allows(t.unit)):e)})}});class yf extends Br{compiledValue=this.json.unit;serializedValue=typeof this.unit=="string"||this.unit instanceof Date?JSON.stringify(this.compiledValue):`${this.compiledValue}`;compiledCondition=Di(this.unit,this.serializedValue);compiledNegation=Di(this.unit,this.serializedValue,"negated");expression=U(this.unit);domain=fe(this.unit);get defaultShortDescription(){return this.domain==="object"?Ae.object:this.description}innerToJsonSchema(){return w.intrinsic.jsonPrimitive.allows(this.unit)?{const:this.unit}:Y.throwUnjsonifiableError(this.defaultShortDescription)}traverseAllows=this.unit instanceof Date?e=>e instanceof Date&&e.toISOString()===this.compiledValue:Number.isNaN(this.unit)?e=>Number.isNaN(e):e=>e===this.unit}const Vo={implementation:vf,Node:yf},Di=(t,e,n)=>{if(t instanceof Date){const r=`data instanceof Date && data.toISOString() === ${e}`;return n?`!(${r})`:r}return Number.isNaN(t)?`${n?"!":""}Number.isNaN(data)`:`data ${n?"!":"="}== ${e}`},$f=H({kind:"index",hasAssociatedError:!1,intersectionIsOpen:!0,keys:{signature:{child:!0,parse:(t,e)=>{const n=e.$.parseSchema(t);if(!n.extends(w.intrinsic.key))return y(Sf(n.expression));const r=n.branches.filter(i=>i.hasKind("unit"));return r.length?y(wf(r.map(i=>U(i.unit)))):n}},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)}},normalize:t=>t,defaults:{description:t=>`[${t.signature.expression}]: ${t.value.description}`},intersections:{index:(t,e,n)=>{if(t.signature.equals(e.signature)){const r=te(t.value,e.value,n),i=r instanceof A?w.intrinsic.never.internal:r;return n.$.node("index",{signature:t.signature,value:i})}return t.signature.extends(e.signature)&&t.value.subsumes(e.value)?e:e.signature.extends(t.signature)&&e.value.subsumes(t.value)?t:null}}});class xf extends at{impliedBasis=w.intrinsic.object.internal;expression=`[${this.signature.expression}]: ${this.value.expression}`;flatRefs=q(this.value.flatRefs.map(e=>Me([this.signature,...e.path],e.node)),Me([this.signature],this.value));traverseAllows=(e,n)=>Xn(e).every(r=>this.signature.traverseAllows(r[0],n)?ye(r[0],()=>this.value.traverseAllows(r[1],n),n):!0);traverseApply=(e,n)=>Xn(e).forEach(r=>{this.signature.traverseAllows(r[0],n)&&ye(r[0],()=>this.value.traverseApply(r[1],n),n)});_transform(e,n){n.path.push(this.signature);const r=super._transform(e,n);return n.path.pop(),r}compile(){}}const zo={implementation:$f,Node:xf},wf=t=>`Index keys ${t.join(", ")} should be specified as named props.`,Sf=t=>`Indexed key definition '${t}' must be a string or symbol`,Ef=H({kind:"required",hasAssociatedError:!0,intersectionIsOpen:!0,keys:{key:{},value:{child:!0,parse:(t,e)=>e.$.parseSchema(t)}},normalize:t=>t,defaults:{description:t=>`${t.compiledKey}: ${t.value.description}`,expected:t=>t.missingValueDescription,actual:()=>"missing"},intersections:{required:dr,optional:dr}});class kf extends Bo{expression=`${this.compiledKey}: ${this.value.expression}`;errorContext=Object.freeze({code:"required",missingValueDescription:this.value.defaultShortDescription,relativePath:[this.key],meta:this.meta});compiledErrorContext=pn(this.errorContext)}const Jo={implementation:Ef,Node:kf},Mf=H({kind:"sequence",hasAssociatedError:!1,collapsibleKey:"variadic",keys:{prefix:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(n=>e.$.parseSchema(n))}},optionals:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(n=>e.$.parseSchema(n))}},defaultables:{child:t=>t.map(e=>e[0]),parse:(t,e)=>{if(t.length!==0)return t.map(n=>{const r=e.$.parseSchema(n[0]);return Pr(r,n[1],null),[r,n[1]]})},serialize:t=>t.map(e=>[e[0].collapsibleJson,Ke(e[1])])},variadic:{child:!0,parse:(t,e)=>e.$.parseSchema(t,e)},minVariadicLength:{parse:t=>t===0?void 0:t},postfix:{child:!0,parse:(t,e)=>{if(t.length!==0)return t.map(n=>e.$.parseSchema(n))}}},normalize:t=>{if(typeof t=="string")return{variadic:t};if("variadic"in t||"prefix"in t||"defaultables"in t||"optionals"in t||"postfix"in t||"minVariadicLength"in t){if(t.postfix?.length){if(!t.variadic)return y(If);if(t.optionals?.length||t.defaultables?.length)return y(Ho)}return t.minVariadicLength&&!t.variadic?y("minVariadicLength may not be specified without a variadic element"):t}return{variadic:t}},reduce:(t,e)=>{let n=t.minVariadicLength??0;const r=t.prefix?.slice()??[],i=t.defaultables?.slice()??[],s=t.optionals?.slice()??[],o=t.postfix?.slice()??[];if(t.variadic){for(;s.at(-1)?.equals(t.variadic);)s.pop();if(s.length===0&&i.length===0)for(;r.at(-1)?.equals(t.variadic);)r.pop(),n++;for(;o[0]?.equals(t.variadic);)o.shift(),n++}else s.length===0&&i.length===0&&r.push(...o.splice(0));if(n!==t.minVariadicLength||t.prefix&&t.prefix.length!==r.length)return e.node("sequence",{...t,prefix:r,defaultables:i,optionals:s,postfix:o,minVariadicLength:n},{prereduced:!0})},defaults:{description:t=>t.isVariadicOnly?`${t.variadic.nestableExpression}[]`:`[${t.tuple.map(n=>n.kind==="defaultables"?`${n.node.nestableExpression} = ${U(n.default)}`:n.kind==="optionals"?`${n.node.nestableExpression}?`:n.kind==="variadic"?`...${n.node.nestableExpression}[]`:n.node.expression).join(", ")}]`},intersections:{sequence:(t,e,n)=>{const r=ht({l:t.tuple,r:e.tuple,disjoint:new A,result:[],fixedVariants:[],ctx:n}),i=r.disjoint.length===0?[r,...r.fixedVariants]:r.fixedVariants;return i.length===0?r.disjoint:i.length===1?n.$.node("sequence",Pi(i[0].result)):n.$.node("union",i.map(s=>({proto:Array,sequence:Pi(s.result)})))}}});class Af extends at{impliedBasis=w.intrinsic.Array.internal;tuple=Of(this.inner);prefixLength=this.prefix?.length??0;defaultablesLength=this.defaultables?.length??0;optionalsLength=this.optionals?.length??0;postfixLength=this.postfix?.length??0;defaultablesAndOptionals=[];prevariadic=this.tuple.filter(e=>e.kind==="defaultables"||e.kind==="optionals"?(this.defaultablesAndOptionals.push(e.node),!0):e.kind==="prefix");variadicOrPostfix=De(this.variadic&&[this.variadic],this.postfix);flatRefs=this.addFlatRefs();addFlatRefs(){return xi(this.flatRefs,this.prevariadic.flatMap((e,n)=>q(e.node.flatRefs.map(r=>Me([`${n}`,...r.path],r.node)),Me([`${n}`],e.node)))),xi(this.flatRefs,this.variadicOrPostfix.flatMap(e=>q(e.flatRefs.map(n=>Me([w.intrinsic.nonNegativeIntegerString.internal,...n.path],n.node)),Me([w.intrinsic.nonNegativeIntegerString.internal],e)))),this.flatRefs}isVariadicOnly=this.prevariadic.length+this.postfixLength===0;minVariadicLength=this.inner.minVariadicLength??0;minLength=this.prefixLength+this.minVariadicLength+this.postfixLength;minLengthNode=this.minLength===0?null:this.$.node("minLength",this.minLength);maxLength=this.variadic?null:this.tuple.length;maxLengthNode=this.maxLength===null?null:this.$.node("maxLength",this.maxLength);impliedSiblings=this.minLengthNode?this.maxLengthNode?[this.minLengthNode,this.maxLengthNode]:[this.minLengthNode]:this.maxLengthNode?[this.maxLengthNode]:[];defaultValueMorphs=Cf(this);defaultValueMorphsReference=this.defaultValueMorphs.length?oe(this.defaultValueMorphs):void 0;elementAtIndex(e,n){if(n<this.prevariadic.length)return this.tuple[n];const r=e.length-this.postfixLength;return n>=r?{kind:"postfix",node:this.postfix[n-r]}:{kind:"variadic",node:this.variadic??X(`Unexpected attempt to access index ${n} on ${this}`)}}traverseAllows=(e,n)=>{for(let r=0;r<e.length;r++)if(!this.elementAtIndex(e,r).node.traverseAllows(e[r],n))return!1;return!0};traverseApply=(e,n)=>{let r=0;for(;r<e.length;r++)ye(r,()=>this.elementAtIndex(e,r).node.traverseApply(e[r],n),n)};get element(){return this.cacheGetter("element",this.$.node("union",this.children))}compile(e){this.prefix?.forEach((n,r)=>e.traverseKey(`${r}`,`data[${r}]`,n)),this.defaultablesAndOptionals.forEach((n,r)=>{const i=`${r+this.prefixLength}`;e.if(`${i} >= ${e.data}.length`,()=>e.traversalKind==="Allows"?e.return(!0):e.return()),e.traverseKey(i,`data[${i}]`,n)}),this.variadic&&(this.postfix&&e.const("firstPostfixIndex",`${e.data}.length${this.postfix?`- ${this.postfix.length}`:""}`),e.for(`i < ${this.postfix?"firstPostfixIndex":"data.length"}`,()=>e.traverseKey("i","data[i]",this.variadic),this.prevariadic.length),this.postfix?.forEach((n,r)=>{const i=`firstPostfixIndex + ${r}`;e.traverseKey(i,`data[${i}]`,n)})),e.traversalKind==="Allows"&&e.return(!0)}_transform(e,n){n.path.push(w.intrinsic.nonNegativeIntegerString.internal);const r=super._transform(e,n);return n.path.pop(),r}expression=this.description;reduceJsonSchema(e){return this.prefix&&(e.prefixItems=this.prefix.map(n=>n.toJsonSchema())),this.optionals?Y.throwUnjsonifiableError(`Optional tuple element${this.optionalsLength>1?"s":""} ${this.optionals.join(", ")}`):(this.variadic?(e.items=this.variadic?.toJsonSchema(),this.minLength&&(e.minItems=this.minLength),this.maxLength&&(e.maxItems=this.maxLength)):(e.items=!1,delete e.minItems,delete e.maxItems),this.postfix?Y.throwUnjsonifiableError(`Postfix tuple element${this.postfixLength>1?"s":""} ${this.postfix.join(", ")}`):e)}}const Nf={},Cf=t=>{if(!t.defaultables)return[];const e=[];let n="[";const r=t.prefixLength+t.defaultablesLength-1;for(let i=t.prefixLength;i<=r;i++){const[s,o]=t.defaultables[i-t.prefixLength];e.push(Ko(i,s,o)),n+=`${i}: ${s.id} = ${Ke(o)}, `}return n+="]",Nf[n]??=e},Wo={implementation:Mf,Node:Af},Of=t=>{const e=[];return t.prefix?.forEach(n=>e.push({kind:"prefix",node:n})),t.defaultables?.forEach(([n,r])=>e.push({kind:"defaultables",node:n,default:r})),t.optionals?.forEach(n=>e.push({kind:"optionals",node:n})),t.variadic&&e.push({kind:"variadic",node:t.variadic}),t.postfix?.forEach(n=>e.push({kind:"postfix",node:n})),e},Pi=t=>t.reduce((e,n)=>(n.kind==="variadic"?e.variadic=n.node:n.kind==="defaultables"?e.defaultables=q(e.defaultables,[[n.node,n.default]]):e[n.kind]=q(e[n.kind],n.node),e),{}),Ho="A postfix required element cannot follow an optional or defaultable element",If="A postfix element requires a variadic element",ht=t=>{const[e,...n]=t.l,[r,...i]=t.r;if(!e||!r)return t;const s=n.at(-1)?.kind==="postfix",o=i.at(-1)?.kind==="postfix",a=e.kind==="prefix"||r.kind==="prefix"?"prefix":e.kind==="postfix"||r.kind==="postfix"?"postfix":e.kind==="variadic"&&r.kind==="variadic"?"variadic":s||o?"prefix":e.kind==="defaultables"||r.kind==="defaultables"?"defaultables":"optionals";if(e.kind==="prefix"&&r.kind==="variadic"&&o){const h=ht({...t,fixedVariants:[],r:i.map(f=>({...f,kind:"prefix"}))});h.disjoint.length===0&&t.fixedVariants.push(h)}else if(r.kind==="prefix"&&e.kind==="variadic"&&s){const h=ht({...t,fixedVariants:[],l:n.map(f=>({...f,kind:"prefix"}))});h.disjoint.length===0&&t.fixedVariants.push(h)}const c=te(e.node,r.node,t.ctx);if(c instanceof A)if(a==="prefix"||a==="postfix")t.disjoint.push(...c.withPrefixKey(a==="prefix"?t.result.length:`-${n.length+1}`,"required")),t.result=[...t.result,{kind:a,node:w.intrinsic.never.internal}];else return a==="optionals"||a==="defaultables"?t:ht({...t,fixedVariants:[],l:n.map(h=>({...h,kind:"prefix"})),r:n.map(h=>({...h,kind:"prefix"}))});else a==="defaultables"?(e.kind==="defaultables"&&r.kind==="defaultables"&&e.default!==r.default&&y(jo(e.default,r.default)),t.result=[...t.result,{kind:a,node:c,default:e.kind==="defaultables"?e.default:r.kind==="defaultables"?r.default:X(`Unexpected defaultable intersection from ${e.kind} and ${r.kind} elements.`)}]):t.result=[...t.result,{kind:a,node:c}];const l=t.l.length,u=t.r.length;return(e.kind!=="variadic"||l>=u&&(r.kind==="variadic"||u===1))&&(t.l=n),(r.kind!=="variadic"||u>=l&&(e.kind==="variadic"||l===1))&&(t.r=i),ht(t)},Go=t=>e=>{if(e.props.length||e.index){const n=e.index?.map(i=>i[t])??[];e.props.forEach(i=>n.push(i[t])),e.undeclared&&n.push(`+ (undeclared): ${e.undeclared}`);const r=`{ ${n.join(", ")} }`;return e.sequence?`${r} & ${e.sequence.description}`:r}return e.sequence?.description??"{}"},Rf=Go("description"),Ff=Go("expression"),Df=H({kind:"structure",hasAssociatedError:!1,normalize:t=>t,applyConfig:(t,e)=>!t.undeclared&&e.onUndeclaredKey!=="ignore"?{...t,undeclared:e.onUndeclaredKey}:t,keys:{required:{child:!0,parse:ae("required"),reduceIo:(t,e,n)=>{e.required=q(e.required,n.map(r=>r[t]))}},optional:{child:!0,parse:ae("optional"),reduceIo:(t,e,n)=>{if(t==="in"){e.optional=n.map(r=>r.in);return}n.forEach(r=>e[r.outProp.kind]=q(e[r.outProp.kind],r.outProp.out))}},index:{child:!0,parse:ae("index")},sequence:{child:!0,parse:ae("sequence")},undeclared:{parse:t=>t==="ignore"?void 0:t,reduceIo:(t,e,n)=>{n==="delete"&&(t==="in"?delete e.undeclared:e.undeclared="reject")}}},defaults:{description:Rf},intersections:{structure:(t,e,n)=>{const r={...t.inner},i={...e.inner},s=new A;if(t.undeclared){const c=t.keyof();e.requiredKeys.forEach(l=>{c.allows(l)||s.add("presence",w.intrinsic.never.internal,e.propsByKey[l].value,{path:[l]})}),i.optional&&(i.optional=i.optional.filter(l=>c.allows(l.key))),i.index&&(i.index=i.index.flatMap(l=>{if(l.signature.extends(c))return l;const u=Oe(c,l.signature,n.$);if(u instanceof A)return[];const h=hr(u,l.value,n.$);return h.required&&(i.required=De(i.required,h.required)),h.optional&&(i.optional=De(i.optional,h.optional)),h.index??[]}))}if(e.undeclared){const c=e.keyof();t.requiredKeys.forEach(l=>{c.allows(l)||s.add("presence",t.propsByKey[l].value,w.intrinsic.never.internal,{path:[l]})}),r.optional&&(r.optional=r.optional.filter(l=>c.allows(l.key))),r.index&&(r.index=r.index.flatMap(l=>{if(l.signature.extends(c))return l;const u=Oe(c,l.signature,n.$);if(u instanceof A)return[];const h=hr(u,l.value,n.$);return h.required&&(r.required=De(r.required,h.required)),h.optional&&(r.optional=De(r.optional,h.optional)),h.index??[]}))}const o={};(t.undeclared||e.undeclared)&&(o.undeclared=t.undeclared==="reject"||e.undeclared==="reject"?"reject":"delete");const a=Yt({kind:"structure",baseInner:o,l:Xt(r),r:Xt(i),roots:[],ctx:n});return a instanceof A&&s.push(...a),s.length?s:a}}});class Pf extends at{impliedBasis=w.intrinsic.object.internal;impliedSiblings=this.children.flatMap(e=>e.impliedSiblings??[]);props=De(this.required,this.optional);propsByKey=V(this.props,(e,n)=>[n.key,n]);propsByKeyReference=oe(this.propsByKey);expression=Ff(this);requiredKeys=this.required?.map(e=>e.key)??[];optionalKeys=this.optional?.map(e=>e.key)??[];literalKeys=[...this.requiredKeys,...this.optionalKeys];_keyof;keyof(){if(this._keyof)return this._keyof;let e=this.$.units(this.literalKeys).branches;return this.index?.forEach(({signature:n})=>{e=e.concat(n.branches)}),this._keyof=this.$.node("union",e)}map(e){return this.$.node("structure",this.props.flatMap(e).reduce((n,r)=>{const i=this.propsByKey[r.key];if(se(r))return r.kind!=="required"&&r.kind!=="optional"?y(`Map result must have kind "required" or "optional" (was ${r.kind})`):(n[r.kind]=q(n[r.kind],r),n);const s=r.kind??i?.kind??"required",o=V(r,(a,c)=>a in Dr.implementation.keys?[a,c]:[]);return n[s]=q(n[s],this.$.node(s,o)),n},{}))}assertHasKeys(e){const n=e.filter(r=>!Lt(r,this.keyof()));if(n.length)return y(Ti(this.expression,n))}get(e,...n){let r,i=!1;const s=Kf(e);if((typeof s=="string"||typeof s=="symbol")&&this.propsByKey[s]&&(r=this.propsByKey[s].value,i=this.propsByKey[s].required),this.index?.forEach(a=>{Lt(s,a.signature)&&(r=r?.and(a.value)??a.value)}),this.sequence&&Lt(s,w.intrinsic.nonNegativeIntegerString))if(I(s,"root"))this.sequence.variadic&&(r=r?.and(this.sequence.element)??this.sequence.element);else{const a=Number.parseInt(s);if(a<this.sequence.prevariadic.length){const c=this.sequence.prevariadic[a].node;r=r?.and(c)??c,i||=a<this.sequence.prefixLength}else if(this.sequence.variadic){const c=this.$.node("union",this.sequence.variadicOrPostfix);r=r?.and(c)??c}}if(!r)return this.sequence?.variadic&&I(s,"root")&&s.extends(w.intrinsic.number)?y(Lf(s.expression,this.sequence.expression)):y(Ti(this.expression,[s]));const o=r.get(...n);return i?o:o.or(w.intrinsic.undefined)}pick(...e){return this.assertHasKeys(e),this.$.node("structure",this.filterKeys("pick",e))}omit(...e){return this.assertHasKeys(e),this.$.node("structure",this.filterKeys("omit",e))}optionalize(){const{required:e,...n}=this.inner;return this.$.node("structure",{...n,optional:this.props.map(r=>r.hasKind("required")?this.$.node("optional",r.inner):r)})}require(){const{optional:e,...n}=this.inner;return this.$.node("structure",{...n,required:this.props.map(r=>r.hasKind("optional")?{key:r.key,value:r.value}:r)})}merge(e){const n=this.filterKeys("omit",[e.keyof()]);return e.required&&(n.required=q(n.required,e.required)),e.optional&&(n.optional=q(n.optional,e.optional)),e.index&&(n.index=q(n.index,e.index)),e.sequence&&(n.sequence=e.sequence),e.undeclared?n.undeclared=e.undeclared:delete n.undeclared,this.$.node("structure",n)}filterKeys(e,n){const r=fo(this.inner),i=s=>{const o=n.some(a=>Lt(s,a));return e==="pick"?o:!o};return r.required&&(r.required=r.required.filter(s=>i(s.key))),r.optional&&(r.optional=r.optional.filter(s=>i(s.key))),r.index&&(r.index=r.index.filter(s=>i(s.signature))),r}traverseAllows=(e,n)=>this._traverse("Allows",e,n);traverseApply=(e,n)=>this._traverse("Apply",e,n);_traverse=(e,n,r)=>{const i=r?.currentErrorCount??0;for(let s=0;s<this.props.length;s++)if(e==="Allows"){if(!this.props[s].traverseAllows(n,r))return!1}else if(this.props[s].traverseApply(n,r),r.failFast&&r.currentErrorCount>i)return!1;if(this.sequence){if(e==="Allows"){if(!this.sequence.traverseAllows(n,r))return!1}else if(this.sequence.traverseApply(n,r),r.failFast&&r.currentErrorCount>i)return!1}if(this.index||this.undeclared==="reject"){const s=Object.keys(n);s.push(...Object.getOwnPropertySymbols(n));for(let o=0;o<s.length;o++){const a=s[o];if(this.index){for(const c of this.index)if(c.signature.traverseAllows(a,r)){if(e==="Allows"){if(!ye(a,()=>c.value.traverseAllows(n[a],r),r))return!1}else if(ye(a,()=>c.value.traverseApply(n[a],r),r),r.failFast&&r.currentErrorCount>i)return!1}}if(this.undeclared==="reject"&&!this.declaresKey(a)&&(e==="Allows"||(r.errorFromNodeContext({code:"predicate",expected:"removed",actual:"",relativePath:[a],meta:this.meta}),r.failFast)))return!1}}return this.structuralMorph&&r&&!r.hasError()&&r.queueMorphs([this.structuralMorph]),!0};get defaultable(){return this.cacheGetter("defaultable",this.optional?.filter(e=>e.hasDefault())??[])}declaresKey=e=>e in this.propsByKey||this.index?.some(n=>n.signature.allows(e))||this.sequence!==void 0&&w.intrinsic.nonNegativeIntegerString.allows(e);_compileDeclaresKey(e){const n=[];return this.props.length&&n.push(`k in ${this.propsByKeyReference}`),this.index?.forEach(r=>n.push(e.invoke(r.signature,{kind:"Allows",arg:"k"}))),this.sequence&&n.push("$ark.intrinsic.nonNegativeIntegerString.allows(k)"),n.join(" || ")||"false"}get structuralMorph(){return this.cacheGetter("structuralMorph",Bf(this))}structuralMorphRef=this.structuralMorph&&oe(this.structuralMorph);compile(e){if(e.traversalKind==="Apply"&&e.initializeErrorCount(),this.props.forEach(n=>{e.check(n),e.traversalKind==="Apply"&&e.returnIfFailFast()}),this.sequence&&(e.check(this.sequence),e.traversalKind==="Apply"&&e.returnIfFailFast()),(this.index||this.undeclared==="reject")&&(e.const("keys","Object.keys(data)"),e.line("keys.push(...Object.getOwnPropertySymbols(data))"),e.for("i < keys.length",()=>this.compileExhaustiveEntry(e))),e.traversalKind==="Allows")return e.return(!0);this.structuralMorphRef&&e.if("ctx && !ctx.hasError()",()=>(e.line("ctx.queueMorphs(["),jf(e,this),e.line("])")))}compileExhaustiveEntry(e){return e.const("k","keys[i]"),this.index?.forEach(n=>{e.if(`${e.invoke(n.signature,{arg:"k",kind:"Allows"})}`,()=>e.traverseKey("k","data[k]",n.value))}),this.undeclared==="reject"&&e.if(`!(${this._compileDeclaresKey(e)})`,()=>e.traversalKind==="Allows"?e.return(!1):e.line(`ctx.errorFromNodeContext({ code: "predicate", expected: "removed", actual: "", relativePath: [k], meta: ${this.compiledMeta} })`).if("ctx.failFast",()=>e.return())),e}reduceJsonSchema(e){switch(e.type){case"object":return this.reduceObjectJsonSchema(e);case"array":return this.props.length||this.index?Y.throwUnjsonifiableError(`Additional properties on array ${this.expression}`):this.sequence?.reduceJsonSchema(e)??e;default:return Y.throwInternalOperandError("structure",e)}}reduceObjectJsonSchema(e){return this.props.length&&(e.properties={},this.props.forEach(n=>{if(typeof n.key=="symbol")return Y.throwUnjsonifiableError(`Symbolic key ${n.serializedKey}`);e.properties[n.key]=n.value.toJsonSchema()}),this.requiredKeys.length&&(e.required=this.requiredKeys)),this.index?.forEach(n=>{if(n.signature.equals(w.intrinsic.string))return e.additionalProperties=n.value.toJsonSchema();if(!n.signature.extends(w.intrinsic.string))return Y.throwUnjsonifiableError(`Symbolic index signature ${n.signature.exclude(w.intrinsic.string)}`);n.signature.branches.forEach(r=>{if(!r.hasKind("intersection")||r.inner.pattern?.length!==1)return Y.throwUnjsonifiableError(`Index signature ${r}`);e.patternProperties??={},e.patternProperties[r.inner.pattern[0].rule]=n.value.toJsonSchema()})}),this.undeclared&&!e.additionalProperties&&(e.additionalProperties=!1),e}}const Dn={},Tf=t=>{let e="";for(let n=0;n<t.defaultable.length;n++)e+=t.defaultable[n].defaultValueMorphRef;return t.sequence?.defaultValueMorphsReference&&(e+=t.sequence?.defaultValueMorphsReference),t.undeclared==="delete"&&(e+="delete !(",t.required?.forEach(n=>e+=n.compiledKey+" | "),t.optional?.forEach(n=>e+=n.compiledKey+" | "),t.index?.forEach(n=>e+=n.signature.id+" | "),t.sequence&&(t.sequence.maxLength===null?e+=D.nonNegativeIntegerString.id:e+=t.sequence.tuple.forEach((n,r)=>e+=r+" | ")),e+=")"),e},Bf=t=>{const e=Tf(t);if(!e)return;if(Dn[e])return Dn[e];const n=(r,i)=>{for(let s=0;s<t.defaultable.length;s++)t.defaultable[s].key in r||t.defaultable[s].defaultValueMorph(r,i);if(t.sequence?.defaultables)for(let s=r.length-t.sequence.prefixLength;s<t.sequence.defaultables.length;s++)t.sequence.defaultValueMorphs[s](r,i);if(t.undeclared==="delete")for(const s in r)t.declaresKey(s)||delete r[s];return r};return Dn[e]=n},jf=(t,e)=>{const r=`(data${e.defaultable.some(i=>i.defaultValueMorph.length===2)||e.sequence?.defaultValueMorphs.some(i=>i.length===2)?", ctx":""})`;return t.block(`${r} => `,i=>{for(let s=0;s<e.defaultable.length;s++){const{serializedKey:o,defaultValueMorphRef:a}=e.defaultable[s];i.if(`!(${o} in data)`,c=>c.line(`${a}${r}`))}return e.sequence?.defaultables&&i.for(`i < ${e.sequence.defaultables.length}`,s=>s.set("data[i]",5),`data.length - ${e.sequence.prefixLength}`),e.undeclared==="delete"&&i.forIn("data",s=>s.if(`!(${e._compileDeclaresKey(s)})`,o=>o.line("delete data[k]"))),i.return("data")})},Zo={implementation:Df,Node:Pf},Kf=t=>(I(t,"root")&&t.hasKind("unit")&&(t=t.unit),typeof t=="number"&&(t=`${t}`),t),Lf=(t,e)=>`${t} is not allowed as an array index on ${e}. Use the 'nonNegativeIntegerString' keyword instead.`,hr=(t,e,n)=>{const[r,i]=Ju(t.branches,o=>o.hasKind("unit"));if(!r.length)return{index:n.node("index",{signature:t,value:e})};const s={};return r.forEach(o=>{const a=n.node("required",{key:o.unit,value:e});s[a.kind]=q(s[a.kind],a)}),i.length&&(s.index=n.node("index",{signature:i,value:e})),s},qf=t=>I(t,"root")?t.expression:U(t),Ti=(t,e)=>`Key${e.length===1?"":"s"} ${e.map(qf).join(", ")} ${e.length===1?"does":"do"} not exist on ${t}`,gn={...Nh,alias:Tr.implementation,domain:jr.implementation,unit:Vo.implementation,proto:tn.implementation,union:_o.implementation,morph:qo.implementation,intersection:Lo.implementation,divisor:wo.implementation,pattern:Do.implementation,predicate:xo.implementation,required:Jo.implementation,optional:Dr.implementation,index:zo.implementation,sequence:Wo.implementation,structure:Zo.implementation};w.defaultConfig=rd(Object.assign(V(gn,(t,e)=>[t,e.defaults]),{jitless:pd(),clone:ud,onUndeclaredKey:"ignore",exactOptionalPropertyTypes:!0,numberAllowsNaN:!1,dateAllowsInvalid:!1,onFail:null,keywords:{}}));w.resolvedConfig=ar(w.defaultConfig,w.config);const Uf={...Ch,alias:Tr.Node,domain:jr.Node,unit:Vo.Node,proto:tn.Node,union:_o.Node,morph:qo.Node,intersection:Lo.Node,divisor:wo.Node,pattern:Do.Node,predicate:xo.Node,required:Jo.Node,optional:Dr.Node,index:zo.Node,sequence:Wo.Node,structure:Zo.Node};class fr extends Yu{get[Ne](){return"module"}}const Qo=(t,e)=>new fr(V(t,(n,r)=>[n,I(r,"module")?Qo(r,e):e.bindReference(r)])),_f=t=>re(t)?t:"branches"in t&&re(t.branches)?t.branches:void 0,Vf=(t,e)=>y(`Node of kind ${e} is not valid as a ${t} definition`),Bi=t=>`#${t} duplicates public alias ${t}`,Pn={};w.ambient??={};let ji;const Yo="function $",zf=t=>Xo(t,ea(t)),Xo=(t,e)=>{const n=e.write(Yo),r=e.compile()();for(const i of t)i.precompilation||(i.traverseAllows=r[`${i.id}Allows`].bind(r),i.isRoot()&&!i.allowsRequiresContext&&(i.allows=i.traverseAllows),i.traverseApply=r[`${i.id}Apply`].bind(r),r[`${i.id}Optimistic`]&&(i.traverseOptimistic=r[`${i.id}Optimistic`].bind(r)),i.precompilation=n)},ea=t=>new co().return(t.reduce((e,n)=>{const r=new Rn({kind:"Allows"}).indent();n.compile(r);const i=r.write(`${n.id}Allows`),s=new Rn({kind:"Apply"}).indent();n.compile(s);const o=s.write(`${n.id}Apply`),a=`${e}${i},
${o},
`;if(!n.hasKind("union"))return a;const c=new Rn({kind:"Allows",optimistic:!0}).indent();n.compile(c);const l=c.write(`${n.id}Optimistic`);return`${a}${l},
`},`{
`)+"}");class ta{config;resolvedConfig;name;get[Ne](){return"scope"}referencesById={};references=[];resolutions={};exportedNames=[];aliases={};resolved=!1;nodesByHash={};intrinsic;constructor(e,n){this.config=ar(w.config,n),this.resolvedConfig=ar(w.resolvedConfig,n),this.name=this.resolvedConfig.name??`anonymousScope${Object.keys(Pn).length}`,this.name in Pn&&y(`A Scope already named ${this.name} already exists`),Pn[this.name]=this,Object.entries(e).map(i=>this.preparseOwnAliasEntry(...i)).forEach(([i,s])=>{let o=i;if(i[0]==="#"?(o=i.slice(1),o in this.aliases&&y(Bi(o)),this.aliases[o]=s):(o in this.aliases&&y(Bi(i)),this.aliases[o]=s,this.exportedNames.push(o)),!I(s,"module")&&!I(s,"generic")&&!un(s)){const a=this.preparseOwnDefinitionFormat(s,{alias:o});I(a,"root")?this.resolutions[o]=this.bindReference(a):this.resolutions[o]=this.createParseContext(a).id}}),ji??=this.node("union",{branches:["string","number","object","bigint","symbol",{unit:!0},{unit:!1},{unit:void 0},{unit:null}]},{prereduced:!0}),this.nodesByHash[ji.hash]=this.node("intersection",{},{prereduced:!0}),this.intrinsic=w.intrinsic?V(w.intrinsic,(i,s)=>i.startsWith("json")?[]:[i,this.bindReference(s)]):{}}cacheGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}get internal(){return this}_json;get json(){return this._json||this.export(),this._json}defineSchema(e){return e}generic=(...e)=>{const n=this;return(r,i)=>new en(e,i?new $o(r):r,n,n,i??null)};units=(e,n)=>{const r=[];for(const s of e)r.includes(s)||r.push(s);const i=r.map(s=>this.node("unit",{unit:s},n));return this.node("union",i,{...n,prereduced:!0})};lazyResolutions=[];lazilyResolve(e,n){const r=this.node("alias",{reference:n??"synthetic",resolve:e},{prereduced:!0});return this.resolved||this.lazyResolutions.push(r),r}schema=(e,n)=>this.finalize(this.parseSchema(e,n));parseSchema=(e,n)=>this.node(Vt(e),e,n);preparseNode(e,n,r){let i=typeof e=="string"?e:Vt(n,e);if(se(n)&&n.kind===i)return n;if(i==="alias"&&!r?.prereduced){const{reference:a}=Tr.implementation.normalize(n,this);if(a.startsWith("$")){const c=this.resolveRoot(a.slice(1));n=c,i=c.kind}}else if(i==="union"&&Ue(n,"object")){const a=_f(n);a?.length===1&&(n=a[0],i=Vt(n))}if(se(n)&&n.kind===i)return n;const o=gn[i].normalize?.(n,this)??n;return se(o)?o.kind===i?o:Vf(i,o.kind):{...r,$:this,kind:i,def:o,prefix:r.alias??i}}bindReference(e){let n;return se(e)?n=e.$===this?e:new e.constructor(e.attachments,this):n=e.$===this?e:new en(e.params,e.bodyDef,e.$,this,e.hkt),this.resolved||Object.assign(this.referencesById,n.referencesById),n}resolveRoot(e){return this.maybeResolveRoot(e)??y(sa(e))}maybeResolveRoot(e){const n=this.maybeResolve(e);if(!I(n,"generic"))return n}maybeResolveSubalias(e){return pr(this.aliases,e)??pr(this.ambient,e)}get ambient(){return w.ambient}maybeResolve(e){const n=this.resolutions[e];if(n){if(typeof n!="string")return this.bindReference(n);const i=ue[n];if(I(i,"root"))return this.resolutions[e]=i;if(I(i,"context")){if(i.phase==="resolving")return this.node("alias",{reference:`$${e}`},{prereduced:!0});if(i.phase==="resolved")return X(`Unexpected resolved context for was uncached by its scope: ${U(i)}`);i.phase="resolving";const s=this.bindReference(this.parseOwnDefinitionFormat(i.def,i));return i.phase="resolved",ue[s.id]=s,ue[i.id]=s,this.resolutions[e]=s}return X(`Unexpected nodesById entry for ${n}: ${U(i)}`)}let r=this.aliases[e]??this.ambient?.[e];return r?(r=this.normalizeRootScopeValue(r),I(r,"generic")?this.resolutions[e]=this.bindReference(r):I(r,"module")?r.root?this.resolutions[e]=this.bindReference(r.root):y(oa(e)):this.resolutions[e]=this.parse(r,{alias:e})):this.maybeResolveSubalias(e)}createParseContext(e){const n=e.id??Po(e.prefix);return ue[n]=Object.assign(e,{[Ne]:"context",$:this,id:n,phase:"unresolved"})}traversal(e){return new Ze(e,this.resolvedConfig)}import(...e){return new fr(V(this.export(...e),(n,r)=>[`#${n}`,r]))}precompilation;_exportedResolutions;_exports;export(...e){if(!this._exports){this._exports={};for(const r of this.exportedNames){const i=this.aliases[r];this._exports[r]=I(i,"module")?Qo(i,this):Ki(this.maybeResolve(r))}if(this.lazyResolutions.forEach(r=>r.resolution),this._exportedResolutions=ia(this,this._exports),this._json=ra(this._exportedResolutions),Object.assign(this.resolutions,this._exportedResolutions),this.references=Object.values(this.referencesById),!this.resolvedConfig.jitless){const r=ea(this.references);this.precompilation=r.write(Yo),Xo(this.references,r)}this.resolved=!0}const n=e.length?e:this.exportedNames;return new fr(V(n,(r,i)=>[i,this._exports[i]]))}resolve(e){return this.export()[e]}node=(e,n,r={})=>{const i=this.preparseNode(e,n,r);if(se(i))return this.bindReference(i);const s=this.createParseContext(i),o=To(s),a=this.bindReference(o);return ue[s.id]=a};parse=(e,n={})=>this.finalize(this.parseDefinition(e,n));parseDefinition(e,n={}){if(I(e,"root"))return this.bindReference(e);const r=this.preparseOwnDefinitionFormat(e,n);if(I(r,"root"))return this.bindReference(r);const i=this.createParseContext(r);ue[i.id]=i;let s=this.bindReference(this.parseOwnDefinitionFormat(e,i));return s.isCyclic&&(s=Dh(s,i.id)),ue[i.id]=s,s}finalize(e){return Ki(e),!e.precompilation&&!this.resolvedConfig.jitless&&zf(e.references),e}}class na extends ta{parseOwnDefinitionFormat(e,n){return To(n)}preparseOwnDefinitionFormat(e,n){return this.preparseNode(Vt(e),e,n)}preparseOwnAliasEntry(e,n){return[e,n]}normalizeRootScopeValue(e){return e}}const Ki=t=>(t.references.filter(e=>e.hasKind("alias")).forEach(e=>{Object.assign(e.referencesById,e.resolution.referencesById),t.references.forEach(n=>{e.id in n.referencesById&&Object.assign(n.referencesById,e.referencesById)})}),t),ra=t=>V(t,(e,n)=>[e,I(n,"root")||I(n,"generic")?n.json:I(n,"module")?ra(n):X(`Unexpected resolution ${U(n)}`)]),pr=(t,e)=>{const n=e.indexOf(".");if(n===-1)return;const r=e.slice(0,n),i=t[r];if(i===void 0)return;if(!I(i,"module"))return y(Jf(r));const s=e.slice(n+1),o=i[s];if(o===void 0)return pr(i,s);if(I(o,"root")||I(o,"generic"))return o;if(I(o,"module"))return o.root??y(oa(e));X(`Unexpected resolution for alias '${e}': ${U(o)}`)},Kr=(t,e)=>new na(t,e),Nt=new na({}),ia=(t,e)=>{const n={};for(const r in e){const i=e[r];if(I(i,"module")){const s=ia(t,i),o=V(s,(a,c)=>[`${r}.${a}`,c]);Object.assign(n,o)}else I(i,"root")||I(i,"generic")?n[r]=i:X(`Unexpected scope resolution ${U(i)}`)}return n},sa=t=>`'${t}' is unresolvable`,Jf=t=>`'${t}' must reference a module to be accessed using dot syntax`,oa=t=>`Reference to submodule '${t}' must specify an alias`;Nt.export();const J=Nt.schema,Lr=Nt.node;Nt.defineSchema;const $e=Nt.generic,aa="^(?:0|[1-9]\\d*)$",Wf=new RegExp(aa);oe(Wf);const la=Kr({bigint:"bigint",boolean:[{unit:!1},{unit:!0}],false:{unit:!1},never:[],null:{unit:null},number:"number",object:"object",string:"string",symbol:"symbol",true:{unit:!0},unknown:{},undefined:{unit:void 0},Array,Date},{prereducedAliases:!0}).export();w.intrinsic={...la};const ca=Kr({integer:{domain:"number",divisor:1},lengthBoundable:["string",Array],key:["string","symbol"],nonNegativeIntegerString:{domain:"string",pattern:aa}},{prereducedAliases:!0}).export();Object.assign(w.intrinsic,ca);const Hf=Kr({jsonPrimitive:["string","number",{unit:!0},{unit:!1},{unit:null}],jsonObject:{domain:"object",index:{signature:"string",value:"$jsonData"}},jsonData:["$jsonPrimitive","$jsonObject"]},{prereducedAliases:!0}).export(),D={...la,...ca,...Hf,emptyStructure:Lr("structure",{},{prereduced:!0})};w.intrinsic={...D};const Gf=t=>typeof t=="string"&&t[0]==="d"&&(t[1]==="'"||t[1]==='"')&&t.at(-1)===t[1],Li=t=>t.toString()!=="Invalid Date",Zf=t=>t.slice(2,-1),ua=t=>`'${t}' could not be parsed by the Date constructor`,Qf=(t,e)=>Yf(t,e),Yf=(t,e)=>{const n=new Date(t);if(Li(n))return n;const r=Nd(t);if(r!==void 0){const i=new Date(r);if(Li(i))return i}return e?y(e===!0?ua(t):e):void 0},qi=(t,e)=>{const n=t.scanner.shiftUntil(ep[ha[e]]);if(t.scanner.lookahead==="")return t.error(np(n,e));if(t.scanner.shift(),e==="/"){try{new RegExp(n)}catch(r){y(String(r))}t.root=t.ctx.$.node("intersection",{domain:"string",pattern:n},{prereduced:!0})}else if(pe(e,da))t.root=t.ctx.$.node("unit",{unit:n});else{const r=Qf(n,ua(n));t.root=t.ctx.$.node("unit",{meta:n,unit:r})}},da={"'":1,'"':1},Xf={"/":1,"'":1,'"':1},ha={"d'":"'",'d"':'"',"'":"'",'"':'"',"/":"/"},ep={"'":t=>t.lookahead==="'",'"':t=>t.lookahead==='"',"/":t=>t.lookahead==="/"},tp={'"':"double-quote","'":"single-quote","/":"forward slash"},np=(t,e)=>`${e}${t} requires a closing ${tp[ha[e]]}`,rp=t=>`Private type references should not include '#'. Use '${t}' instead.`,fa="Optional definitions like 'string?' are only valid as properties in an object or tuple",pa="Defaultable definitions like 'number = 0' are only valid as properties in an object or tuple",ip={">":!0,">=":!0},sp={"<":!0,"<=":!0},nn={"<":">",">":"<","<=":">=",">=":"<=","==":"=="},op=t=>`Unmatched )${t===""?"":` before ${t}`}`,ma=t=>`Missing ${t}`,ap=(t,e)=>`Left bounds are only valid when paired with right bounds (try ...${e}${t})`,ga=t=>`Left-bounded expressions must specify their limits using < or <= (was ${t})`,lp=(t,e,n,r)=>`An expression may have at most one left bound (parsed ${t}${nn[e]}, ${n}${nn[r]})`,cp=(t,e,n)=>ba(t,e,n,[]),ba=(t,e,n,r)=>{const i=n.parseUntilFinalizer();return r.push(i.root),i.finalizer===">"?r.length!==e.params.length?n.error(va(t,e.names,r.map(s=>s.expression))):r:i.finalizer===","?ba(t,e,n,r):i.error(ma(">"))},va=(t,e,n)=>`${t}<${e.join(", ")}> requires exactly ${e.length} args (got ${n.length}${n.length===0?"":`: ${n.join(", ")}`})`,Ui=t=>{const e=t.scanner.shiftUntilNextTerminator();e==="keyof"?t.addPrefix("keyof"):t.root=dp(t,e)},up=(t,e,n)=>{if(n.scanner.shiftUntilNonWhitespace(),n.scanner.shift()!=="<")return n.error(va(t,e.names,[]));const i=cp(t,e,n);return e(...i)},dp=(t,e)=>hp(t,e)??fp(t,e)??t.error(e===""?t.scanner.lookahead==="#"?rp(t.shiftedByOne().scanner.shiftUntilNextTerminator()):ya(t):sa(e)),hp=(t,e)=>{if(t.ctx.args?.[e]){const r=t.ctx.args[e];return typeof r!="string"?r:t.ctx.$.node("alias",{reference:r},{prereduced:!0})}const n=t.ctx.$.maybeResolve(e);if(I(n,"root"))return n;if(n!==void 0)return I(n,"generic")?up(e,n,t):y(`Unexpected resolution ${U(n)}`)},fp=(t,e)=>{const n=Cd(e);if(n!==void 0)return t.ctx.$.node("unit",{unit:n});const r=Id(e);if(r!==void 0)return t.ctx.$.node("unit",{unit:r})},ya=t=>{const e=t.previousOperator();return e?$a(e,t.scanner.unscanned):pp(t.scanner.unscanned)},$a=(t,e="")=>`Token '${t}' requires a right operand${e?` before '${e}'`:""}`,pp=t=>`Expected an expression${t?` before '${t}'`:""}`,xa=t=>t.scanner.lookahead===""?t.error(ya(t)):t.scanner.lookahead==="("?t.shiftedByOne().reduceGroupOpen():t.scanner.lookaheadIsIn(Xf)?qi(t,t.scanner.shift()):t.scanner.lookaheadIsIn(dn)?xa(t.shiftedByOne()):t.scanner.lookahead==="d"&&t.scanner.nextLookahead in da?qi(t,`${t.scanner.shift()}${t.scanner.shift()}`):Ui(t);class it extends Kd{shiftUntilNextTerminator(){return this.shiftUntilNonWhitespace(),this.shiftUntil(()=>this.lookahead in it.terminatingChars)}static terminatingChars={"<":1,">":1,"=":1,"|":1,"&":1,")":1,"[":1,"%":1,",":1,":":1,"?":1,"#":1,...dn};static finalizingLookaheads={">":1,",":1,"":1,"=":1,"?":1};static lookaheadIsFinalizing=(e,n)=>e===">"?n[0]==="="?n[1]==="=":n.trimStart()===""||pe(n.trimStart()[0],it.terminatingChars):e==="="?n[0]!=="=":e===","||e==="?"}const mp=(t,e)=>{const n=bp(t,e);if(t.root.hasKind("unit")){if(typeof t.root.unit=="number"){t.reduceLeftBound(t.root.unit,n),t.unsetRoot();return}if(t.root.unit instanceof Date){const r=`d'${t.root.description??t.root.unit.toISOString()}'`;t.unsetRoot(),t.reduceLeftBound(r,n);return}}return yp(t,n)},gp={"<":1,">":1,"=":1},bp=(t,e)=>t.scanner.lookaheadIs("=")?`${e}${t.scanner.shift()}`:e,_i=(t,e,n,r)=>n.extends(w.intrinsic.number)?typeof e!="number"?y(mr(t,e,r)):t==="=="?["min","max"]:t[0]===">"?["min"]:["max"]:n.extends(w.intrinsic.lengthBoundable)?typeof e!="number"?y(mr(t,e,r)):t==="=="?["exactLength"]:t[0]===">"?["minLength"]:["maxLength"]:n.extends(w.intrinsic.Date)?t==="=="?["after","before"]:t[0]===">"?["after"]:["before"]:y(fh(n.expression)),vp=t=>({rule:Gf(t.limit)?Zf(t.limit):t.limit,exclusive:t.comparator.length===1}),yp=(t,e)=>{const n=t.unsetRoot(),r=t.scanner.location;t.parseOperand();const i=t.unsetRoot(),s=t.scanner.sliceChars(r,t.scanner.location);if(t.root=n,!i.hasKind("unit")||typeof i.unit!="number"&&!(i.unit instanceof Date))return t.error(mr(e,s,"right"));const o=i.unit,a=e.length===1,c=_i(e,typeof o=="number"?o:s,n,"right");for(const u of c)t.constrainRoot(u,e==="=="?{rule:o}:{rule:o,exclusive:a});if(!t.branches.leftBound)return;if(!pe(e,sp))return t.error(ga(e));const l=_i(t.branches.leftBound.comparator,t.branches.leftBound.limit,n,"left");t.constrainRoot(l[0],vp(t.branches.leftBound)),t.branches.leftBound=null},mr=(t,e,n)=>`Comparator ${n==="left"?nn[t]:t} must be ${n==="left"?"preceded":"followed"} by a corresponding literal (was ${e})`,$p=t=>{t.scanner.shiftUntilNonWhitespace();const e=t.scanner.shiftUntilNextTerminator();t.root=t.root.brand(e)},xp=t=>{const e=t.scanner.shiftUntilNextTerminator(),n=Od(e,{errorOnFail:Vi(e)});n===0&&t.error(Vi(0)),t.root=t.root.constrain("divisor",n)},Vi=t=>`% operator must be followed by a non-zero integer literal (was ${t})`,wa=t=>{const e=t.scanner.shift();return e===""?t.finalize(""):e==="["?t.scanner.shift()==="]"?t.setRoot(t.root.array()):t.error(wp):e==="|"?t.scanner.lookahead===">"?t.shiftedByOne().pushRootToBranch("|>"):t.pushRootToBranch(e):e==="&"?t.pushRootToBranch(e):e===")"?t.finalizeGroup():it.lookaheadIsFinalizing(e,t.scanner.unscanned)?t.finalize(e):pe(e,gp)?mp(t,e):e==="%"?xp(t):e==="#"?$p(t):e in dn?wa(t):t.error(qr(e))},qr=(t,e="")=>`'${t}' is not allowed here${e&&` (should be ${e})`}`,wp="Missing expected ']'",Sp=t=>{const e=t.unsetRoot();t.parseOperand();const n=t.unsetRoot();if(!n.hasKind("unit"))return t.error(Ep(n.expression));const r=n.unit instanceof Date?()=>new Date(n.unit):n.unit;return[e,"=",r]},Ep=t=>`Default value '${t}' must a literal value`,zi=(t,e)=>{const n=e.$.maybeResolveRoot(t);if(n)return n;if(t.endsWith("[]")){const s=e.$.maybeResolveRoot(t.slice(0,-2));if(s)return s.array()}const r=new bn(new it(t),e),i=kp(r);return r.finalizer===">"&&y(qr(">")),i},kp=t=>{t.parseOperand();let e=Ur(t).root;return e?(t.finalizer==="="?e=Sp(t):t.finalizer==="?"&&(e=[e,"?"]),t.scanner.shiftUntilNonWhitespace(),t.scanner.lookahead&&y(qr(t.scanner.lookahead)),e):X(`Root was unexpectedly unset after parsing string '${t.scanner.scanned}'`)},Ur=t=>{for(;t.finalizer===void 0;)Mp(t);return t},Mp=t=>t.hasRoot()?t.parseOperator():t.parseOperand();class bn{root;branches={prefixes:[],leftBound:null,intersection:null,union:null,pipe:null};finalizer;groups=[];scanner;ctx;constructor(e,n){this.scanner=e,this.ctx=n}error(e){return y(e)}hasRoot(){return this.root!==void 0}setRoot(e){this.root=e}unsetRoot(){const e=this.root;return this.root=void 0,e}constrainRoot(...e){this.root=this.root.constrain(e[0],e[1])}finalize(e){if(this.groups.length)return this.error(ma(")"));this.finalizeBranches(),this.finalizer=e}reduceLeftBound(e,n){const r=nn[n];if(!pe(r,ip))return this.error(ga(n));if(this.branches.leftBound)return this.error(lp(this.branches.leftBound.limit,this.branches.leftBound.comparator,e,r));this.branches.leftBound={comparator:r,limit:e}}finalizeBranches(){if(this.assertRangeUnset(),this.branches.pipe){this.pushRootToBranch("|>"),this.root=this.branches.pipe;return}if(this.branches.union){this.pushRootToBranch("|"),this.root=this.branches.union;return}if(this.branches.intersection){this.pushRootToBranch("&"),this.root=this.branches.intersection;return}this.applyPrefixes()}finalizeGroup(){this.finalizeBranches();const e=this.groups.pop();if(!e)return this.error(op(this.scanner.unscanned));this.branches=e}addPrefix(e){this.branches.prefixes.push(e)}applyPrefixes(){for(;this.branches.prefixes.length;){const e=this.branches.prefixes.pop();this.root=e==="keyof"?this.root.keyof():X(`Unexpected prefix '${e}'`)}}pushRootToBranch(e){this.assertRangeUnset(),this.applyPrefixes();const n=this.root;this.root=void 0,this.branches.intersection=this.branches.intersection?.rawAnd(n)??n,e!=="&"&&(this.branches.union=this.branches.union?.rawOr(this.branches.intersection)??this.branches.intersection,this.branches.intersection=null,e!=="|"&&(this.branches.pipe=this.branches.pipe?.rawPipeOnce(this.branches.union)??this.branches.union,this.branches.union=null))}parseUntilFinalizer(){return Ur(new bn(this.scanner,this.ctx))}parseOperator(){return wa(this)}parseOperand(){return xa(this)}assertRangeUnset(){if(this.branches.leftBound)return this.error(ap(this.branches.leftBound.limit,this.branches.leftBound.comparator))}reduceGroupOpen(){this.groups.push(this.branches),this.branches={prefixes:[],leftBound:null,union:null,intersection:null,pipe:null}}previousOperator(){return this.branches.leftBound?.comparator??this.branches.prefixes.at(-1)??(this.branches.intersection?"&":this.branches.union?"|":this.branches.pipe?"|>":void 0)}shiftedByOne(){return this.scanner.shift(),this}}const Ap="An empty string is not a valid generic parameter name",gr=(t,e,n)=>{t.shiftUntilNonWhitespace();const r=t.shiftUntilNextTerminator();return r===""?t.lookahead===""&&e.length?e:y(Ap):(t.shiftUntilNonWhitespace(),Np(t,r,e,n))},Ji="extends ",Np=(t,e,n,r)=>{if(t.shiftUntilNonWhitespace(),t.unscanned.startsWith(Ji))t.jumpForward(Ji.length);else return t.lookahead===","&&t.shift(),n.push(e),gr(t,n,r);const i=Ur(new bn(t,r));return n.push([e,i.root]),gr(t,n,r)};class Cp extends ot{$;constructor(e){super((...n)=>new qt(e)(...n),{bind:e}),this.$=e}in(e){return new qt(this.$,e===void 0?void 0:this.$.parse(e))}at(e,n){return new qt(this.$).at(e,n)}case(e,n){return new qt(this.$).case(e,n)}}class qt extends ot{$;in;key;branches=[];constructor(e,n){super(r=>this.caseEntries(Object.entries(r).map(([i,s])=>i==="default"?[i,s]:[this.$.parse(i),s]))),this.$=e,this.in=n}at(e,n){return this.key&&y(Ip),this.branches.length&&y(Op),this.key=e,n?this.match(n):this}case(e,n){return this.caseEntry(this.$.parse(e),n)}caseEntry(e,n){const i=(this.key?this.$.parse({[this.key]:e}):e).pipe(n);return this.branches.push(i),this}match(e){return this(e)}strings(e){return this.caseEntries(Object.entries(e).map(([n,r])=>n==="default"?[n,r]:[this.$.node("unit",{unit:n}),r]))}caseEntries(e){for(let n=0;n<e.length;n++){const[r,i]=e[n];if(r==="default")return n!==e.length-1&&y("default may only be specified as the last key of a switch definition"),this.default(i);if(typeof i!="function")return y(`Value for case "${r}" must be a function (was ${fe(i)})`);this.caseEntry(r,i)}return this}default(e){typeof e=="function"&&this.case(D.unknown,e);const n={branches:this.branches,ordered:!0};(e==="never"||e==="assert")&&(n.meta={onFail:Wi});const r=this.$.node("union",n);if(!this.in)return this.$.finalize(r);let i=this.in.pipe(r);return(e==="never"||e==="assert")&&(i=i.configureReferences({onFail:Wi},"self")),this.$.finalize(i)}}const Wi=t=>t.throw(),Op="A key matcher must be specified before the first case i.e. match.at('foo') or match.in<object>().at('bar')",Ip="At most one key matcher may be specified per expression",Sa=(t,e)=>{if(re(t)){if(t[1]==="=")return[e.$.parseOwnDefinitionFormat(t[0],e),"=",t[2]];if(t[1]==="?")return[e.$.parseOwnDefinitionFormat(t[0],e),"?"]}return Oa(t,e)},Rp="Only required keys may make their values optional, e.g. { [mySymbol]: ['number', '?'] }",Fp="Only required keys may specify default values, e.g. { value: 'number = 0' }",Dp=(t,e)=>{let n;const r={},i=Xn(t);for(const[o,a]of i){const c=Bp(o);if(c.kind==="spread"){if(!xt(r))return y(Tp);const p=e.$.parseOwnDefinitionFormat(a,e);if(p.equals(D.object))continue;if(!p.hasKind("intersection")||!p.basis?.equals(D.object))return y(jp(p.expression));n=p.structure;continue}if(c.kind==="undeclared"){a!=="reject"&&a!=="delete"&&a!=="ignore"&&y(Pp(a)),r.undeclared=a;continue}const l=Sa(a,e),u=c;if(c.kind==="required"){re(l)?Tn(r,"optional",l[1]==="="?{key:c.normalized,value:l[0],default:l[2]}:{key:c.normalized,value:l[0]},e):Tn(r,"required",{key:c.normalized,value:l},e);continue}if(re(l)&&(l[1]==="?"&&y(Rp),l[1]==="="&&y(Fp)),c.kind==="optional"){Tn(r,"optional",{key:c.normalized,value:l},e);continue}const h=e.$.parseOwnDefinitionFormat(u.normalized,e),f=hr(h,l,e.$);f.index&&(r.index=q(r.index,f.index)),f.required&&(r.required=q(r.required,f.required))}const s=e.$.node("structure",r);return e.$.parseSchema({domain:"object",structure:n?.merge(s)??s})},Tn=(t,e,n,r)=>{t[e]=q(t[e],r.$.node(e,n))},Pp=t=>`Value of '+' key must be 'reject', 'delete', or 'ignore' (was ${U(t)})`,Tp="Spread operator may only be used as the first key in an object",Bp=t=>typeof t=="symbol"?{kind:"required",normalized:t}:t.at(-1)==="?"?t.at(-2)===tr?{kind:"required",normalized:`${t.slice(0,-2)}?`}:{kind:"optional",normalized:t.slice(0,-1)}:t[0]==="["&&t.at(-1)==="]"?{kind:"index",normalized:t.slice(1,-1)}:t[0]===tr&&t[1]==="["&&t.at(-1)==="]"?{kind:"required",normalized:t.slice(1)}:t==="..."?{kind:"spread"}:t==="+"?{kind:"undeclared"}:{kind:"required",normalized:t==="\\..."?"...":t==="\\+"?"+":t},jp=t=>`Spread operand must resolve to an object literal type (was ${t})`,Kp=(t,e)=>Gp(t)?Aa[t[0]](t,e):Wp(t)?Ma[t[1]](t,e):null,Lp=(t,e)=>e.$.parseOwnDefinitionFormat(t[1],e).keyof(),Bn=(t,e)=>{if(t[2]===void 0)return y($a(t[1],""));const n=e.$.parseOwnDefinitionFormat(t[0],e),r=e.$.parseOwnDefinitionFormat(t[2],e);if(t[1]==="|")return e.$.node("union",{branches:[n,r]});const i=t[1]==="&"?Oe(n,r,e.$):cr(n,r,e.$);return i instanceof A?i.throw():i},qp=(t,e)=>e.$.parseOwnDefinitionFormat(t[0],e).array(),Up=(t,e)=>typeof t[2]!="function"?y(Ea("=>",t[2])):e.$.parseOwnDefinitionFormat(t[0],e).pipe(t[2]),Ea=(t,e)=>`${t===":"?"Narrow":"Morph"} expression requires a function following '${t}' (was ${typeof e})`,_p=(t,e)=>typeof t[2]!="function"?y(Ea(":",t[2])):e.$.parseOwnDefinitionFormat(t[0],e).constrain("predicate",t[2]),Vp=(t,e)=>e.$.parseOwnDefinitionFormat(t[0],e).configureReferences(t[2],"shallow"),ka=t=>t,zp=ka({"[]":qp,"?":()=>y(fa)}),Jp=ka({"|":Bn,"&":Bn,":":_p,"=>":Up,"|>":Bn,"@":Vp,"=":()=>y(pa)}),Ma={...zp,...Jp},Wp=t=>Ma[t[1]]!==void 0,Hp=t=>t,Aa=Hp({keyof:Lp,instanceof:(t,e)=>{if(typeof t[1]!="function")return y(Hi(er(t[1])));const n=t.slice(1).map(r=>typeof r=="function"?e.$.node("proto",{proto:r}):y(Hi(er(r))));return n.length===1?n[0]:e.$.node("union",{branches:n})},"===":(t,e)=>e.$.units(t.slice(1))}),Gp=t=>Aa[t[0]]!==void 0,Hi=t=>`Expected a constructor following 'instanceof' operator (was ${t})`,Zp=(t,e)=>{let n=[{}],r=0;for(;r<t.length;){let i=!1;t[r]==="..."&&r<t.length-1&&(i=!0,r++);const s=Sa(t[r],e),[o,a,c]=re(s)?s:[s];if(r++,i){if(!o.extends(w.intrinsic.Array))return y(Xp(o.expression));n=n.flatMap(l=>o.distribute(u=>Yp(fo(l),u)))}else n=n.map(l=>a==="?"?Na(l,o):a==="="?Qp(l,o,c):br(l,o))}return e.$.parseSchema(n.map(i=>xt(i)?{proto:Array,exactLength:0}:{proto:Array,sequence:i}))},br=(t,e)=>t.defaultables||t.optionals?y(t.variadic?Ho:em):(t.variadic?t.postfix=q(t.postfix,e):t.prefix=q(t.prefix,e),t),Na=(t,e)=>t.variadic?y(Ca):(t.optionals=q(t.optionals,e),t),Qp=(t,e,n)=>t.variadic?y(Ca):t.optionals?y(tm):(t.defaultables=q(t.defaultables,[[e,n]]),t),Gi=(t,e)=>(t.postfix&&y(Zi),t.variadic?t.variadic.equals(e)||y(Zi):t.variadic=e.internal,t),Yp=(t,e)=>{const n=e.select({method:"find",kind:"sequence"});return n?(n.prefix?.forEach(r=>br(t,r)),n.optionals?.forEach(r=>Na(t,r)),n.variadic&&Gi(t,n.variadic),n.postfix?.forEach(r=>br(t,r)),t):Gi(t,w.intrinsic.unknown)},Xp=t=>`Spread element must be an array (was ${t})`,Zi="A tuple may have at most one variadic element",em="A required element may not follow an optional element",Ca="An optional element may not follow a variadic element",tm="A defaultable element may not follow an optional element without a default",nm={},Oa=(t,e)=>{if(typeof t=="string"){if(e.args&&Object.keys(e.args).some(r=>t.includes(r)))return zi(t,e);const n=nm[e.$.name]??={};return n[t]??=zi(t,e)}return Ue(t,"object")?rm(t,e):y(vr(fe(t)))},rm=(t,e)=>{const n=Ar(t);switch(n){case void 0:return I(t,"root")?t:Dp(t,e);case"Array":return im(t,e);case"RegExp":return e.$.node("intersection",{domain:"string",pattern:t},{prereduced:!0});case"Function":{const r=un(t)?t():t;return I(r,"root")?r:y(vr("Function"))}default:return y(vr(n??U(t)))}},im=(t,e)=>Kp(t,e)??Zp(t,e),vr=t=>`Type definitions must be strings or objects (was ${t})`;class sm extends ot{constructor(e){const n=Object.assign({errors:Ce,hkt:be,$:e,raw:e.parse,module:e.constructor.module,scope:e.constructor.scope,define:e.define,match:e.match,generic:e.generic,schema:e.schema,keywords:e.ambient,unit:e.unit,enumerated:e.enumerated,instanceOf:e.instanceOf,valueOf:e.valueOf,or:e.or,and:e.and,merge:e.merge,pipe:e.pipe},e.ambientAttachments);super((...r)=>{if(r.length===1)return e.parse(r[0]);if(r.length===2&&typeof r[0]=="string"&&r[0][0]==="<"&&r[0].at(-1)===">"){const i=r[0].slice(1,-1),s=e.parseGenericParams(i,{});return new en(s,r[1],e,e,null)}return e.parse(r)},{bind:e,attach:n})}}const mt=w;class vn extends ta{get ambientAttachments(){if(mt.typeAttachments)return this.cacheGetter("ambientAttachments",V(mt.typeAttachments,(e,n)=>[e,this.bindReference(n)]))}preparseOwnAliasEntry(e,n){const r=e.indexOf("<");if(r===-1){if(I(n,"module")||I(n,"generic"))return[e,n];const o=this.name==="ark"?e:e==="root"?this.name:`${this.name}.${e}`,a=this.resolvedConfig.keywords?.[o];return a&&(n=[n,"@",a]),[e,n]}e.at(-1)!==">"&&y("'>' must be the last character of a generic declaration in a scope");const i=e.slice(0,r),s=e.slice(r+1,-1);return[i,()=>{const o=this.parseGenericParams(s,{alias:i});return eh(o,n,this)}]}parseGenericParams(e,n){return gr(new it(e),[],this.createParseContext({...n,def:e,prefix:"generic"}))}normalizeRootScopeValue(e){return un(e)&&!I(e,"generic")?e():e}preparseOwnDefinitionFormat(e,n){return{...n,def:e,prefix:n.alias??"type"}}parseOwnDefinitionFormat(e,n){!(n.alias&&n.alias in this.aliases)&&!n.args&&(n.args={this:n.id});const i=Oa(e,n);if(re(i)){if(i[1]==="=")return y(pa);if(i[1]==="?")return y(fa)}return i}unit=e=>this.units([e]);valueOf=e=>this.units(id(e));enumerated=(...e)=>this.units(e);instanceOf=e=>this.node("proto",{proto:e},{prereduced:!0});or=(...e)=>this.schema(e.map(n=>this.parse(n)));and=(...e)=>e.reduce((n,r)=>n.and(this.parse(r)),this.intrinsic.unknown);merge=(...e)=>e.reduce((n,r)=>n.merge(this.parse(r)),this.intrinsic.object);pipe=(...e)=>this.intrinsic.unknown.pipe(...e);match=new Cp(this);declare=()=>({type:this.type});define(e){return e}type=new sm(this);static scope=(e,n={})=>new vn(e,n);static module=(e,n={})=>this.scope(e,n).export()}const om=Object.assign(vn.scope,{define:t=>t}),L=vn;class am extends be{}const lm=$e(["base",D.object],["props",D.object])(t=>t.base.merge(t.props),am),cm=L.module({Key:D.key,Merge:lm});class um extends be{}const dm=$e("element")(t=>{const e=t.element.exclude(D.Array),n=e.array();return e.rawOr(n).pipe($t).distribute(r=>r.assertHasKind("morph").declareOut(n),J)},um),hm=L.module({root:D.Array,readonly:"root",index:D.nonNegativeIntegerString,liftFrom:dm},{name:"Array"}),yr=J(["string",wt.FileConstructor]),fm=yr.rawOr(yr.array()),Qi=J({meta:"an object representing parsed form data",domain:"object",index:{signature:"string",value:fm}}),pm=L.module({root:["instanceof",FormData],value:yr,parsed:Qi,parse:J({in:FormData,morphs:t=>{const e={};for(const[n,r]of t)if(n in e){const i=e[n];typeof i=="string"||i instanceof wt.FileConstructor?e[n]=[i,r]:i.push(r)}else e[n]=r;return e},declaredOut:Qi})},{name:"FormData"}),mm=L.module({Int8:["instanceof",Int8Array],Uint8:["instanceof",Uint8Array],Uint8Clamped:["instanceof",Uint8ClampedArray],Int16:["instanceof",Int16Array],Uint16:["instanceof",Uint16Array],Int32:["instanceof",Int32Array],Uint32:["instanceof",Uint32Array],Float32:["instanceof",Float32Array],Float64:["instanceof",Float64Array],BigInt64:["instanceof",BigInt64Array],BigUint64:["instanceof",BigUint64Array]},{name:"TypedArray"}),gm={Boolean:1,Number:1,String:1},bm=L.module({...V({...Zs,...Ys},(t,e)=>t in gm?[]:[t,["instanceof",e]]),Array:hm,TypedArray:mm,FormData:pm}),vm=J({domain:{domain:"number",meta:"a number representing a Unix timestamp"},divisor:{rule:1,meta:"an integer representing a Unix timestamp"},min:{rule:-864e13,meta:"a Unix timestamp after -8640000000000000"},max:{rule:864e13,meta:"a Unix timestamp before 8640000000000000"},meta:"an integer representing a safe Unix timestamp"}),ym=J({domain:"number",divisor:1}),Ia=L.module({root:D.number,integer:ym,epoch:vm,safe:J({domain:{domain:"number",numberAllowsNaN:!1},min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER}),NaN:["===",Number.NaN],Infinity:["===",Number.POSITIVE_INFINITY],NegativeInfinity:["===",Number.NEGATIVE_INFINITY]},{name:"number"}),z=(t,e)=>Lr("intersection",{domain:"string",pattern:{rule:t.source,flags:t.flags,meta:e}}),Yi=z(Ht,"a well-formed integer string"),Ra=L.module({root:Yi,parse:J({in:Yi,morphs:(t,e)=>{const n=Number.parseInt(t);return Number.isSafeInteger(n)?n:e.error("an integer in the range Number.MIN_SAFE_INTEGER to Number.MAX_SAFE_INTEGER")},declaredOut:D.integer})},{name:"string.integer"}),$m=z(/^[0-9a-fA-F]+$/,"hex characters only"),xm=L.module({root:z(/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,"base64-encoded"),url:z(/^(?:[A-Za-z0-9_-]{4})*(?:[A-Za-z0-9_-]{2}(?:==|%3D%3D)?|[A-Za-z0-9_-]{3}(?:=|%3D)?)?$/,"base64url-encoded")},{name:"string.base64"}),Xi=z(/^[A-Z].*$/,"capitalized"),wm=L.module({root:J({in:"string",morphs:t=>t.charAt(0).toUpperCase()+t.slice(1),declaredOut:Xi}),preformatted:Xi},{name:"string.capitalize"}),Sm=t=>{const e=t.replace(/[- ]+/g,"");let n=0,r,i,s=!1;for(let o=e.length-1;o>=0;o--)r=e.substring(o,o+1),i=Number.parseInt(r,10),s?(i*=2,i>=10?n+=i%10+1:n+=i):n+=i,s=!s;return!!(n%10===0&&e)},Em=/^(?:4[0-9]{12}(?:[0-9]{3,6})?|5[1-5][0-9]{14}|(222[1-9]|22[3-9][0-9]|2[3-6][0-9]{2}|27[01][0-9]|2720)[0-9]{12}|6(?:011|5[0-9][0-9])[0-9]{12,15}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\d{3})\d{11}|6[27][0-9]{14}|^(81[0-9]{14,17}))$/,km=J({domain:"string",pattern:{meta:"a credit card number",rule:Em.source},predicate:{meta:"a credit card number",predicate:Sm}}),Mm=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,Am=t=>!Number.isNaN(new Date(t).valueOf()),es=J({domain:"string",predicate:{meta:"a parsable date",predicate:Am}}).assertHasKind("intersection"),ts=Ra.root.internal.narrow((t,e)=>{const n=Number.parseInt(t),r=Ia.epoch(n);return r instanceof Ce?(e.errors.merge(r),!1):!0}).configure({description:"an integer string representing a safe Unix timestamp"},"self").assertHasKind("intersection"),Nm=L.module({root:ts,parse:J({in:ts,morphs:t=>new Date(t),declaredOut:D.Date})},{name:"string.date.epoch"}),ns=z(Mm,"an ISO 8601 (YYYY-MM-DDTHH:mm:ss.sssZ) date").internal.assertHasKind("intersection"),Cm=L.module({root:ns,parse:J({in:ns,morphs:t=>new Date(t),declaredOut:D.Date})},{name:"string.date.iso"}),Om=L.module({root:es,parse:J({declaredIn:es,in:"string",morphs:(t,e)=>{const n=new Date(t);return Number.isNaN(n.valueOf())?e.error("a parsable date"):n},declaredOut:D.Date}),iso:Cm,epoch:Nm},{name:"string.date"}),Im=z(/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/,"an email address"),rs="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",Ee=`(${rs}[.]){3}${rs}`,Rm=new RegExp(`^${Ee}$`),G="(?:[0-9a-fA-F]{1,4})",Fm=new RegExp(`^((?:${G}:){7}(?:${G}|:)|(?:${G}:){6}(?:${Ee}|:${G}|:)|(?:${G}:){5}(?::${Ee}|(:${G}){1,2}|:)|(?:${G}:){4}(?:(:${G}){0,1}:${Ee}|(:${G}){1,3}|:)|(?:${G}:){3}(?:(:${G}){0,2}:${Ee}|(:${G}){1,4}|:)|(?:${G}:){2}(?:(:${G}){0,3}:${Ee}|(:${G}){1,5}|:)|(?:${G}:){1}(?:(:${G}){0,4}:${Ee}|(:${G}){1,6}|:)|(?::((?::${G}){0,5}:${Ee}|(?::${G}){1,7}|:)))(%[0-9a-zA-Z.]{1,})?$`),Dm=L.module({root:["v4 | v6","@","an IP address"],v4:z(Rm,"an IPv4 address"),v6:z(Fm,"an IPv6 address")},{name:"string.ip"}),Xe="a JSON string",Fa=t=>{if(!(t instanceof SyntaxError))throw t;return`must be ${Xe} (${t})`},Pm=J({meta:Xe,domain:"string",predicate:{meta:Xe,predicate:(t,e)=>{try{return JSON.parse(t),!0}catch(n){return e.reject({code:"predicate",expected:Xe,problem:Fa(n)})}}}}),Tm=(t,e)=>{if(t.length===0)return e.error({code:"predicate",expected:Xe,actual:"empty"});try{return JSON.parse(t)}catch(n){return e.error({code:"predicate",expected:Xe,problem:Fa(n)})}},Bm=L.module({root:Pm,parse:J({meta:"safe JSON string parser",in:"string",morphs:Tm,declaredOut:D.jsonObject})},{name:"string.json"}),is=z(/^[a-z]*$/,"only lowercase letters"),jm=L.module({root:J({in:"string",morphs:t=>t.toLowerCase(),declaredOut:is}),preformatted:is},{name:"string.lower"}),Da=["NFC","NFD","NFKC","NFKD"],Ct=V(Da,(t,e)=>[e,J({domain:"string",predicate:n=>n.normalize(e)===n,meta:`${e}-normalized unicode`})]),yn=V(Da,(t,e)=>[e,J({in:"string",morphs:n=>n.normalize(e),declaredOut:Ct[e]})]),Km=L.module({root:yn.NFC,preformatted:Ct.NFC},{name:"string.normalize.NFC"}),Lm=L.module({root:yn.NFD,preformatted:Ct.NFD},{name:"string.normalize.NFD"}),qm=L.module({root:yn.NFKC,preformatted:Ct.NFKC},{name:"string.normalize.NFKC"}),Um=L.module({root:yn.NFKD,preformatted:Ct.NFKD},{name:"string.normalize.NFKD"}),_m=L.module({root:"NFC",NFC:Km,NFD:Lm,NFKC:qm,NFKD:Um},{name:"string.normalize"}),ss=z(nr,"a well-formed numeric string"),Vm=L.module({root:ss,parse:J({in:ss,morphs:t=>Number.parseFloat(t),declaredOut:D.number})},{name:"string.numeric"}),zm=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/,Jm=z(zm,"a semantic version (see https://semver.org/)"),os=z(/^\S.*\S$|^\S?$/,"trimmed"),Wm=L.module({root:J({in:"string",morphs:t=>t.trim(),declaredOut:os}),preformatted:os},{name:"string.trim"}),as=z(/^[A-Z]*$/,"only uppercase letters"),Hm=L.module({root:J({in:"string",morphs:t=>t.toUpperCase(),declaredOut:as}),preformatted:as},{name:"string.upper"}),Gm=t=>{if(URL.canParse)return URL.canParse(t);try{return new URL(t),!0}catch{return!1}},ls=J({domain:"string",predicate:{meta:"a URL string",predicate:Gm}}),Zm=L.module({root:ls,parse:J({declaredIn:ls,in:"string",morphs:(t,e)=>{try{return new URL(t)}catch{return e.error("a URL string")}},declaredOut:J(URL)})},{name:"string.url"}),Qm=L.module({root:["versioned | nil | max","@","a UUID"],"#nil":"'00000000-0000-0000-0000-000000000000'","#max":"'ffffffff-ffff-ffff-ffff-ffffffffffff'","#versioned":/[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}/i,v1:z(/^[0-9a-f]{8}-[0-9a-f]{4}-1[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv1"),v2:z(/^[0-9a-f]{8}-[0-9a-f]{4}-2[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv2"),v3:z(/^[0-9a-f]{8}-[0-9a-f]{4}-3[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv3"),v4:z(/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv4"),v5:z(/^[0-9a-f]{8}-[0-9a-f]{4}-5[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv5"),v6:z(/^[0-9a-f]{8}-[0-9a-f]{4}-6[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv6"),v7:z(/^[0-9a-f]{8}-[0-9a-f]{4}-7[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv7"),v8:z(/^[0-9a-f]{8}-[0-9a-f]{4}-8[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,"a UUIDv8")},{name:"string.uuid"}),Ym=L.module({root:D.string,alpha:z(/^[A-Za-z]*$/,"only letters"),alphanumeric:z(/^[A-Za-z\d]*$/,"only letters and digits 0-9"),hex:$m,base64:xm,capitalize:wm,creditCard:km,date:Om,digits:z(/^\d*$/,"only digits 0-9"),email:Im,integer:Ra,ip:Dm,json:Bm,lower:jm,normalize:_m,numeric:Vm,semver:Jm,trim:Wm,upper:Hm,url:Zm,uuid:Qm},{name:"string"}),Xm=L.module({bigint:D.bigint,boolean:D.boolean,false:D.false,never:D.never,null:D.null,number:D.number,object:D.object,string:D.string,symbol:D.symbol,true:D.true,unknown:D.unknown,undefined:D.undefined}),eg=L.module({root:D.unknown,any:D.unknown},{name:"unknown"}),tg=L.module({root:D.jsonObject,stringify:Lr("morph",{in:D.jsonObject,morphs:t=>JSON.stringify(t),declaredOut:D.string})},{name:"object.json"}),ng=L.module({root:D.object,json:tg},{name:"object"});class rg extends be{description="a generic type that instantiates an object from a single index signature and corresponding value type"}const ig=$e(["K",D.key],"V")(t=>({domain:"object",index:{signature:t.K,value:t.V}}),rg);class sg extends be{}const og=$e(["T",D.object],["K",D.key])(t=>t.T.pick(t.K),sg);class ag extends be{}const lg=$e(["T",D.object],["K",D.key])(t=>t.T.omit(t.K),ag);class cg extends be{}const ug=$e(["T",D.object])(t=>t.T.partial(),cg);class dg extends be{}const hg=$e(["T",D.object])(t=>t.T.required(),dg);class fg extends be{}const pg=$e("T","U")(t=>t.T.exclude(t.U),fg);class mg extends be{}const gg=$e("T","U")(t=>t.T.extract(t.U),mg),bg=L.module({Exclude:pg,Extract:gg,Omit:lg,Partial:ug,Pick:og,Record:ig,Required:hg}),_e=om({...Xm,...bg,...bm,...cm,string:Ym,number:Ia,object:ng,unknown:eg},{prereducedAliases:!0,name:"ark"}),ee=_e.export();Object.assign(mt.ambient,ee);mt.typeAttachments={string:ee.string.root,number:ee.number.root,bigint:ee.bigint,boolean:ee.boolean,symbol:ee.symbol,undefined:ee.undefined,null:ee.null,object:ee.object.root,unknown:ee.unknown.root,false:ee.false,true:ee.true,never:ee.never,arrayIndex:ee.Array.index,Key:ee.Key,Record:ee.Record,Array:ee.Array.root,Date:ee.Date};const me=Object.assign(_e.type,mt.typeAttachments);_e.match;_e.generic;_e.schema;_e.define;_e.declare;const Pa={newborn:"Newborn",junior:"Junior",preTeen:"Pre-Teen",teen:"Teen",postTeen:"Post-Teen",fullGrown:"Full-Grown"},Cg=me({itemId:me("number").configure({message:"Invalid item ID"}),amount:me("number >= 1").configure({message:"Invalid number"}),isFlyable:me("boolean").configure({message:"isFlyable must be a boolean"}),isRideable:me("boolean").configure({message:"isRideable must be a boolean"}),isNeon:me("boolean").configure({message:"isNeon must be a boolean"}),isMegaNeon:me("boolean").configure({message:"isMegaNeon must be a boolean"}),age:me.valueOf(Pa).configure({message:"Invalid age"}),lookingFor:me("string[]").configure({message:"Trade for is invalid"}),slug:me("string").configure({message:"slug is invalid"})});function vg(){const t=le.c(15),e=Ot();let n;t[0]!==e.name?(n=S.jsx(gt,{htmlFor:e.name,children:"Age"}),t[0]=e.name,t[1]=n):n=t[1];let r;t[2]!==e?(r=l=>e.handleChange(l),t[2]=e,t[3]=r):r=t[3];let i;t[4]===Symbol.for("react.memo_cache_sentinel")?(i=S.jsx(ll,{className:"w-full",children:S.jsx(cl,{placeholder:"Select age"})}),t[4]=i):i=t[4];let s;t[5]===Symbol.for("react.memo_cache_sentinel")?(s=S.jsx(ol,{children:Object.values(Pa).map(yg)}),t[5]=s):s=t[5];let o;t[6]!==e.state.value||t[7]!==r?(o=S.jsxs(al,{value:e.state.value,onValueChange:r,children:[i,s]}),t[6]=e.state.value,t[7]=r,t[8]=o):o=t[8];let a;t[9]!==e.state.meta?(a=S.jsx(bt,{meta:e.state.meta}),t[9]=e.state.meta,t[10]=a):a=t[10];let c;return t[11]!==n||t[12]!==o||t[13]!==a?(c=S.jsxs("div",{className:"*:not-first:mt-2",children:[n,o,a]}),t[11]=n,t[12]=o,t[13]=a,t[14]=c):c=t[14],c}function yg(t){return S.jsx(ul,{value:t,className:"first-letter:capitalize",children:t},t)}const{fieldContext:$g,useFieldContext:Ot,formContext:xg,useFormContext:wg}=Hl(),{useAppForm:Og}=Gl({fieldComponents:{TextField:Zl,PasswordField:Xl,CustomCheckbox:tc,CustomSelect:vg,SelectSearch:zu},formComponents:{SubmitButton:Ql},fieldContext:$g,formContext:xg});export{pl as L,bl as Q,Mg as a,Il as b,Cg as c,me as t,Og as u};
