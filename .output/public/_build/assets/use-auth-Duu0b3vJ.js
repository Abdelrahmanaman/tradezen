import{t as x,a as Z}from"./index-DdWgE4YF.js";import{r as F,c as D,w as ue,x as le,y as ce,z as M}from"./client-BbWzF__1.js";const X=x(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$ %^&*-/]).{8,}$/).configure({message:"Invalid password"}),K=x("string.email").configure({message:"Invalid email"}),fe=x("string > 5").configure({message:"Username must be at least 5 characters long"}),St=x({email:K,password:X}),Rt=x({userName:fe,email:K,password:X});var de={proto:/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,constructor:/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,protoShort:/"__proto__"\s*:/,constructorShort:/"constructor"\s*:/},he=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/,J={true:!0,false:!1,null:null,undefined:void 0,nan:Number.NaN,infinity:Number.POSITIVE_INFINITY,"-infinity":Number.NEGATIVE_INFINITY},pe=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,7}))?(?:Z|([+-])(\d{2}):(\d{2}))$/;function ye(e){return e instanceof Date&&!isNaN(e.getTime())}function ge(e){const t=pe.exec(e);if(!t)return null;const[,r,n,s,i,o,c,l,a,u,f]=t;let h=new Date(Date.UTC(parseInt(r,10),parseInt(n,10)-1,parseInt(s,10),parseInt(i,10),parseInt(o,10),parseInt(c,10),l?parseInt(l.padEnd(3,"0"),10):0));if(a){const d=(parseInt(u,10)*60+parseInt(f,10))*(a==="+"?-1:1);h.setUTCMinutes(h.getUTCMinutes()+d)}return ye(h)?h:null}function me(e,t={}){const{strict:r=!1,warnings:n=!1,reviver:s,parseDates:i=!0}=t;if(typeof e!="string")return e;const o=e.trim();if(o[0]==='"'&&o.endsWith('"')&&!o.slice(1,-1).includes('"'))return o.slice(1,-1);const c=o.toLowerCase();if(c.length<=9&&c in J)return J[c];if(!he.test(o)){if(r)throw new SyntaxError("[better-json] Invalid JSON");return e}if(Object.entries(de).some(([a,u])=>{const f=u.test(o);return f&&n&&console.warn(`[better-json] Detected potential prototype pollution attempt using ${a} pattern`),f})&&r)throw new Error("[better-json] Potential prototype pollution attempt detected");try{return JSON.parse(o,(u,f)=>{if(u==="__proto__"||u==="constructor"&&f&&typeof f=="object"&&"prototype"in f){n&&console.warn(`[better-json] Dropping "${u}" key to prevent prototype pollution`);return}if(i&&typeof f=="string"){const h=ge(f);if(h)return h}return s?s(u,f):f})}catch(a){if(r)throw a;return e}}function ve(e,t={strict:!0}){return me(e,t)}var we={},_e={},q=Object.create(null),A=e=>we||globalThis.Deno?.env.toObject()||globalThis.__env__||(e?q:globalThis),be=new Proxy(q,{get(e,t){return A()[t]??q[t]},has(e,t){const r=A();return t in r||t in q},set(e,t,r){const n=A(!0);return n[t]=r,!0},deleteProperty(e,t){if(!t)return!1;const r=A(!0);return delete r[t],!0},ownKeys(){const e=A(!0);return Object.keys(e)}});function Se(e){return e?e!=="false":!1}var Re=typeof process<"u"&&_e&&"production"||"";Re==="test"||Se(be.TEST);var Pe=class extends Error{constructor(e,t){super(e),this.name="BetterAuthError",this.message=e,this.cause=t,this.stack=""}};function Oe(e){try{return new URL(e).pathname!=="/"}catch{throw new Pe(`Invalid base URL: ${e}. Please provide a valid base URL.`)}}function Te(e,t="/api/auth"){return Oe(e)?e:(t=t.startsWith("/")?t:`/${t}`,`${e.replace(/\/+$/,"")}${t}`)}function Ee(e,t){return Te(e,t)}var Ae=Object.defineProperty,xe=Object.defineProperties,Ue=Object.getOwnPropertyDescriptors,V=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,G=(e,t,r)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,w=(e,t)=>{for(var r in t||(t={}))Ie.call(t,r)&&G(e,r,t[r]);if(V)for(var r of V(t))Ne.call(t,r)&&G(e,r,t[r]);return e},b=(e,t)=>xe(e,Ue(t)),Le=class extends Error{constructor(e,t,r){super(t||e.toString(),{cause:r}),this.status=e,this.statusText=t,this.error=r}},je=async(e,t)=>{var r,n,s,i,o,c;let l=t||{};const a={onRequest:[t?.onRequest],onResponse:[t?.onResponse],onSuccess:[t?.onSuccess],onError:[t?.onError],onRetry:[t?.onRetry]};if(!t||!t?.plugins)return{url:e,options:l,hooks:a};for(const u of t?.plugins||[]){if(u.init){const f=await((r=u.init)==null?void 0:r.call(u,e.toString(),t));l=f.options||l,e=f.url}a.onRequest.push((n=u.hooks)==null?void 0:n.onRequest),a.onResponse.push((s=u.hooks)==null?void 0:s.onResponse),a.onSuccess.push((i=u.hooks)==null?void 0:i.onSuccess),a.onError.push((o=u.hooks)==null?void 0:o.onError),a.onRetry.push((c=u.hooks)==null?void 0:c.onRetry)}return{url:e,options:l,hooks:a}},H=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(){return this.options.delay}},qe=class{constructor(e){this.options=e}shouldAttemptRetry(e,t){return this.options.shouldRetry?Promise.resolve(e<this.options.attempts&&this.options.shouldRetry(t)):Promise.resolve(e<this.options.attempts)}getDelay(e){return Math.min(this.options.maxDelay,this.options.baseDelay*2**e)}};function $e(e){if(typeof e=="number")return new H({type:"linear",attempts:e,delay:1e3});switch(e.type){case"linear":return new H(e);case"exponential":return new qe(e);default:throw new Error("Invalid retry strategy")}}var Ce=e=>{const t={},r=n=>typeof n=="function"?n():n;if(e?.auth){if(e.auth.type==="Bearer"){const n=r(e.auth.token);if(!n)return t;t.authorization=`Bearer ${n}`}else if(e.auth.type==="Basic"){const n=r(e.auth.username),s=r(e.auth.password);if(!n||!s)return t;t.authorization=`Basic ${btoa(`${n}:${s}`)}`}else if(e.auth.type==="Custom"){const n=r(e.auth.value);if(!n)return t;t.authorization=`${r(e.auth.prefix)} ${n}`}}return t},ee=["get","post","put","patch","delete"],Fe=e=>({id:"apply-schema",name:"Apply Schema",version:"1.0.0",async init(t,r){var n,s,i,o;const c=((s=(n=e.plugins)==null?void 0:n.find(l=>{var a;return(a=l.schema)!=null&&a.config?t.startsWith(l.schema.config.baseURL||"")||t.startsWith(l.schema.config.prefix||""):!1}))==null?void 0:s.schema)||e.schema;if(c){let l=t;(i=c.config)!=null&&i.prefix&&l.startsWith(c.config.prefix)&&(l=l.replace(c.config.prefix,""),c.config.baseURL&&(t=t.replace(c.config.prefix,c.config.baseURL))),(o=c.config)!=null&&o.baseURL&&l.startsWith(c.config.baseURL)&&(l=l.replace(c.config.baseURL,""));const a=c.schema[l];if(a){let u=b(w({},r),{method:a.method,output:a.output});return r?.disableValidation||(u=b(w({},u),{body:a.input?a.input.parse(r?.body):r?.body,params:a.params?a.params.parse(r?.params):r?.params,query:a.query?a.query.parse(r?.query):r?.query})),{url:t,options:u}}}return{url:t,options:r}}}),ke=e=>{async function t(r,n){const s=b(w(w({},e),n),{plugins:[...e?.plugins||[],Fe(e||{})]});if(e?.catchAllError)try{return await k(r,s)}catch(i){return{data:null,error:{status:500,statusText:"Fetch Error",message:"Fetch related error. Captured by catchAllError option. See error property for more details.",error:i}}}return await k(r,s)}return t},De=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function Me(e){const t=e.headers.get("content-type"),r=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!t)return"json";const n=t.split(";").shift()||"";return De.test(n)?"json":r.has(n)||n.startsWith("text/")?"text":"blob"}function We(e){try{return JSON.parse(e),!0}catch{return!1}}function te(e){if(e===void 0)return!1;const t=typeof e;return t==="string"||t==="number"||t==="boolean"||t===null?!0:t!=="object"?!1:Array.isArray(e)?!0:e.buffer?!1:e.constructor&&e.constructor.name==="Object"||typeof e.toJSON=="function"}function Q(e){try{return JSON.parse(e)}catch{return e}}function z(e){return typeof e=="function"}function Be(e){if(e?.customFetchImpl)return e.customFetchImpl;if(typeof globalThis<"u"&&z(globalThis.fetch))return globalThis.fetch;if(typeof window<"u"&&z(window.fetch))return window.fetch;throw new Error("No fetch implementation found")}function Je(e){const t=new Headers(e?.headers),r=Ce(e);for(const[n,s]of Object.entries(r||{}))t.set(n,s);if(!t.has("content-type")){const n=Ve(e?.body);n&&t.set("content-type",n)}return t}function Ve(e){return te(e)?"application/json":null}function Ge(e){if(!e?.body)return null;const t=new Headers(e?.headers);return te(e.body)&&!t.has("content-type")?JSON.stringify(e.body):e.body}function He(e,t){var r;if(t?.method)return t.method.toUpperCase();if(e.startsWith("@")){const n=(r=e.split("@")[1])==null?void 0:r.split("/")[0];return ee.includes(n)?n.toUpperCase():t?.body?"POST":"GET"}return t?.body?"POST":"GET"}function Qe(e,t){let r;return!e?.signal&&e?.timeout&&(r=setTimeout(()=>t?.abort(),e?.timeout)),{abortTimeout:r,clearTimeout:()=>{r&&clearTimeout(r)}}}function ze(e,t){let{baseURL:r,params:n,query:s}=t||{query:{},params:{},baseURL:""},i=e.startsWith("http")?e.split("/").slice(0,3).join("/"):r;if(!i)throw new TypeError(`Invalid URL ${e}. Are you passing in a relative URL but not setting the baseURL?`);if(e.startsWith("@")){const f=e.toString().split("@")[1].split("/")[0];ee.includes(f)&&(e=e.replace(`@${f}/`,"/"))}i.endsWith("/")||(i+="/");let[o,c]=e.replace(i,"").split("?");const l=new URLSearchParams(c);for(const[f,h]of Object.entries(s||{}))l.set(f,String(h));if(n)if(Array.isArray(n)){const f=o.split("/").filter(h=>h.startsWith(":"));for(const[h,d]of f.entries()){const _=n[h];o=o.replace(d,_)}}else for(const[f,h]of Object.entries(n))o=o.replace(`:${f}`,String(h));o=o.split("/").map(encodeURIComponent).join("/"),o.startsWith("/")&&(o=o.slice(1));let a=l.size>0?`?${l}`.replace(/\+/g,"%20"):"";return new URL(`${o}${a}`,i)}var k=async(e,t)=>{var r,n,s,i,o,c,l,a;const{hooks:u,url:f,options:h}=await je(e,t),d=Be(h),_=new AbortController,U=(r=h.signal)!=null?r:_.signal,O=ze(f,h),I=Ge(h),E=Je(h),T=He(f,h);let y=b(w({},h),{url:O,headers:E,body:I,method:T,signal:U});for(const m of u.onRequest)if(m){const g=await m(y);g instanceof Object&&(y=g)}("pipeTo"in y&&typeof y.pipeTo=="function"||typeof((n=t?.body)==null?void 0:n.pipe)=="function")&&("duplex"in y||(y.duplex="half"));const{clearTimeout:$}=Qe(h,_);let p=await d(y.url,y);$();const W={response:p,request:y};for(const m of u.onResponse)if(m){const g=await m(b(w({},W),{response:(s=t?.hookOptions)!=null&&s.cloneResponse?p.clone():p}));g instanceof Response?p=g:g instanceof Object&&(p=g.response)}if(p.ok){if(!(y.method!=="HEAD"))return{data:"",error:null};const g=Me(p),S={data:"",response:p,request:y};if(g==="json"||g==="text"){const R=await p.text(),ie=await((i=y.jsonParser)!=null?i:Q)(R);S.data=ie}else S.data=await p[g]();y?.output&&y.output&&!y.disableValidation&&(S.data=y.output.parse(S.data));for(const R of u.onSuccess)R&&await R(b(w({},S),{response:(o=t?.hookOptions)!=null&&o.cloneResponse?p.clone():p}));return t?.throw?S.data:{data:S.data,error:null}}const oe=(c=t?.jsonParser)!=null?c:Q,B=await p.text(),C=We(B)?await oe(B):{},ae={response:p,request:y,error:b(w({},C),{status:p.status,statusText:p.statusText})};for(const m of u.onError)m&&await m(b(w({},ae),{response:(l=t?.hookOptions)!=null&&l.cloneResponse?p.clone():p}));if(t?.retry){const m=$e(t.retry),g=(a=t.retryAttempt)!=null?a:0;if(await m.shouldAttemptRetry(g,p)){for(const R of u.onRetry)R&&await R(W);const S=m.getDelay(g);return await new Promise(R=>setTimeout(R,S)),await k(e,b(w({},t),{retryAttempt:g+1}))}}if(t?.throw)throw new Le(p.status,p.statusText,C);return{data:null,error:b(w({},C),{status:p.status,statusText:p.statusText})}};let v=[],P=0;const N=4;let re=e=>{let t=[],r={get(){return r.lc||r.listen(()=>{})(),r.value},lc:0,listen(n){return r.lc=t.push(n),()=>{for(let i=P+N;i<v.length;)v[i]===n?v.splice(i,N):i+=N;let s=t.indexOf(n);~s&&(t.splice(s,1),--r.lc||r.off())}},notify(n,s){let i=!v.length;for(let o of t)v.push(o,r.value,n,s);if(i){for(P=0;P<v.length;P+=N)v[P](v[P+1],v[P+2],v[P+3]);v.length=0}},off(){},set(n){let s=r.value;s!==n&&(r.value=n,r.notify(s))},subscribe(n){let s=r.listen(n);return n(r.value),s},value:e};return r};const Ye=5,L=6,j=10;let Ze=(e,t,r,n)=>(e.events=e.events||{},e.events[r+j]||(e.events[r+j]=n(s=>{e.events[r].reduceRight((i,o)=>(o(i),i),{shared:{},...s})})),e.events[r]=e.events[r]||[],e.events[r].push(t),()=>{let s=e.events[r],i=s.indexOf(t);s.splice(i,1),s.length||(delete e.events[r],e.events[r+j](),delete e.events[r+j])}),Xe=1e3,Ke=(e,t)=>Ze(e,n=>{let s=t(n);s&&e.events[L].push(s)},Ye,n=>{let s=e.listen;e.listen=(...o)=>(!e.lc&&!e.active&&(e.active=!0,n()),s(...o));let i=e.off;return e.events[L]=[],e.off=()=>{i(),setTimeout(()=>{if(e.active&&!e.lc){e.active=!1;for(let o of e.events[L])o();e.events[L]=[]}},Xe)},()=>{e.listen=s,e.off=i}});function et(e,t,r){let n=new Set(t).add(void 0);return e.listen((s,i,o)=>{n.has(o)&&r(s,i,o)})}var tt=(e,t,r,n)=>{const s=re({data:null,error:null,isPending:!0,isRefetching:!1,refetch:()=>i()}),i=()=>{const c=typeof n=="function"?n({data:s.get().data,error:s.get().error,isPending:s.get().isPending}):n;return r(t,{...c,async onSuccess(l){typeof window<"u"&&s.set({data:l.data,error:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onSuccess?.(l)},async onError(l){const{request:a}=l,u=typeof a.retry=="number"?a.retry:a.retry?.attempts,f=a.retryAttempt||0;u&&f<u||(s.set({error:l.error,data:null,isPending:!1,isRefetching:!1,refetch:s.value.refetch}),await c?.onError?.(l))},async onRequest(l){const a=s.get();s.set({isPending:a.data===null,data:a.data,error:null,isRefetching:!0,refetch:s.value.refetch}),await c?.onRequest?.(l)}})};e=Array.isArray(e)?e:[e];let o=!1;for(const c of e)c.subscribe(()=>{o?i():Ke(s,()=>(i(),o=!0,()=>{s.off(),c.off()}))});return s},rt={id:"redirect",name:"Redirect",hooks:{onSuccess(e){if(e.data?.url&&e.data?.redirect&&typeof window<"u"&&window.location&&window.location)try{window.location.href=e.data.url}catch{}}}};function nt(e){const t=re(!1);return{session:tt(t,"/get-session",e,{method:"GET"}),$sessionSignal:t}}var st=e=>{const t="credentials"in Request.prototype,r=Ee(e?.baseURL),n=e?.plugins?.flatMap(d=>d.fetchPlugins).filter(d=>d!==void 0)||[],s=ke({baseURL:r,...t?{credentials:"include"}:{},method:"GET",jsonParser(d){return ve(d,{strict:!1})},customFetchImpl:async(d,_)=>{try{return await fetch(d,_)}catch{return Response.error()}},...e?.fetchOptions,plugins:e?.disableDefaultFetchPlugins?[...e?.fetchOptions?.plugins||[],...n]:[rt,...e?.fetchOptions?.plugins||[],...n]}),{$sessionSignal:i,session:o}=nt(s),c=e?.plugins||[];let l={},a={$sessionSignal:i,session:o},u={"/sign-out":"POST","/revoke-sessions":"POST","/revoke-other-sessions":"POST","/delete-user":"POST"};const f=[{signal:"$sessionSignal",matcher(d){return d==="/sign-out"||d==="/update-user"||d.startsWith("/sign-in")||d.startsWith("/sign-up")||d==="/delete-user"}}];for(const d of c)d.getAtoms&&Object.assign(a,d.getAtoms?.(s)),d.pathMethods&&Object.assign(u,d.pathMethods),d.atomListeners&&f.push(...d.atomListeners);const h={notify:d=>{a[d].set(!a[d].get())},listen:(d,_)=>{a[d].subscribe(_)},atoms:a};for(const d of c)d.getActions&&Object.assign(l,d.getActions?.(s,h));return{pluginsActions:l,pluginsAtoms:a,pluginPathMethods:u,atomListeners:f,$fetch:s,$store:h}};function ot(e,t,r){const n=t[e],{fetchOptions:s,query:i,...o}=r||{};return n||(s?.method?s.method:o&&Object.keys(o).length>0?"POST":"GET")}function at(e,t,r,n,s){function i(o=[]){return new Proxy(function(){},{get(c,l){const a=[...o,l];let u=e;for(const f of a)if(u&&typeof u=="object"&&f in u)u=u[f];else{u=void 0;break}return typeof u=="function"?u:i(a)},apply:async(c,l,a)=>{const u="/"+o.map(E=>E.replace(/[A-Z]/g,T=>`-${T.toLowerCase()}`)).join("/"),f=a[0]||{},h=a[1]||{},{query:d,fetchOptions:_,...U}=f,O={...h,..._},I=ot(u,r,f);return await t(u,{...O,body:I==="GET"?void 0:{...U,...O?.body||{}},query:d||O?.query,method:I,async onSuccess(E){await O?.onSuccess?.(E);const T=s?.find(p=>p.matcher(u));if(!T)return;const y=n[T.signal];if(!y)return;const $=y.get();setTimeout(()=>{y.set(!$)},10)}})}})}return i()}var it=e=>({id:"additional-fields-client",$InferServerPlugin:{}}),Y=(e,t)=>r=>{e.current=r,t()};function ut(e,{keys:t,deps:r=[e,t]}={}){let n=F.useRef();n.current=e.get();let s=F.useCallback(o=>(t?.length||0)>0?et(e,t,Y(n,o)):e.listen(Y(n,o)),r),i=()=>n.current;return F.useSyncExternalStore(s,i,i)}function lt(e){return`use${ct(e)}`}function ct(e){return e.charAt(0).toUpperCase()+e.slice(1)}function ft(e){const{pluginPathMethods:t,pluginsActions:r,pluginsAtoms:n,$fetch:s,$store:i,atomListeners:o}=st(e);let c={};for(const[u,f]of Object.entries(n))c[lt(u)]=()=>ut(f);const l={...r,...c,$fetch:s,$store:i};return at(l,s,t,n,o)}const dt=ft({plugins:[it()],baseURL:"http://localhost:3000"}),{signIn:ht,signOut:Pt,useSession:Ot,signUp:pt,getSession:Tt}=dt;async function ne(e){try{return{data:await e,error:null}}catch(t){return{data:null,error:t}}}const se=e=>{const t=D.c(4),r=ue(),n=le();let s;return t[0]!==e||t[1]!==n||t[2]!==r?(s=async()=>{await n.invalidateQueries(ce()),await r.invalidate(),r.navigate({to:e})},t[0]=e,t[1]=n,t[2]=r,t[3]=s):s=t[3],s};function Et(){const e=D.c(2),t=se("/profile");let r;return e[0]!==t?(r={mutationFn:gt,onSuccess:()=>{t()},onError:yt},e[0]=t,e[1]=r):r=e[1],Z(r)}function yt(e){M.error(e.message||"An unexpected error occurred")}async function gt(e){const{value:t}=e,r=await ne(ht.email({email:t.email,password:t.password}));if(r.error)throw r.error;const{error:n,data:s}=r.data;if(n)throw new Error(n.message||"Login failed");return s}function At(){const e=D.c(2),t=se("/profile");let r;return e[0]!==t?(r={mutationFn:vt,onSuccess:n=>{M.success("User created successfully"),t()},onError:mt},e[0]=t,e[1]=r):r=e[1],Z(r)}function mt(e){M.error(e.message||"An unexpected error occurred")}async function vt(e){const{value:t}=e,r=await ne(pt.email({email:t.email,password:t.password,userName:t.userName,name:""}));if(r.error)throw r.error;const{error:n,data:s}=r.data;if(n)throw new Error(n.message||"Signup failed");return s}export{Et as a,St as l,Rt as r,At as u};
